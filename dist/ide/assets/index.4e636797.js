var Ei=Object.defineProperty,Di=Object.defineProperties;var Si=Object.getOwnPropertyDescriptors;var Bs=Object.getOwnPropertySymbols;var Ci=Object.prototype.hasOwnProperty,ki=Object.prototype.propertyIsEnumerable;var Jt=(s,e,t)=>e in s?Ei(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,de=(s,e)=>{for(var t in e||(e={}))Ci.call(e,t)&&Jt(s,t,e[t]);if(Bs)for(var t of Bs(e))ki.call(e,t)&&Jt(s,t,e[t]);return s},zs=(s,e)=>Di(s,Si(e));var l=(s,e,t)=>(Jt(s,typeof e!="symbol"?e+"":e,t),t);import{b as Mi,l as Ti,n as $i,R as Fi,B as _n,V as xe,P as Bi,M as Ht,a as Ie,S as En,C as Os,D as zi,A as Oi,c as Ai,d as Me,e as De,W as ji,N as Ii,f as Ze,g as Li,h as qt,i as Ui,j as Ri,k as Ni,s as Dn,m as Pi,o as Vi,p as Hi,O as qi,F as Wi,q as Yi,T as As,r as Xi,t as Sn,u as Qt,v as Gi,w as Ji,x as Qi,y as Zi,L as Lt,z as Cn,H as Ki,E as ea,G as kn,I as ta,J as Zt,K as Mn,Q as sa,U as na,X as ia,Y as aa,Z as ra,_ as oa,$ as la,a0 as ca,a1 as Ut,a2 as ua,a3 as os,a4 as da,a5 as nt,a6 as ha,a7 as pa,a8 as ma,a9 as fa,aa as ga,ab as Kt,ac as ya,ad as pe,ae as Tn,af as ba,ag as va,ah as $n,ai as xa,aj as ft,ak as Fn,al as C,am as wa,an as Le,ao as _a,ap as Bn,aq as Rt,ar as it,as as Ea,at as Da,au as es,av as zn,aw as at,ax as js,ay as ts,az as Is,aA as Sa,aB as Ca,aC as ka,aD as ls,aE as Ma,aF as On,aG as Ta,aH as Ls,aI as $a,aJ as Fa,aK as Ba,aL as rt,aM as za,aN as Oa,aO as Aa,aP as ja,aQ as An,aR as jn,aS as In,aT as _s,aU as Ia,aV as La,aW as Ua,aX as Ra,aY as Es,aZ as Na,a_ as Pa,a$ as Va,b0 as Ha,b1 as Ln,b2 as y,b3 as w,b4 as F,b5 as R,b6 as z,b7 as W,b8 as m,b9 as k,ba as Y,bb as $,bc as Un,bd as ye,be,bf as me,bg as ae,bh as qa,bi as Wa,bj as Ya,bk as Xa,bl as Ga,bm as Ja,bn as Qa,bo as Za,bp as Ka,bq as Us,br as Rs,bs as er,bt as Ns,bu as tr,bv as sr,bw as nr,bx as ir,by as ar,bz as rr,bA as or,bB as lr,bC as Rn,bD as cr,bE as ur,bF as dr,bG as hr,bH as pr,bI as mr,bJ as fr,bK as Ps,bL as Vs,bM as Hs,bN as qs,bO as Ws,bP as Ys,bQ as Xs,bR as Gs,bS as Js,bT as Qs,bU as Zs,bV as Ks,bW as gr,bX as yr,bY as br,bZ as vr,b_ as xr,b$ as wr,c0 as _r,c1 as Er,c2 as Dr,c3 as Sr,c4 as Cr,c5 as kr,c6 as Mr,c7 as Tr,c8 as $r,c9 as Fr,ca as Br,cb as zr,cc as Or,cd as Ar,ce as jr,cf as Ir,cg as Lr,ch as Ur,ci as ve,cj as Rr,ck as Nr,cl as Pr,cm as Vr,cn as Hr,co as en,cp as qr,cq as Wr,cr as Yr,cs as Xr,ct as Gr,cu as Jr}from"./vendor.d33927e2.js";const Qr=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}};Qr();window.Buffer=Mi.Buffer;const K=new class{constructor(){l(this,"obserer",{onPending:()=>{},onAlert:()=>{},onConnected:()=>{}});l(this,"loadingCount",0);l(this,"pendings",new Set);l(this,"reqQueue",[]);l(this,"rawConnection");l(this,"handlers",{})}request(s,...e){const t=typeof s=="string"?{method:s,args:e,resolve:null,reject:null}:s;if(typeof t.exclusive=="undefined"||t.exclusive){if(this.pendings.has(t.method))throw`previous request[${t.method}] is pending`;this.pendings.add(t.method)}return this.loadingCount++,this.obserer.onPending(this.loadingCount),this.rawConnection?this.processTask(this.rawConnection,t):(this.reqQueue.push(t),new Promise((i,a)=>{t.resolve=i,t.reject=a}))}describe(s,e,t){(this.handlers[s]||(this.handlers[s]=[])).push({handler:e,target:t})}undescribe(s){for(const[e,t]of Object.entries(this.handlers)){const n=t.filter(i=>i.target!==s);n.length!==t.length&&(this.handlers[e]=n)}}setupObserver(s){Object.assign(this.obserer,s)}async start(){const s="/__rpc__/connection",e=await this.createWebSocket(s);Ti.listen({webSocket:e,onConnection:(t=>{t.listen(),t.onNotification((n,...i)=>{const a=K.handlers[n];a&&a.forEach(r=>{r.handler.call(r.target,...i||[])})}),t.onRequest((n,...i)=>{const a=K.handlers[n];if(a)for(const r of a)return r.handler.call(r.target,...i||[])}),K.rawConnection=t,t.onClose(()=>{K.rawConnection=void 0}),this.obserer.onConnected(),console.log("rpc connected!"),K.processQueue()}).bind(this)})}processQueue(){if(!!K.rawConnection){for(const s of this.reqQueue)K.rawConnection.sendRequest(s.method,...s.args||[]).then(e=>{this.pendings.delete(s.method),s.resolve(e),this.obserer.onPending(this.loadingCount-1),this.loadingCount--}).catch(e=>{this.pendings.delete(s.method),s.reject(e),this.obserer.onPending(this.loadingCount-1),this.loadingCount--,this.obserer.onAlert(e)});this.reqQueue.length=0}}processTask(s,e){return s.sendRequest(e.method,...e.args||[]).then(n=>(this.pendings.delete(e.method),this.obserer.onPending(this.loadingCount-1),this.loadingCount--,n)).catch(n=>{throw this.pendings.delete(e.method),this.obserer.onPending(this.loadingCount-1),this.loadingCount--,this.obserer.onAlert(n),n})}createUrl(s){const e=location.protocol==="https:"?"wss":"ws";return $i(`${e}://${location.host}${s}`)}async createWebSocket(s){const e={maxReconnectionDelay:1e4,minReconnectionDelay:1e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:1e4,maxRetries:1/0,debug:!1},t=new Fi(this.createUrl(s),[],e);return t.binaryType="arraybuffer",t}};function Ds(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}function oe(s){return de({params:{},chains:[],label:s.name,description:`${s.name}-desc`},s)}function S(s,e,t){return new Proxy(zs(de({label:e.name,description:`${e.name}-desc`,type:"string"},e),{default:s.get({name:e.name})}),{get(n,i,a){return i==="value"?s.get({name:e.name}):Reflect.get(n,i,a)},set(n,i,a,r){const o=Reflect.set(n,i,a,r);return o&&i==="value"&&(s.set({name:e.name,value:a}),t&&t(e.name,a)),o}})}function ge(s,e,t){return new Proxy(de({type:"string"},e),{get(n,i,a){return i==="values"?t?t():Object.keys(s.properties):Reflect.get(n,i,a)}})}function Zr(s,e,t){return new Proxy(de({type:"string"},e),{get(n,i,a){return i==="values"?t?t():Object.keys(s.properties):Reflect.get(n,i,a)}})}function Kr(s,e,t,n){return new Proxy(de({},t),{get(i,a,r){var o,c,u;if(a==="type"){const h=e.slots[n];if(!h||((o=h.data)==null?void 0:o.type)!=="string")return"unknown";const d=(c=h.data)==null?void 0:c.value;return d&&((u=s.properties[d])==null?void 0:u.type)||"unknown"}return Reflect.get(i,a,r)}})}function eo(s,e){for(const[t,n]of Object.entries(s.events))e.events[t]=n.chains.map(i=>{var a,r;return{filter:(a=i.bound)==null?void 0:a.filter,blocks:(r=i.head)==null?void 0:r.born()}}).filter(i=>i.blocks);return e}function B(s){return typeof s=="string"?{name:s,label:s,description:`${s}-desc`}:de({label:s.name,description:`${s.name}-desc`},s)}function to(s){var e,t;if(s.block)return s.block.born();if(s.data){const n=(e=s.data.value)!=null?e:s.data.default;if(s.data.type==="unit")return(t=n==null?void 0:n.instance)!=null?t:void 0;if(s.required&&n===void 0)throw new Error(`${s.name} is required`);return n}if(s.required)throw new Error(`${s.name} is required`)}async function ne(s,e,t){let n;if(s==null?void 0:s.execute){let i=s;for(;i;)n=await i.execute(e||{},t),i=i.next;return n}return s}function cs(s,e,t){return s.execute?{callee:s.callee===e?t:s.callee,slots:Object.fromEntries(Object.entries(s.slots).map(([n,i])=>[n,cs(i,e,t)])),next:s.next?cs(s.next,e,t):void 0,execute:s.execute}:s}class Wt{constructor(e,t,n,i,a){l(this,"id",Ds());l(this,"slots",{});l(this,"label");l(this,"description");l(this,"execute");l(this,"ending");l(this,"next");if(this.callee=e,this.name=t,this.label=i||t,this.description=a||`${this.label}-desc`,this.execute=n||e.instance[t],!this.execute)throw new Error(`${this.name} is not found`)}born(){var a;const e=Object.fromEntries(Object.entries(this.slots).map(([r,o])=>[r,to(o)])),t={},n=Object.entries(this.slots);for(let r=0;r<n.length;r++){const[o,c]=n[r];if(c.data)t[o]=!0;else break}Object.fromEntries(Object.entries(this.slots).map(([r,o])=>[r,!!o.data]));const{execute:i}=this;return{callee:this.callee.instance,next:(a=this.next)==null?void 0:a.born(),slots:e,execute:async function(r,o){const c=Object.fromEntries(await Promise.all(Object.entries(this.slots).map(async([u,h])=>[u,t[u]?await ne(h,r,o):h])));return await i.call(this.callee,c,o)}}}attach(e){if(this.next)throw new Error(`${this.name} already has next block`);this.next=e}dettach(){const e=this.next;return this.next=void 0,e}}class A extends Wt{constructor(e,t,n,i){super(e,t,n,i);l(this,"output")}}l(A,"type","action");class Ke extends Wt{constructor(e,t,n,i){super(e,t,n,i)}}l(Ke,"type","data");class Te{constructor(e,t){l(this,"uuid");l(this,"properties",{});l(this,"events",{});l(this,"children",{});l(this,"clonedCount",0);this.parent=t,this.uuid=e||Ds()}get({name:e}){return this.properties[e]}set({name:e,value:t}){this.properties[e]=t}appendChild(e){if(this.children[e.uuid])throw new Error(`unit ${e.uuid} already exists`);e.parent=this,this.children[e.uuid]=e}removeChild(e){delete this.children[e.uuid]}async clone(){if(!this.parent)throw new Error("cannot clone root unit");this.clonedCount++;const e=new this.__proto__.constructor(void 0,this.parent,this);e.cloned=!0,Object.assign(e.properties,this.properties);const t=this.events.clone;return t.length&&(e.events.clone=t.map(n=>({filter:n.filter,blocks:cs(n.blocks,this,e)}))),this.parent.appendChild(e),e.emit("clone",{}),e}async die(){!this.parent||(this.parent.removeChild(this),console.log(`${this.uuid} died`))}async emit(e,t){const n=this.events[e];(n==null?void 0:n.length)&&await Promise.all(n.map(async i=>{if(!(i.filter&&t.name!==i.filter))return await ne(i.blocks,{},{from:this,name:e,params:t})})).catch(i=>{console.error(i)})}static async create(e,t,n){return new this(e,t,n)}}class $e{constructor(e,t,n){l(this,"properties",{});l(this,"actions",{});l(this,"events",{});l(this,"chains",{});l(this,"children",{});this.egg=e,this.instance=t,this.parent=n;const i=this;this.actions={clone:class extends A{constructor(a){super(a,"clone")}},die:class extends A{constructor(a){super(a,"die")}},get:class extends Ke{constructor(a){super(a,"get");l(this,"slots",{name:B({name:"name",data:ge(i,{}),required:!0,suffix:"valueof"})});l(this,"output",{type:"unknown",name:".",label:"value",description:"value-desc"})}},set:class extends A{constructor(a){super(a,"set");l(this,"slots",{name:B({name:"name",data:ge(i,{}),required:!0,suffix:"valueof"}),value:B({name:"value",data:Kr(i,this,{},"name"),required:!0,prefix:"tois"})})}}},this.events={clone:oe({name:"clone"})}}get uuid(){return this.instance.uuid}get name(){return this.instance.constructor.clsname}appendChild(e){if(this.children[e.instance.uuid])throw new Error(`unit ${e.instance.uuid} already exists`);e.parent&&e.parent.removeChild(e),e.parent=this,this.children[e.instance.uuid]=e,this.instance.appendChild(e.instance)}removeChild(e){delete this.children[e.instance.uuid],this.instance.removeChild(e.instance)}createChain(e){const t={id:Ds(),unit:this,head:e};if(this.chains[t.id])throw"duplicate chain";return this.chains[t.id]=t,t}removeChain(e){e.bound&&e.bound.unit.unbindEvent(e.bound.event,e),delete this.chains[e.id]}bindEvent(e,t,n){const i=this.events[e];if(!i)throw new Error(`event ${e} not found`);t.bound&&t.bound.unit.unbindEvent(t.bound.event,t),i.chains.push(t),t.bound={unit:this,event:e,filter:n}}unbindEvent(e,t){const n=this.events[e];if(!n)throw new Error(`event ${e} not found`);const i=n.chains.indexOf(t);i!==-1&&(n.chains.splice(i,1),t.bound=void 0)}appendBlock(e,t){if(!e.head)e.head=t;else{let n=e.head;for(;n.next;)n=n.next;n.next=t}}removeBlock(e,t){if(e.head===t)e.head=t.next;else if(e.head){let n=e.head;for(;n.next!==t;)n=n.next;if(!n)throw new Error("block not found");n.next=t.next}t.next=void 0}findBlock(e,t){let n=e.head;for(;n;){if(n.id===t)return n;n=n.next}}clearChains(){Object.values(this.chains).forEach(e=>{this.removeChain(e)})}clearEvents(){Object.values(this.events).forEach(e=>{e.chains.length=0})}build(){eo(this,this.instance);for(const e of Object.values(this.children))e.build();return this.instance}createAction(e){return new this.actions[e](this)}}const so="0.0.1";var P;(s=>{s.egg="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C0",s.logic="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C1",s.math="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C2",s.storage="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C3",s.timer="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C4",s.screen="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C5",s.camera="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C6",s.speech="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C7",s.gesture="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8C8",s.test="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8CA",s.scene="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8CB",s.pose="9E8B8E0E-B7B2-4E8E-8A0A-D6E7A9C9D8CC",s.box="9E8B8E0E-B7B2-4E8E-A801-000000000001",s.sphere="9E8B8E0E-B7B2-4E8E-A801-000000000002",s.plane="9E8B8E0E-B7B2-4E8E-A801-000000000003",s.text="9E8B8E0E-B7B2-4E8E-A801-000000000004",s.bulb="9E8B8E0E-B7B2-4E8E-A801-000000000005",s.cloth="9E8B8E0E-B7B2-4E8E-A801-000000000006"})(P||(P={}));class Fe extends $e{constructor(e,t){super(e,t,e);delete this.actions.clone,delete this.actions.die,delete this.events.clone}}class Be extends Te{clone(){throw new Error("Not allowed.")}}class gt extends Be{set({name:e,value:t}){this.properties[e]!==t&&(super.set({name:e,value:t}),this.emit("change",{name:e,value:t}))}}l(gt,"type","storage"),l(gt,"clsname","storage"),l(gt,"clsid",P.storage);class Nn extends Fe{constructor(e,t){super(e,t);const i={change:oe({name:"change",params:{name:Zr(this,{type:"string",name:"name"}),value:{type:"unknown",name:"value"}}})};Object.entries(i).forEach(([a,r])=>{this.events[a]=r})}addProperty(e,t,n){if(this.properties[t])throw new Error(`property ${t} already exists`);this.properties[t]=S(this.instance,{type:e,name:t}),this.properties[t].value=n}editProperty(e,t){const n=this.properties[e];if(!n)throw new Error(`property ${e} does not exists`);for(const[i,a]of Object.entries(t))n[i]=a}removeProperty(e){if(!this.properties[e])throw new Error(`property ${e} does not exists`);delete this.properties[e],delete this.instance.properties[e]}}l(Nn,"runtime",gt);class yt extends Be{constructor(e,t){super(e,t);l(this,"enable",!0)}async start(){if(!this.parent)throw new Error("No parent.");const e=this.parent;this.enable=!0;const{change:t}=this.events,n=t.filter(a=>a.filter==="millisecond");if(n==null?void 0:n.length){const a=async()=>{!this.enable||!e.isRunning()||(await this.emit("change",{name:"millisecond",now:Date.now()}),setTimeout(a,1))};setTimeout(a,0)}const i=t.filter(a=>a.filter!=="millisecond");if(i==null?void 0:i.length){const a=async()=>{!this.enable||!e.isRunning()||(await this.emit("change",{name:"second",now:Date.now()}),setTimeout(a,1e3))};setTimeout(a,0)}}async stop(){this.enable=!1}async time(){return Date.now()}clone(){throw new Error("Not allowed.")}}l(yt,"type","timer"),l(yt,"clsname","timer"),l(yt,"clsid",P.timer);class Pn extends Fe{constructor(e,t){super(e,t);this.actions={time:class extends Ke{constructor(i){super(i,"time");l(this,"output",{type:"number",name:".",label:"timestamp",description:"timestamp-desc"})}}};const n={change:oe({name:"change",params:{name:{type:"string",name:"name",values:["second","millisecond"]},now:{type:"number",name:"now"}}})};Object.entries(n).forEach(([i,a])=>{this.events[i]=a})}}l(Pn,"runtime",yt);var Vn=[Nn,Pn];class no extends A{constructor(e){super(qn,e,void 0,`math.${e}`);l(this,"output",{type:"number",name:".",label:"result",description:"result-desc"});if(!this.execute)throw`unknown math action: ${e}`}}class Hn extends A{constructor(e){super(qn,e,void 0,`math.${e}`);l(this,"output",{type:"boolean",name:".",label:"result",description:"result-desc"});if(!this.execute)throw`unknown math action: ${e}`}}class ze extends no{constructor(){super(...arguments);l(this,"slots",{a:B({name:"a",label:"math.operand.a",data:{type:"number"},required:!0}),b:B({name:"b",label:"math.operand.b",data:{type:"number"},required:!0})})}}class We extends Hn{constructor(){super(...arguments);l(this,"slots",{a:B({name:"a",label:"math.operand.a",data:{type:"number"},required:!0}),b:B({name:"b",label:"math.operand.b",data:{type:"number"},required:!0})})}}class Xe extends Te{constructor(){super(...arguments);l(this,"uuid",P.math)}clone(){throw new Error("Not allowed.")}add({a:e,b:t}){return e+t}sub({a:e,b:t}){return e-t}mul({a:e,b:t}){return e*t}div({a:e,b:t}){return e/t}mod({a:e,b:t}){return e%t}random({a:e,b:t}){return Math.floor(Math.random()*(t-e+1)+e)}not({a:e}){return!e}equal({a:e,b:t}){return e===t}greaterThen({a:e,b:t}){return e>t}greaterThenOrEqual({a:e,b:t}){return e>=t}lessThen({a:e,b:t}){return e>t}lessThenOrEqual({a:e,b:t}){return e<=t}}l(Xe,"type","virtual-device"),l(Xe,"clsname","math"),l(Xe,"clsid",P.math);class Ss extends $e{constructor(e,t){super(e,t,e);this.actions={add:class extends ze{constructor(){super("add");this.slots.a.suffix="math.+"}},sub:class extends ze{constructor(){super("sub");this.slots.a.suffix="math.-"}},mul:class extends ze{constructor(){super("mul");this.slots.a.suffix="math.*"}},div:class extends ze{constructor(){super("div");this.slots.a.suffix="math./"}},mod:class extends ze{constructor(){super("mod");this.slots.a.suffix="math.%"}},random:class extends ze{constructor(){super("random");this.slots.a.prefix="from",this.slots.a.suffix="to"}},not:class extends Hn{constructor(){super("not");l(this,"slots",{a:B({name:"a",label:"math.operand.a",data:{type:"boolean"},required:!0,prefix:"math.!"})})}},equal:class extends We{constructor(){super("equal");this.slots.a.suffix="math.=="}},greaterThen:class extends We{constructor(){super("greaterThen");this.slots.a.suffix="math.>"}},greaterThenOrEqual:class extends We{constructor(){super("greaterThenOrEqual");this.slots.a.suffix="math.>="}},lessThen:class extends We{constructor(){super("lessThen");this.slots.a.suffix="math.<"}},lessThenOrEqual:class extends We{constructor(){super("lessThenOrEqual");this.slots.a.suffix="math.<="}}}}}l(Ss,"runtime",Xe);const qn=new Ss(null,new Xe);class bt extends Te{clone(){throw new Error("Not allowed.")}async if({condiction:e,action:t},n){(e?await ne(e,{},n):!1)&&t&&await ne(t,{},n)}async ifElse({condiction:e,alternative:t,action:n},i){(e?await ne(e,{},i):!1)?n&&await ne(n,{},i):t&&await ne(t,{},i)}async loop({action:e},t){const n=this.parent;for(;n.isRunning();)await ne(e,{},t)}async loopUntill({condiction:e,action:t},n){for(;!await ne(e,{},n);)await ne(t,{},n)}async repeat({times:e,action:t},n){const i=await ne(e,{},n);for(let a=0;a<i;a++)await ne(t,{},n)}}l(bt,"type","virtual-device"),l(bt,"clsname","logic"),l(bt,"clsid",P.logic);class Oe extends Wt{constructor(e,t,n,i){super(e,t,n,i)}}l(Oe,"type","logic");class Wn extends $e{constructor(e,t){super(e,t,e);this.actions={if:class extends Oe{constructor(n){super(n,"if");l(this,"slots",{condiction:B({name:"condiction",data:{type:"boolean"},required:!0,suffix:"logic.then"}),action:B({name:"action"})})}},ifElse:class extends Oe{constructor(n){super(n,"ifElse");l(this,"slots",{condiction:B({name:"condiction",data:{type:"boolean"},suffix:"logic.then",required:!0}),action:B({name:"action"}),alternative:B({name:"alternative",prefix:"logic.else"})})}},loop:class extends Oe{constructor(n){super(n,"loop");l(this,"ending",!0);l(this,"slots",{action:B({name:"action"})})}},loopUntill:class extends Oe{constructor(n){super(n,"loopUntill");l(this,"slots",{condiction:B({name:"condiction",data:{type:"boolean"},required:!0}),action:B({name:"action"})})}},repeat:class extends Oe{constructor(n){super(n,"repeat");l(this,"slots",{times:B({name:"times",data:{type:"number"},required:!0,suffix:"logic.times"}),action:B({name:"action"})})}}}}}l(Wn,"runtime",bt);class Yn extends Wt{constructor(e,t,n,i){super(e,t,n,i)}}l(Yn,"type","logic");class vt extends Te{clone(){throw new Error("Not allowed.")}async equal({left:e,right:t}){return e===t}}l(vt,"type","virtual-device"),l(vt,"clsname","test"),l(vt,"clsid",P.test);class Xn extends $e{constructor(e,t){super(e,t,e);this.actions={equal:class extends Yn{constructor(n){super(n,"equal");l(this,"slots",{left:B({name:"left",data:{type:"string"},required:!0,suffix:"and"}),right:B({name:"right",data:{type:"string"},suffix:"same"})});l(this,"output",{type:"boolean",name:".",label:"result",description:"result-desc"})}}}}}l(Xn,"runtime",vt);var Gn=[Ss,Xn,Wn];class Ce extends Te{constructor(){super(...arguments);l(this,"running",!1);l(this,"classes",{});l(this,"devices",{});l(this,"builtins",{});l(this,"allUnits",{});l(this,"message","");l(this,"uuid",P.egg)}reset(){this.setMessage("system reset"),this.stop(),this.setMessage("clear all units"),this.allUnits={},this.children={},this.allUnits[this.uuid]=this,this.setMessage("reset devices and builtins");for(const e of Object.values(this.devices)){this.appendChild(e),this.allUnits[e.uuid]=e;for(const[t,n]of Object.entries(e.properties))e.set({name:t,value:n})}for(const e of Object.values(this.builtins)){this.appendChild(e),this.allUnits[e.uuid]=e;for(const[t,n]of Object.entries(e.properties))e.set({name:t,value:n})}}async init(e,t,n){this.setMessage("system init"),this.allUnits[this.uuid]=this;for(const i of Vn.map(a=>a.runtime).concat(t||[])){this.setMessage(`init device: ${i.clsname}.`);const a=await i.create(i.clsid);this.devices[i.clsname]=a,this.allUnits[a.uuid]=a,this.appendChild(a)}for(const i of Gn.map(a=>a.runtime).concat(n||[])){this.setMessage(`init builtin object: ${i.clsname}.`);const a=await i.create(i.clsid);this.builtins[i.clsname]=a,this.allUnits[a.uuid]=a,this.appendChild(a)}for(const i of e){if(this.classes[i.clsname])throw"duplicate class name";this.classes[i.clsname]=i}return this}async run(e){this.setMessage("system start to run"),Object.assign(this.properties,e),this.running=!0;const{timer:t}=this.devices;t.start(),await this.emit("start",e)}stop(){this.setMessage("system going to stop"),this.running=!1;const{timer:e}=this.devices;e.stop(),this.emit("stop",{})}isRunning(){return this.running}findUnit({uuid:e}){return this.allUnits[e]}valueFromEvent({name:e},t){if(!!t)return t.params[e]}async delayExecute({milliseconds:e,action:t},n){setTimeout(()=>{ne(t,{},n)},e)}setMessage(e){this.message=e}}l(Ce,"type","object"),l(Ce,"clsname","chick"),l(Ce,"clsid",P.egg);class Jn extends $e{constructor(e=Ce){super(null,new(e||Ce),null);l(this,"classes",{});l(this,"devices",{});l(this,"builtins",{});l(this,"allUnits",{});l(this,"chains",{});l(this,"storage",null);this.allUnits[this.uuid]=this;const t=this;this.actions={findUnit:class extends Ke{constructor(i){super(i,"findUnit");l(this,"slots",{name:B({name:"name",data:ge(t,{},()=>Object.keys(t.allUnits)),required:!0})});l(this,"output",{type:"unit",name:"."})}},stop:class extends A{constructor(i){super(i,"stop")}},valueFromEvent:class extends Ke{constructor(i){super(i,"valueFromEvent",void 0,"valueFromEvent");l(this,"slots",{name:B({name:"name",data:{type:"string"},required:!0})});l(this,"output",{type:"unknown",name:"."})}},delayExecute:class extends A{constructor(i){super(i,"delayExecute");l(this,"slots",{milliseconds:B({name:"milliseconds",data:{type:"number"},required:!0,suffix:"milliseconds"}),action:B({name:"action"})})}}};const n={start:oe({name:"start"}),stop:oe({name:"stop"})};Object.entries(n).forEach(([i,a])=>{this.events[i]=a}),delete this.actions.clone,delete this.actions.die,delete this.events.clone}run(e){return this.instance.run(e)}stop(){return this.instance.stop()}isRunning(){return this.instance.isRunning()}async createUnit(e,t,n,i){if(this.builtins[e])throw"builtin unit";const a=this.classes[e];if(!a)throw"unknown class";const r=await a.runtime.create(n,t.instance,i);if(this.allUnits[r.uuid])throw"duplicate unit";const o=new a(this,r,t);return t.appendChild(o),this.allUnits[r.uuid]=o,this.instance.allUnits[r.uuid]=o.instance,o}destroyUnit(e){e.clearChains(),delete this.allUnits[e.uuid],delete this.instance.allUnits[e.uuid],e.parent&&e.parent.removeChild(e)}async init(e,t,n){const i=[Object.values(e).map(r=>r.runtime),t?Object.values(t).map(r=>r.runtime):void 0,n?Object.values(n).map(r=>r.runtime):void 0];await this.instance.init(...i);const a=this.instance;for(const r of Vn.concat(t||[])){const o=r.runtime,c=a.devices[o.clsname],u=new r(this,c);this.devices[o.clsname]=u,this.allUnits[u.uuid]=u,this.appendChild(u)}for(const r of Gn.concat(n||[])){const o=r.runtime,c=a.builtins[o.clsname],u=new r(this,c);this.builtins[o.clsname]=u,this.allUnits[u.uuid]=u,this.appendChild(u)}this.storage=this.devices.storage;for(const r of e){if(this.classes[r.runtime.clsname])throw"duplicate class name";this.classes[r.runtime.clsname]=r}return this}serialize(){const e=i=>{var r;const a={};for(const[o,c]of Object.entries(i.slots))if(c.block){const u=[];let h=c.block;for(;h;)u.push(e(h)),h=h.next;a[o]=u}else a[o]={type:"data",value:(r=c.data)==null?void 0:r.value};return{id:i.id,type:"block",unit:i.callee.uuid,action:i.name,slots:a}},t=i=>{const a=[];let r=i.head;for(;r;)a.push(e(r)),r=r.next;return a},n=i=>{const a=i.instance,r=a.constructor,o=a.packUserData?a.packUserData():{};return{cls:r.clsname,clsid:r.clsid,properties:Object.fromEntries(Object.entries(i.properties).map(([c,u])=>[c,u.value])),events:Object.fromEntries(Object.entries(i.events).map(([c,u])=>[c,u.chains.map(h=>({unit:h.unit.uuid,chain:h.id}))])),chains:Object.values(i.chains).map(c=>({id:c.id,unit:c.unit.uuid,blocks:t(c),bound:c.bound?{unit:c.bound.unit.uuid,event:c.bound.event,filter:c.bound.filter}:void 0})),children:Object.keys(i.children),userData:o}};return{version:so,units:Object.fromEntries(Object.entries(this.allUnits).map(([i,a])=>[i,n(a)])),variables:Object.fromEntries(Object.entries(this.storage.properties).map(([i,a])=>[i,a.type]))}}async unserialize(e){this.reset();const t=a=>{const r=this.allUnits[a.unit];if(!r)throw"unknown unit";const o=r.createAction(a.action);o.id=a.id;for(const[c,u]of Object.entries(a.slots)){const h=o.slots[c];if(!h)throw"unknown slot";if(!Array.isArray(u))u.type==="data"?h.data&&(h.data.value=u.value):u.type==="block"&&(h.block=t(u));else{const d=u[0];if(!this.allUnits[d.unit])throw"unknown unit";let f=t(d);h.block=f;const g=u.length;for(let b=1;b<g;b++){const E=u[b];if(!this.allUnits[E.unit])throw"unknown unit";f.next=t(E),f=f.next}}}return o};for(const[a,r]of Object.entries(e.variables))this.storage.addProperty(r,a,void 0);const n=Object.fromEntries(Object.entries({chick:this}).concat(Object.entries(this.devices)).concat(Object.entries(this.builtins)));await Promise.all(Object.entries(e.units).map(async([a,r])=>{const o=n[r.cls];!o||(o.instance.uuid=a,o.instance.loadUserData&&r.userData&&await o.instance.loadUserData(r.userData))})).catch(a=>{console.error(a)}),await Promise.all(Object.entries(e.units).map(async([a,r])=>{if(n[r.cls])return;const o=await this.createUnit(r.cls,this,a);o.instance.loadUserData&&r.userData&&await o.instance.loadUserData(r.userData)})).catch(a=>{console.error(a)});const i=(a,r)=>{let o,c;return r.blocks.forEach(u=>{const h=t(u);o||(o=h),c&&c.attach(h),c=h}),{id:r.id,unit:a,head:o,bound:r.bound?{unit:this.allUnits[r.bound.unit],event:r.bound.event,filter:r.bound.filter}:void 0}};Object.entries(e.units).forEach(([a,r])=>{const o=n[r.cls]||this.allUnits[a];if(!o)throw"unknown unit";if(o!==this)for(const c of r.children)o.appendChild(this.allUnits[c]);for(const[c,u]of Object.entries(r.properties)){if(!o.properties[c]){console.warn(`unknown property ${c}`);continue}o.properties[c].value=u}o.chains=Object.fromEntries(r.chains.map(c=>[c.id,i(o,c)]))}),Object.entries(e.units).forEach(([a,r])=>{const o=n[r.cls]||this.allUnits[a];if(!o)throw"unknown unit";for(const[c,u]of Object.entries(r.events)){const h=o.events[c];if(!h){if(u.length>0)throw"unknown event";console.warn(`unknown event ${c}`);continue}h.chains=u.map(d=>{const p=this.allUnits[d.unit];if(!p)throw"unknown unit";return p.chains[d.chain]})}})}findUnit(e){const t=this.allUnits[e];return t||(this.uuid===e?this:Object.values(this.devices).find(n=>n.uuid===e)||Object.values(this.builtins).find(n=>n.uuid===e))}build(){return super.build()}reset(){this.allUnits={},this.chains={},this.children={},this.storage.properties={},this.storage.instance.properties={},this.instance.reset(),this.allUnits[this.uuid]=this;for(const e of Object.values(this.properties))e.value=e.default;for(const e of Object.values(this.devices))this.appendChild(e),this.allUnits[e.uuid]=e;for(const e of Object.values(this.builtins))this.appendChild(e),this.allUnits[e.uuid]=e;for(const e of Object.values(this.events))e.chains=[]}}l(Jn,"runtime",Ce);class Qn extends Te{constructor(e,t,{object:n}){super(e,t);l(this,"isVisUnit",!0);l(this,"object");n.traverse(function(i){i.isMesh&&(i.castShadow=!0)}),n.userData.uid=e,this.object=n,this.object.name=this.__proto__.clsname}get position(){return this.object.position}async die(){this.cloned?(super.die(),this.object.parent&&this.object.parent.remove(this.object)):this.object.visible=!1}get({name:e}){const t=super.get({name:e});if(t!==void 0)return t;if(e==="position")return{x:this.object.position.x,y:this.object.position.y,z:this.object.position.z};if(e==="scale")return 1;if(e==="rotation")return{x:this.object.rotation.x,y:this.object.rotation.y,z:this.object.rotation.z};if(e==="material"){const n=this.object;return n.isMesh?n.material.uuid:void 0}else if(e==="visible")return!0}set({name:e,value:t}){if(e==="material"?super.set({name:e,value:(t==null?void 0:t.uuid)||t}):super.set({name:e,value:t}),e==="position")this.object.position.set(t.x,t.y,t.z);else if(e==="scale")this.object.scale.set(t,t,t);else if(e==="rotation")this.object.rotation.set(t.x,t.y,t.z);else if(e==="material"){const n=this.object;if(!n.isMesh)return;if(typeof t=="string"){const i=this.getMaterialFromId(t);i&&(n.material=i)}else n.material=t!=null?t:new Ht({color:4095,depthWrite:!1})}else e==="visible"&&(this.object.visible=t)}getMaterialFromId(e){return fe.getMaterialFromId(e)}}class Zn extends $e{constructor(e,t,n){super(e,t,n);const i={position:S(t,{name:"position",type:"vec3"}),rotation:S(t,{name:"rotation",type:"vec3"}),scale:S(t,{name:"scale",type:"number",min:0,max:2,step:.01}),material:S(t,{name:"material",type:"material"}),visible:S(t,{name:"visible",type:"boolean"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}}}class le extends Qn{constructor(e,t,n){const{object:i,physics:a,selfUpdate:r}=n;super(e,t,n);l(this,"isPhynit",!0);l(this,"physics");l(this,"selfUpdate");l(this,"center");l(this,"soudsCached",{});const c=new _n().setFromObject(i).getCenter(new xe);this.center=c,this.physics=a,this.selfUpdate=r,!this.selfUpdate&&a&&a.position.set(c.x,c.y,c.z)}get position(){return this.object.position}update(e,t,n,i){!this.selfUpdate&&this.physics&&(this.object.position.set(this.physics.position.x,this.physics.position.y,this.physics.position.z),this.object.quaternion.set(this.physics.quaternion.x,this.physics.quaternion.y,this.physics.quaternion.z,this.physics.quaternion.w))}scale({value:e}){!e||(this.object.scale.x+=e,this.object.scale.y+=e,this.object.scale.z+=e)}playSound({name:e,loop:t}){let n=this.soudsCached[e];if(!n){const i=fe.sounds[e];if(!i)throw new Error(`sound ${e} not found`);n=new Bi(fe.listener),n.setBuffer(i.buffer),n.setLoop(!!t),this.soudsCached[e]=n,this.object.add(n)}n.play()}stopSound({name:e}){if(!e)Object.values(this.soudsCached).forEach(t=>t.stop());else{const t=this.soudsCached[e];if(!t)return;t.stop()}}get({name:e}){var n,i,a,r;const t=super.get({name:e});if(t!==void 0)return t;if(e==="mass")return(i=(n=this.physics)==null?void 0:n.mass)!=null?i:0;if(e==="velocity")return this.physics?{x:this.physics.velocity.x,y:this.physics.velocity.y,z:this.physics.velocity.z}:{x:0,y:0,z:0};if(e==="force")return this.physics?{x:this.physics.force.x,y:this.physics.force.y,z:this.physics.force.z}:{x:0,y:0,z:0};if(e==="friction")return this.physics?(a=this.physics.material)==null?void 0:a.friction:0;if(e==="restitution")return this.physics?(r=this.physics.material)==null?void 0:r.restitution:0}set({name:e,value:t}){var n,i;super.set({name:e,value:t}),e==="position"?this.physics&&(this.physics.position.set(t.x,t.y,t.z),this.physics.velocity.set(0,0,0),this.physics.quaternion.set(0,0,0,1)):e==="mass"?this.physics&&(this.physics.mass=t):e==="velocity"?this.physics&&this.physics.velocity.set(t.x,t.y,t.z):e==="force"?this.physics&&this.physics.force.set(t.x,t.y,t.z):e==="friction"?((n=this.physics)==null?void 0:n.material)&&(this.physics.material.friction=t):e==="restitution"&&((i=this.physics)==null?void 0:i.material)&&(this.physics.material.restitution=t)}}class _e extends Zn{constructor(e,t,n){super(e,t,n);const i=this,a={scale:class extends A{constructor(r){super(r,"scale");l(this,"slots",{value:B({name:"target.value",data:{type:"number"},required:!0})})}},playSound:class extends A{constructor(r){super(r,"playSound");l(this,"slots",{name:B({name:"name",data:ge(i,{},()=>Object.keys(fe.sounds)),required:!0}),loop:B({name:"loop",data:{type:"boolean"},required:!1})})}},stopSound:class extends A{constructor(r){super(r,"stopSound");l(this,"slots",{name:B({name:"name",data:ge(i,{},()=>Object.keys(fe.sounds)),required:!1})})}}};for(const r of Object.entries(a)){const[o,c]=r;this.actions[o]=c}if(delete this.actions.scale,t.physics){const r={mass:S(t,{name:"mass",type:"number"}),velocity:S(t,{name:"velocity",type:"vec3"}),force:S(t,{name:"force",type:"vec3"}),friction:S(t,{name:"friction",type:"number"}),restitution:S(t,{name:"restitution",type:"number"})};for(const o of Object.entries(r)){const[c,u]=o;this.properties[c]=u}}delete this.properties.scale}}class Nt extends Qn{}l(Nt,"is2D",!0);class io extends Zn{constructor(e,t,n){super(e,t,n)}}class ke extends Te{constructor(e,t){super(e,t);l(this,"isScene",!0);l(this,"scene");l(this,"light");l(this,"spotLight");l(this,"ambient");l(this,"ground");l(this,"world");l(this,"gravity",new Ie(0,-9.8,0));this.scene=new En,this.scene.background=new Os(12571109),this.light=new zi(16777215),this.light.position.set(3,10,10),this.light.castShadow=!0,this.light.shadow.mapSize.x=1024,this.light.shadow.mapSize.y=1024,this.light.shadow.camera.visible=!0,this.light.shadow.camera.top=10,this.light.shadow.camera.bottom=-2,this.light.shadow.camera.left=-2,this.light.shadow.camera.right=2,this.light.shadow.camera.near=.1,this.light.shadow.camera.far=40,this.scene.add(this.light),this.ambient=new Oi(4210752),this.scene.add(this.ambient),this.spotLight=new Ai(16777215),this.spotLight.position.set(0,10,0),this.spotLight.castShadow=!0,this.spotLight.shadow.mapSize.x=1024,this.spotLight.shadow.mapSize.y=1024,this.spotLight.shadow.camera.near=.1,this.spotLight.shadow.camera.far=40,this.spotLight.shadow.camera.fov=30,this.scene.add(this.spotLight);const n=new Ht({color:10066329,depthWrite:!1,specular:1052688});this.ground=new Me(new De(30,30),n),this.ground.rotation.x=-Math.PI/2,this.ground.position.y=-1e-4,this.ground.receiveShadow=!0,this.scene.add(this.ground),this.world=new ji({gravity:this.gravity}),this.world.broadphase=new Ii,this.world.defaultContactMaterial.contactEquationStiffness=5e6,this.world.defaultContactMaterial.contactEquationRelaxation=3;const i=new Ze({mass:0,position:new Ie(0,0,0),shape:new Li,material:new qt({friction:.1,restitution:.01})});i.quaternion.setFromEuler(-Math.PI/2,0,0),this.ground.userData.physics=i,this.world.addBody(i)}clone(){throw new Error("Not allowed.")}get name(){return this.get({name:"name"})}get({name:e}){const t=super.get({name:e});if(t!==void 0)return t;const n={name:()=>this.constructor.clsname,"sky.color":()=>`#${this.scene.background.getHexString()}`,"light.on":()=>this.light.visible,"light.color":()=>`#${this.light.color.getHexString()}`,"light.position":()=>({x:this.light.position.x,y:this.light.position.y,z:this.light.position.z}),"light.intensity":()=>this.light.intensity,"spot.on":()=>this.spotLight.visible,"spot.color":()=>`#${this.spotLight.color.getHexString()}`,"spot.position":()=>({x:this.spotLight.position.x,y:this.spotLight.position.y,z:this.spotLight.position.z}),"ambient.on":()=>this.ambient.visible,"ambient.color":()=>`#${this.ambient.color.getHexString()}`,"ground.material":()=>this.ground.material.uuid}[e];return n==null?void 0:n()}set({name:e,value:t}){if(e==="ground.material"?super.set({name:e,value:t.uuid||t}):super.set({name:e,value:t}),e==="sky.color")this.scene.background=new Os(t);else if(e==="light.on")this.light.visible=t;else if(e==="light.color")this.light.color.set(t);else if(e==="light.position")this.light.position.set(t.x,t.y,t.z);else if(e==="light.intensity")this.light.intensity=t;else if(e==="spot.on")this.spotLight.visible=t;else if(e==="spot.color")this.spotLight.color.set(t);else if(e==="spot.position")this.spotLight.position.set(t.x,t.y,t.z);else if(e==="ambient.on")this.ambient.visible=t;else if(e==="ambient.color")this.ambient.color.set(t);else if(e==="ground.material")if(typeof t=="string"){const n=this.getMaterialFromId(t);n&&(this.ground.material=n)}else this.ground.material=t}appendChild(e){if(!(e instanceof le))throw new Error("Not allowed.");super.appendChild(e),this.scene.add(e.object),e.physics?this.world.addBody(e.physics):e.onWorldSetup&&e.onWorldSetup(this,this.world)}removeChild(e){if(!(e instanceof le))throw new Error("Not allowed.");super.removeChild(e),this.scene.remove(e.object),e.physics?this.world.removeBody(e.physics):e.onWorldTeardown&&e.onWorldTeardown(this,this.world)}update(e,t){this.world.step(e);const n=i=>{i.update(e,t,this,this.world);for(const a of Object.values(i.children))n(a)};for(const i of Object.values(this.children))n(i)}render(e,t){e.render(this.scene,t)}getMaterialFromId(e){return fe.getMaterialFromId(e)}}l(ke,"type","object"),l(ke,"clsname","scene"),l(ke,"clsid",P.scene);class Kn extends $e{constructor(e,t){super(e,t);const n={name:S(t,{name:"name",type:"string"}),"sky.color":S(t,{name:"sky.color",group:"scene",type:"color"}),"ground.material":S(t,{name:"ground.material",group:"ground",type:"material"}),"light.on":S(t,{name:"light.on",group:"light",type:"boolean"}),"light.color":S(t,{name:"light.color",group:"light",type:"color"}),"light.position":S(t,{name:"light.position",group:"light",type:"vec3"}),"light.intensity":S(t,{name:"light.intensity",group:"light",type:"number",min:0,max:1,step:.1}),"spot.on":S(t,{name:"spot.on",group:"spot",type:"boolean"}),"spot.color":S(t,{name:"spot.color",group:"spot",type:"color"}),"spot.position":S(t,{name:"spot.position",group:"spot",type:"vec3"}),"ambient.on":S(t,{name:"ambient.on",group:"ambient",type:"boolean"}),"ambient.color":S(t,{name:"ambient.color",group:"ambient",type:"color"}),"wind.force":S(t,{name:"wind.force",group:"wind",type:"vec3"})};for(const r of Object.entries(n)){const[o,c]=r;this.properties[o]=c}const i={};for(const r of Object.entries(i)){const[o,c]=r;this.actions[o]=c}delete this.actions.clone;const a={enter:oe({name:"enter"}),leave:oe({name:"leave"})};Object.entries(a).forEach(([r,o])=>{this.events[r]=o})}}l(Kn,"runtime",ke);let fe=null;const Ve=new Ui;Ve.domElement.style.position="absolute";Ve.domElement.style.top="0px";Ve.domElement.style.right="160px";Ve.domElement.style.left="unset";document.body.appendChild(Ve.domElement);function ao(s){return delete s.images,s}class xt extends Be{constructor(e,t){super(e,t);l(this,"clock");l(this,"renderer");l(this,"camera");l(this,"listener");l(this,"scene2d");l(this,"camera2d");l(this,"dom",null);l(this,"shadow",null);l(this,"canvas");l(this,"obs",null);l(this,"font",null);l(this,"paths",{});l(this,"materials",{});l(this,"textures",{});l(this,"images",[]);l(this,"sounds",{});l(this,"working",!1);l(this,"scene");fe=this;const n={width:604,height:480};this.canvas=document.createElement("canvas"),this.canvas.style.transformOrigin="top left",this.clock=new Ri,this.renderer=new Ni({canvas:this.canvas,antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(n.width,n.height),this.renderer.outputEncoding=Dn,this.renderer.shadowMap.enabled=!0,this.renderer.autoClear=!1,this.renderer.physicallyCorrectLights=!0,this.renderer.toneMapping=Pi,this.camera=new Vi(50,n.width/n.height,1,100),this.camera.position.set(0,1,4),this.listener=new Hi,this.camera.add(this.listener),this.scene2d=new En,this.camera2d=new qi(0,n.width,0,-n.height,-100,100)}resize(){if(!this.dom)return;const e={width:this.dom.offsetWidth,height:this.dom.offsetHeight};this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.style.width=e?`${e.width}px`:"",this.canvas.style.height=e?`${e.height}px`:"",this.renderer.setSize(e.width,e.height),this.camera.aspect=e.width/e.height,this.camera.updateProjectionMatrix(),this.scene2d.rotation.x=Math.PI,this.camera2d.right=e.width,this.camera2d.bottom=-e.height,this.camera2d.updateProjectionMatrix()}async start(){if(this.working)throw new Error("already working");this.working=!0;const t=1e3/30;let n;const i=a=>{if(!this.working)return;window.requestAnimationFrame(i),n===void 0&&(n=a),a-n>t&&(n=a,this.update(),this.render())};window.requestAnimationFrame(i)}getFont(){return this.font}get({name:e}){const t=super.get({name:e});if(t!==void 0)return t;const n={"light.physicallyCorrect":()=>this.renderer.physicallyCorrectLights,scene:()=>{var i;return(i=this.scene)==null?void 0:i.uuid},"camera.position":()=>({x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z}),"camera.rotation":()=>({x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}),"camera.anchor":()=>{var i;return(i=this.camera.parent)==null?void 0:i.uuid}}[e];return n==null?void 0:n()}set({name:e,value:t}){if(e==="scene"){const n=t?t.uuid||t:void 0;if(n!==void 0){const i=this.children[n];if(i){if(!(i instanceof ke))throw new Error(`scene is not Scene: ${n}`)}else throw new Error(`scene not found: ${n}`)}super.set({name:e,value:n})}else if(e==="camera.anchor"){const n=t?t.uuid||t:void 0;if(n!==void 0){const a=this.parent.findUnit({uuid:n});if(!a)throw new Error(`chick not found: ${n}`);if(!(a instanceof le))throw new Error(`chick is not Phynit: ${n}`)}super.set({name:e,value:n})}else super.set({name:e,value:t});if(e==="light.physicallyCorrect")this.renderer.physicallyCorrectLights=t;else if(e==="scene")if(typeof t=="string"){const n=this.children[t];if(!n)throw new Error(`scene not found: ${t}`);this.scene=n}else this.scene=t;else if(e==="camera.position")this.camera.position.set(t.x,t.y,t.z);else if(e==="camera.rotation")this.camera.rotation.set(t.x,t.y,t.z);else if(e==="camera.anchor")if(this.camera.parent&&this.camera.parent.remove(this.camera),typeof t=="string"){const i=this.parent.findUnit({uuid:t});if(!i)throw new Error(`chick not found: ${t}`);i.object.add(this.camera)}else t&&t.object.add(this.camera)}async setup(e){this.paths=e;const t=new Wi;this.font=await t.loadAsync(e.font),this.images=(await fetch(this.paths.texture).then(a=>a.json())).map(a=>[a,`${this.paths.texture}/${a}`]);const n=await fetch(this.paths.sounds).then(a=>a.json()),i=new Yi;this.sounds={},await Promise.all(n.map(async a=>{const r=await i.loadAsync(`${this.paths.sounds}/${a}`),o=a.replace(/\..+$/,"");this.sounds[o]={filename:a,buffer:r}}))}attach(e){this.dom&&this.dettach(),this.dom=e,this.shadow=e.attachShadow({mode:"open"}),this.shadow.appendChild(this.canvas),this.obs=new ResizeObserver(()=>{this.resize()}),this.obs.observe(e),this.resize(),this.start()}dettach(){var e;this.dom&&((e=this.obs)==null||e.unobserve(this.dom),this.dom=null)}appendChild(e){if(!(e instanceof le)&&!(e instanceof ke))throw new Error("Not allowed.");super.appendChild(e),e instanceof Nt&&this.scene2d.add(e.object)}removeChild(e){super.removeChild(e),e instanceof Nt&&this.scene2d.remove(e.object)}update(){const e=Date.now(),t=this.clock.getDelta();if(!(t<=0))for(const n of Object.values(this.children))n.update(t,e,null,null)}render(){this.renderer.clear(),this.scene&&this.scene.render(this.renderer,this.camera),this.renderer.render(this.scene2d,this.camera2d),Ve.update()}reset(){const e=t=>{for(const[n,i]of Object.entries(t.properties))t.set({name:n,value:i});for(const n of Object.values(t.children)){if(n.cloned){delete t.children[n.uuid];continue}else if(!n.isPhynit&&!n.isScene)continue;e(n)}};e(this)}to3D({xy:e,z:t}){return{x:e.x*2-1,y:-e.y*2+2,z:t||0}}getMaterialFromId(e){return this.materials[e]}getImages(){return this.images}getMaterials(){return this.materials}addMaterial(e){if(this.materials[e.uuid])throw new Error("Material already exists.");this.materials[e.uuid]=e}removeMaterial(e){if(!this.materials[e])throw new Error("Material not found.");delete this.materials[e]}getTextures(){return this.textures}getTextureFromName(e){const t=Object.values(this.textures).find(n=>n.name===e);return t==null?void 0:t.value}async addTexture(e){const t=await new As().loadAsync(`${this.paths.texture}/${e}`),n={name:e,value:t};return this.textures[t.uuid]=n,n}removeTexture(e){if(!this.textures[e])throw new Error("Texture not found.");delete this.textures[e]}getScenes(){return Object.values(this.children).filter(e=>e.isScene)}enterScene(e){const t=this.children[e];if(!t)throw new Error("Scene not found.");if(!(t instanceof ke))throw new Error("Not a scene.");this.scene&&this.scene.emit("leave",{}),this.scene=t,t.emit("leave",{})}async loadUserData(e){const{materials:t,textures:n}=e,i=new Xi;this.textures={};const a={};if(n)for(const[r,o]of Object.entries(n)){const c=o.name||o,u=await new As().loadAsync(`${this.paths.texture}/${c}`);u.uuid=r;const h=o.value;if(h)for(const d of Object.entries(h)){const[p,f]=d;["metadata","image"].includes(p)||(p==="repeat"?u.repeat.set(f[0],f[1]):p==="offset"?u.offset.set(f[0],f[1]):p==="center"?u.center.set(f[0],f[1]):p==="wrap"?(u.wrapS=f[0],u.wrapT=f[1]):u[p]=f)}this.textures[r]={name:c,value:u},a[c]=!0}if(i.setTextures(Object.fromEntries(Object.entries(this.textures).map(([r,{value:o}])=>[r,o]))),this.materials={},t)for(const[r,o]of Object.entries(t)){const c=i.parse(o);this.materials[r]=c}}packUserData(){const e=Object.fromEntries(Object.entries(this.textures).map(([t,{value:n}])=>[t,n]));return{materials:Object.fromEntries(Object.entries(this.materials).map(([t,n])=>[t,ao(n.toJSON({textures:e}))])),textures:Object.fromEntries(Object.entries(this.textures).map(([t,n])=>[t,{name:n.name,value:n.value.toJSON(void 0)}]))}}}l(xt,"type","screen"),l(xt,"clsname","screen"),l(xt,"clsid",P.screen);class ei extends Fe{constructor(e,t){super(e,t);l(this,"camera");l(this,"canvas");l(this,"raycaster",new Sn);l(this,"pointer",new Qt);l(this,"onUpPosition",new Qt);l(this,"onDownPosition",new Qt);l(this,"orbit");l(this,"controls");l(this,"axesHelper");l(this,"cbChanged");const n=this.instance,{canvas:i,camera:a,renderer:r,scene:o,light:c}=t;this.canvas=i,this.camera=a,this.axesHelper=new Gi(5),this.orbit=new Ji(a,r.domElement),this.orbit.addEventListener("change",n.render.bind(n)),this.orbit.maxPolarAngle=Math.PI/2,this.orbit.enableZoom=!1,this.orbit.enablePan=!1,this.orbit.enableDamping=!1,this.orbit.update(),this.controls=new Qi(a,r.domElement),this.controls.addEventListener("change",d=>{n.render()}),this.controls.addEventListener("dragging-changed",d=>{this.orbit.enabled=!d.value}),(o==null?void 0:o.scene)&&(o.scene.add(this.controls),o.scene.add(this.axesHelper)),r.domElement.addEventListener("pointerdown",this.onPointerDown.bind(this)),r.domElement.addEventListener("pointerup",this.onPointerUp.bind(this)),r.domElement.addEventListener("pointermove",this.onPointerMove.bind(this));const u={scene:S(t,{name:"scene",type:"unit",label:"scene.default"}),"camera.position":S(t,{name:"camera.position",group:"camera",type:"vec3"}),"camera.rotation":S(t,{name:"camera.rotation",group:"camera",type:"vec3"}),"camera.anchor":S(t,{name:"camera.anchor",group:"camera",type:"unit"})};for(const d of Object.entries(u)){const[p,f]=d;this.properties[p]=f}const h={to3D:class extends A{constructor(d){super(d,"to3D");l(this,"slots",{xy:B({name:"xy",data:{type:"vec2"},required:!0}),z:B({name:"z",data:{type:"number"}})});l(this,"output",{type:"vec3",name:".",label:"result",description:"result-desc"})}}};for(const d of Object.entries(h)){const[p,f]=d;this.actions[p]=f}delete this.actions.clone}onPointerDown(e){var n;this.onDownPosition.x=e.clientX,this.onDownPosition.y=e.clientY;const t=(n=this.instance.scene)==null?void 0:n.scene;t&&!this.controls.object&&t.attach(this.controls)}onPointerUp(e){if(this.onUpPosition.x=e.clientX,this.onUpPosition.y=e.clientY,this.controls.object){const{uid:t}=this.controls.object.userData,n=this.egg.findUnit(t);if(n){const i=this.controls.object.position,a=n.instance.properties.position||{};(i.x!==a.x||i.y!==a.y||i.z!==a.z)&&(n.instance.properties.position={x:i.x,y:i.y,z:i.z},this.cbChanged&&this.cbChanged(n))}}this.onDownPosition.distanceTo(this.onUpPosition)===0&&this.controls.detach()}onPointerMove(e){this.pointer.x=(e.clientX-this.canvas.offsetLeft)/this.canvas.clientWidth*2-1,this.pointer.y=-((e.clientY-this.canvas.offsetTop)/this.canvas.clientHeight)*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const t=this.instance.scene;if(t){const n=this.raycaster.intersectObjects(Object.values(t.children).map(i=>i.object),!1);if(n.length>0){const i=n[0].object;i!==this.controls.object&&this.controls.attach(i)}}}setupObsever(e){this.cbChanged=e}afterLoad(){var t;const e=(t=this.instance.scene)==null?void 0:t.scene;e&&(e.add(this.controls),e.add(this.axesHelper))}setCurrentScene(e){var n,i;let t=(n=this.instance.scene)==null?void 0:n.scene;t&&(t.remove(this.controls),t.remove(this.axesHelper)),this.instance.enterScene(e.uuid),t=(i=this.instance.scene)==null?void 0:i.scene,t&&(t.add(this.controls),t.add(this.axesHelper))}getScenes(){return Object.values(this.children).filter(e=>e.instance.isScene)}}l(ei,"runtime",xt);const ro=`
  varying vec2 vUv;
  void main( void ) {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
  }`,oo=`
  uniform vec3 keyColor;
  uniform float similarity;
  uniform float smoothness;
  varying vec2 vUv;
  uniform sampler2D map;
  void main() {
      vec4 videoColor = texture2D(map, vUv);

      float Y1 = 0.299 * keyColor.r + 0.587 * keyColor.g + 0.114 * keyColor.b;
      float Cr1 = keyColor.r - Y1;
      float Cb1 = keyColor.b - Y1;

      float Y2 = 0.299 * videoColor.r + 0.587 * videoColor.g + 0.114 * videoColor.b;
      float Cr2 = videoColor.r - Y2;
      float Cb2 = videoColor.b - Y2;

      float blend = smoothstep(similarity, similarity + smoothness, distance(vec2(Cr2, Cb2), vec2(Cr1, Cb1)));
      gl_FragColor = vec4(videoColor.rgb, videoColor.a * blend);
  }`;class wt extends Be{constructor(){super(...arguments);l(this,"camera");l(this,"fpsTick",0)}async open(){if(this.camera)throw new Error("Camera is already started.");const e={},t=document.createElement("video");t.style.position="absolute",t.style.right="0",t.style.bottom="0",t.style.pointerEvents="none",t.style.transform="scaleX(-1)",t.width=400,t.height=320,document.body.appendChild(t),e.webcam=t;const n={video:{width:400,height:320}};navigator.mediaDevices.getUserMedia(n).then(r=>{t.srcObject=r,t.onloadedmetadata=()=>{t.setAttribute("autoplay","true"),t.setAttribute("playsinline","true"),t.play()}}).catch(function(r){alert(r.name+": "+r.message)}),e.webcamCanvas=document.createElement("canvas");const i=e.webcamCanvas.getContext("2d");e.canvasCtx=i,i.fillStyle="#000000",i.fillRect(0,0,e.webcamCanvas.width,e.webcamCanvas.height);const a=new Zi(e.webcamCanvas);e.webcamTexture=a,a.minFilter=Lt,a.magFilter=Lt,e.shaderMaterial=new Cn({transparent:!0,uniforms:{map:{value:a},keyColor:{value:[0,1,0]},similarity:{value:.3},smoothness:{value:0}},vertexShader:ro,fragmentShader:oo}),this.camera=e,requestAnimationFrame(this.animate.bind(this))}async close(){if(!this.camera)throw new Error("Camera is not started.");this.camera.webcam.pause(),this.camera.webcam.srcObject=null,this.camera=void 0}clone(){throw new Error("Not allowed.")}get({name:e}){var n,i;if(e==="frame")return(n=this.camera)==null?void 0:n.shaderMaterial;if(e==="element")return(i=this.camera)==null?void 0:i.webcam;const t=super.get({name:e});if(t!==void 0)return t;if(e==="fps")return 30}animate(e){if(this.camera){if(!this.parent.isRunning())return this.close()}else return;const t=this.get({name:"fps"});if(1e3/t>e-this.fpsTick){requestAnimationFrame(this.animate.bind(this));return}this.fpsTick=e,this.emit("frame",{}).finally(()=>{requestAnimationFrame(this.animate.bind(this))})}}l(wt,"type","camera"),l(wt,"clsname","camera"),l(wt,"clsid",P.camera);class ti extends Fe{constructor(e,t){super(e,t);const n={open:class extends A{constructor(r){super(r,"open")}},close:class extends A{constructor(r){super(r,"close")}}};for(const r of Object.entries(n)){const[o,c]=r;this.actions[o]=c}const i={frame:oe({name:"frame",params:{image:{type:"material",name:"image"}}})};Object.entries(i).forEach(([r,o])=>{this.events[r]=o});const a={fps:S(t,{name:"fps",type:"number",min:10,max:60}),frame:S(t,{name:"frame",type:"material",readonly:!0}),element:S(t,{name:"element",type:"unknown",readonly:!0})};for(const r of Object.entries(a)){const[o,c]=r;this.properties[o]=c}}}l(ti,"runtime",wt);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function lo(){return kn("./assets/models/gesture/handdetector/model.json",{fromTFHub:!1})}const tn=256,sn=256;async function co(){return kn("./assets/models/gesture/handskeleton/model.json",{fromTFHub:!1})}async function uo(){return ta("./assets/models/gesture/anchors.json").then(s=>s.json())}async function ho({maxContinuousChecks:s=1/0,detectionConfidence:e=.8,iouThreshold:t=.3,scoreThreshold:n=.5}={}){const[i,a,r]=await Promise.all([uo(),lo(),co()]),o=new Ki(a,tn,sn,i,t,n),c=new ea(o,r,tn,sn,s,e);return new fo(c)}function po(s){return s instanceof Mn?[s.shape[0],s.shape[1]]:[s.height,s.width]}function mo(s,e){const{handInViewConfidence:t,landmarks:n,boundingBox:i}=s;return{handInViewConfidence:t,landmarks:n.map(a=>[e-1-a[0],a[1],a[2]]),boundingBox:{topLeft:[e-1-i.topLeft[0],i.topLeft[1]],bottomRight:[e-1-i.bottomRight[0],i.bottomRight[1]]}}}class fo{constructor(e){this.pipeline=e}static getAnnotations(){return Zt}async estimateHands(e,t=!1){const[,n]=po(e),i=sa(()=>(e instanceof Mn||(e=na(e)),ia(aa(e,"float32")))),a=await this.pipeline.estimateHand(i);if(i.dispose(),a===null)return[];let r=a;t===!0&&(r=mo(a,n));const o={};for(const c of Object.keys(Zt))o[c]=Zt[c].map(u=>r.landmarks[u]);return[{handInViewConfidence:r.handInViewConfidence,boundingBox:r.boundingBox,landmarks:r.landmarks,annotations:o}]}}var _=(s=>(s[s.Thumb=0]="Thumb",s[s.Index=1]="Index",s[s.Middle=2]="Middle",s[s.Ring=3]="Ring",s[s.Pinky=4]="Pinky",s))(_||{});(s=>{s.all=[0,1,2,3,4];const e={[0]:"Thumb",[1]:"Index",[2]:"Middle",[3]:"Ring",[4]:"Pinky"},t={[0]:[[0,1],[1,2],[2,3],[3,4]],[1]:[[0,5],[5,6],[6,7],[7,8]],[2]:[[0,9],[9,10],[10,11],[11,12]],[3]:[[0,13],[13,14],[14,15],[15,16]],[4]:[[0,17],[17,18],[18,19],[19,20]]};function n(a){return e[a]}s.getName=n;function i(a){return t[a]||!1}s.getPoints=i})(_||(_={}));var N=(s=>(s[s.NoCurl=0]="NoCurl",s[s.HalfCurl=1]="HalfCurl",s[s.FullCurl=2]="FullCurl",s))(N||{});(s=>{const e={[0]:"No Curl",[1]:"Half Curl",[2]:"Full Curl"};function t(n){return e[n]}s.getName=t})(N||(N={}));var D=(s=>(s[s.VerticalUp=0]="VerticalUp",s[s.VerticalDown=1]="VerticalDown",s[s.HorizontalLeft=2]="HorizontalLeft",s[s.HorizontalRight=3]="HorizontalRight",s[s.DiagonalUpRight=4]="DiagonalUpRight",s[s.DiagonalUpLeft=5]="DiagonalUpLeft",s[s.DiagonalDownRight=6]="DiagonalDownRight",s[s.DiagonalDownLeft=7]="DiagonalDownLeft",s))(D||{});(s=>{const e={0:"Vertical Up",1:"Vertical Down",2:"Horizontal Left",3:"Horizontal Right",4:"Diagonal Up Right",5:"Diagonal Up Left",6:"Diagonal Down Right",7:"Diagonal Down Left"};function t(n){return e[n]}s.getName=t})(D||(D={}));class go{constructor(e){l(this,"options");this.options=de({HALF_CURL_START_LIMIT:60,NO_CURL_START_LIMIT:130,DISTANCE_VOTE_POWER:1.1,SINGLE_ANGLE_VOTE_POWER:.9,TOTAL_ANGLE_VOTE_POWER:1.6},e)}estimate(e){const t=[];for(const a of _.all){const r=_.getPoints(a),o=[],c=[];for(const u of r){const h=e[u[0]],d=e[u[1]],p=this.getSlopes(h,d);if(!Array.isArray(p))throw"unknown slopes";const f=p[0],g=p[1];o.push(f),c.push(g)}t.push(o)}const n=[],i=[];for(const a of _.all){const r=a==_.Thumb?1:0,o=_.getPoints(a),c=e[o[r][0]],u=e[o[r+1][1]],h=e[o[3][1]],d=this.estimateFingerCurl(c,u,h),p=this.calculateFingerDirection(c,u,h,t[a].slice(r));n[a]=d,i[a]=p}return{curls:n,directions:i}}getSlopes(e,t){const n=this.calculateSlope(e[0],e[1],t[0],t[1]);if(e.length==2)return n;const i=this.calculateSlope(e[1],e[2],t[1],t[2]);return[n,i]}angleOrientationAt(e,t=1){let n=0,i=0,a=0;return e>=75&&e<=105?n=1*t:e>=25&&e<=155?i=1*t:a=1*t,[n,i,a]}estimateFingerCurl(e,t,n){const i=e[0]-t[0],a=e[0]-n[0],r=t[0]-n[0],o=e[1]-t[1],c=e[1]-n[1],u=t[1]-n[1],h=e[2]-t[2],d=e[2]-n[2],p=t[2]-n[2],f=Math.sqrt(i*i+o*o+h*h),g=Math.sqrt(a*a+c*c+d*d),b=Math.sqrt(r*r+u*u+p*p);let E=(b*b+f*f-g*g)/(2*b*f);E>1?E=1:E<-1&&(E=-1);let T=Math.acos(E);T=57.2958*T%180;let M;return T>this.options.NO_CURL_START_LIMIT?M=N.NoCurl:T>this.options.HALF_CURL_START_LIMIT?M=N.HalfCurl:M=N.FullCurl,M}estimateHorizontalDirection(e,t,n,i){let a;return i==Math.abs(e)?e>0?a=D.HorizontalLeft:a=D.HorizontalRight:i==Math.abs(t)?t>0?a=D.HorizontalLeft:a=D.HorizontalRight:n>0?a=D.HorizontalLeft:a=D.HorizontalRight,a}estimateVerticalDirection(e,t,n,i){let a;return i==Math.abs(e)?e<0?a=D.VerticalDown:a=D.VerticalUp:i==Math.abs(t)?t<0?a=D.VerticalDown:a=D.VerticalUp:n<0?a=D.VerticalDown:a=D.VerticalUp,a}estimateDiagonalDirection(e,t,n,i,a,r,o,c){let u;const h=this.estimateVerticalDirection(e,t,n,i),d=this.estimateHorizontalDirection(a,r,o,c);return h==D.VerticalUp?d==D.HorizontalLeft?u=D.DiagonalUpLeft:u=D.DiagonalUpRight:d==D.HorizontalLeft?u=D.DiagonalDownLeft:u=D.DiagonalDownRight,u}calculateFingerDirection(e,t,n,i){const a=e[0]-t[0],r=e[0]-n[0],o=t[0]-n[0],c=e[1]-t[1],u=e[1]-n[1],h=t[1]-n[1],d=Math.max(Math.abs(a),Math.abs(r),Math.abs(o)),p=Math.max(Math.abs(c),Math.abs(u),Math.abs(h));let f=0,g=0,b=0;const E=p/(d+1e-5);E>1.5?f+=this.options.DISTANCE_VOTE_POWER:E>.66?g+=this.options.DISTANCE_VOTE_POWER:b+=this.options.DISTANCE_VOTE_POWER;const T=Math.sqrt(a*a+c*c),M=Math.sqrt(r*r+u*u),x=Math.sqrt(o*o+h*h),O=Math.max(T,M,x);let L=e[0],I=e[1],U=n[0],G=n[1];O==T?(U=n[0],G=n[1]):O==x&&(L=t[0],I=t[1]);const te=[L,I],ue=[U,G],J=this.getSlopes(te,ue),qe=this.angleOrientationAt(J,this.options.TOTAL_ANGLE_VOTE_POWER);f+=qe[0],g+=qe[1],b+=qe[2];for(const _i of i){const Gt=this.angleOrientationAt(_i,this.options.SINGLE_ANGLE_VOTE_POWER);f+=Gt[0],g+=Gt[1],b+=Gt[2]}let st;return f==Math.max(f,g,b)?st=this.estimateVerticalDirection(u,c,h,p):b==Math.max(g,b)?st=this.estimateHorizontalDirection(r,a,o,d):st=this.estimateDiagonalDirection(u,c,h,p,r,a,o,d),st}calculateSlope(e,t,n,i){const a=(t-i)/(e-n);let r=Math.atan(a)*180/Math.PI;return r<=0?r=-r:r>0&&(r=180-r),r}}class yo{constructor(e,t={}){l(this,"estimator");l(this,"gestures");this.estimator=new go(t),this.gestures=e}estimate(e,t){const n=[],i=this.estimator.estimate(e),a=[];for(const r of _.all)a.push([_.getName(r),N.getName(i.curls[r]),D.getName(i.directions[r])]);for(const[r,o]of Object.entries(this.gestures)){const c=o.matchAgainst(i.curls,i.directions);c>=t&&n.push({name:r,confidence:c})}return{poseData:a,gestures:n}}}class Yt{constructor(e){l(this,"name");l(this,"curls");l(this,"directions");l(this,"weights");l(this,"weightsRelative");this.name=e,this.curls={},this.directions={},this.weights=[1,1,1,1,1],this.weightsRelative=[1,1,1,1,1]}addCurl(e,t,n){typeof this.curls[e]=="undefined"&&(this.curls[e]=[]),this.curls[e].push([t,n])}addDirection(e,t,n){typeof this.directions[e]=="undefined"&&(this.directions[e]=[]),this.directions[e].push([t,n])}setWeight(e,t){this.weights[e]=t;const n=this.weights.reduce((i,a)=>i+a,0);this.weightsRelative=this.weights.map(i=>i*5/n)}matchAgainst(e,t){let n=0;for(const i in e){const a=e[i],r=this.curls[i];if(typeof r=="undefined"){n+=this.weightsRelative[i];continue}for(const[o,c]of r)if(a==o){n+=c*this.weightsRelative[i];break}}for(const i in t){const a=t[i],r=this.directions[i];if(typeof r=="undefined"){n+=this.weightsRelative[i];continue}for(const[o,c]of r)if(a==o){n+=c*this.weightsRelative[i];break}}return n}}const V=new Yt("victory");V.addCurl(_.Thumb,N.HalfCurl,.5);V.addCurl(_.Thumb,N.NoCurl,.5);V.addDirection(_.Thumb,D.VerticalUp,1);V.addDirection(_.Thumb,D.DiagonalUpLeft,1);V.addCurl(_.Index,N.NoCurl,1);V.addDirection(_.Index,D.VerticalUp,.75);V.addDirection(_.Index,D.DiagonalUpLeft,1);V.addCurl(_.Middle,N.NoCurl,1);V.addDirection(_.Middle,D.VerticalUp,1);V.addDirection(_.Middle,D.DiagonalUpLeft,.75);V.addCurl(_.Ring,N.FullCurl,1);V.addDirection(_.Ring,D.VerticalUp,.2);V.addDirection(_.Ring,D.DiagonalUpLeft,1);V.addDirection(_.Ring,D.HorizontalLeft,.2);V.addCurl(_.Pinky,N.FullCurl,1);V.addDirection(_.Pinky,D.VerticalUp,.2);V.addDirection(_.Pinky,D.DiagonalUpLeft,1);V.addDirection(_.Pinky,D.HorizontalLeft,.2);V.setWeight(_.Index,2);V.setWeight(_.Middle,2);const we=new Yt("thumbs_up");we.addCurl(_.Thumb,N.NoCurl,1);we.addDirection(_.Thumb,D.VerticalUp,1);we.addDirection(_.Thumb,D.DiagonalUpLeft,.25);we.addDirection(_.Thumb,D.DiagonalUpRight,.25);for(const s of[_.Index,_.Middle,_.Ring,_.Pinky])we.addCurl(s,N.FullCurl,1),we.addDirection(s,D.HorizontalLeft,1),we.addDirection(s,D.HorizontalRight,1);const He=new Yt("fist");He.addCurl(_.Thumb,N.FullCurl,1);He.addCurl(_.Index,N.FullCurl,1);He.addCurl(_.Middle,N.FullCurl,1);He.addCurl(_.Ring,N.FullCurl,1);He.addCurl(_.Pinky,N.FullCurl,1);const H=new Yt("five");H.addCurl(_.Thumb,N.NoCurl,1);H.addDirection(_.Thumb,D.VerticalUp,.5);H.addDirection(_.Thumb,D.DiagonalUpLeft,.1);H.addDirection(_.Thumb,D.DiagonalUpRight,.5);H.addCurl(_.Index,N.NoCurl,1);H.addDirection(_.Index,D.VerticalUp,1);H.addDirection(_.Index,D.DiagonalUpLeft,.5);H.addDirection(_.Index,D.DiagonalUpRight,.5);H.addCurl(_.Middle,N.NoCurl,1);H.addDirection(_.Middle,D.VerticalUp,1);H.addDirection(_.Middle,D.DiagonalUpLeft,.5);H.addDirection(_.Middle,D.DiagonalUpRight,.5);H.addCurl(_.Ring,N.NoCurl,1);H.addDirection(_.Ring,D.VerticalUp,1);H.addDirection(_.Ring,D.DiagonalUpLeft,.5);H.addDirection(_.Ring,D.DiagonalUpRight,.5);H.addCurl(_.Pinky,N.NoCurl,1);H.addDirection(_.Pinky,D.VerticalUp,1);H.addDirection(_.Pinky,D.DiagonalUpLeft,.5);H.addDirection(_.Pinky,D.DiagonalUpRight,.5);const bo={"thumbs-up":we,victory:V,five:H,fist:He};class _t extends Be{constructor(e,t){super(e,t);l(this,"element",null);l(this,"model");l(this,"estimator");l(this,"previous");l(this,"ma",[{score:0,position:{x:0,y:0},name:"none"},{score:0,position:{x:0,y:0},name:"none"}]);this.previous=""}async open(){if(this.element)throw"already started";const e=this.parent;if(!e)throw"invalid chick instance";const{camera:t}=e.devices;if(!t)throw"camer not found";const{element:n}=t.properties;this.element=n,this.model||(this.model=await ho(),this.estimator=new yo(bo))}async close(){if(!this.element)throw"not started";this.element=null}async detect(){if(!this.model||!this.estimator)throw"not started";if(this.element.readyState!==this.element.HAVE_ENOUGH_DATA)return"";const e=await this.model.estimateHands(this.element,!0),t={score:-1,name:"none",position:{x:0,y:0}};for(let a=0;a<e.length;a++){const r={x:0,y:0};let o=0;for(const u in e[a].annotations)for(const h of e[a].annotations[u])r.x+=h[0],r.y+=h[1],o++;o&&(r.x=r.x/o,r.y=r.y/o);const c=this.estimator.estimate(e[a].landmarks,7.5);if(c.gestures.length>0){const u=c.gestures.reduce((h,d)=>h.confidence>d.confidence?h:d);u.confidence>t.score&&(t.score=u.confidence,t.name=u.name,t.position=r)}}const[n,i]=this.ma;return i.name!==t.name?n.name==t.name?this.ma[1]=t:this.ma[0]=t:(this.ma[0]=i,this.ma[1]=t,i.name!=="none"&&(this.previous=t.name,await this.emit("gesture",{name:i.name,detail:i}))),t.name}get({name:e}){return e==="current"?this.previous:super.get({name:e})}}l(_t,"type","gesture"),l(_t,"clsname","gesture"),l(_t,"clsid",P.gesture);class si extends Fe{constructor(e,t){super(e,t);const n={current:S(t,{name:"current",type:"string",readonly:!0})};for(const a of Object.entries(n)){const[r,o]=a;this.properties[r]=o}const i={open:class extends A{constructor(a){super(a,"open")}},close:class extends A{constructor(a){super(a,"close")}},detect:class extends A{constructor(a){super(a,"detect");l(this,"output",{type:"string",name:".",label:"result",description:"result-desc"})}}};for(const a of Object.entries(i)){const[r,o]=a;this.actions[r]=o}delete this.actions.clone,this.events.gesture=oe({name:"gesture",params:{name:{type:"string",name:"name",values:["thumbs-up","victory","five","fist"]}}})}}l(si,"runtime",_t);const vo="MobileNetV1",xo=2,wo=.5,_o=16,Eo=200;class Et extends Be{constructor(){super(...arguments);l(this,"element",null);l(this,"model");l(this,"ma",{})}async open(){if(this.element)throw"already opened";const e=this.parent;if(!e)throw"invalid chick instance";const{camera:t}=e.devices;if(!t)throw"camer not found";const{element:n}=t.properties;this.element=n,this.model||(this.model=await ra({architecture:vo,outputStride:_o,inputResolution:Eo,multiplier:wo,quantBytes:xo}))}async close(){if(!this.element)throw"not started";this.element=null}async detect(){if(!this.model||!this.element||this.element.readyState!==this.element.HAVE_ENOUGH_DATA)return;const e=await this.model.estimateSinglePose(this.element,{flipHorizontal:!0});if(e&&this.element){const{width:t,height:n}=this.element,i=this.get({name:"confidence"})||.5,a={};e.keypoints.forEach(({part:r,position:o,score:c})=>{if(c>=i){const u=this.ma[r]||(this.ma[r]=[{x:o.x,y:o.y},{x:o.x,y:o.y}]),[h,d]=u,p={x:h.x+(d.x-h.x)*.5,y:h.y+(d.y-h.y)*.5},f={x:p.x+(o.x-p.x)*.5,y:p.y+(o.y-p.y)*.5};u[0]=d,u[1]=f,a[r]={x:f.x/t,y:f.y/n}}}),await this.emit("pose",{detail:a})}}}l(Et,"type","pose"),l(Et,"clsname","pose"),l(Et,"clsid",P.pose);class ni extends Fe{constructor(e,t){super(e,t);const n={confidence:S(t,{name:"confidence",type:"number",min:.1,max:1,step:.1})};for(const a of Object.entries(n)){const[r,o]=a;this.properties[r]=o}const i={open:class extends A{constructor(a){super(a,"open")}},close:class extends A{constructor(a){super(a,"close")}},detect:class extends A{constructor(a){super(a,"detect")}}};for(const a of Object.entries(i)){const[r,o]=a;this.actions[r]=o}this.events.pose=oe({name:"pose",params:{detail:{type:"json",name:"detail"}}})}}l(ni,"runtime",Et);var Do=[ei,ti,si,ni];class Dt extends le{constructor(e,t){const n=new Me(new De(1,1),new Ht({color:4095,depthWrite:!1}));super(e,t,{object:n})}}l(Dt,"type","object"),l(Dt,"clsname","plane"),l(Dt,"clsid",P.plane);class us extends _e{}l(us,"runtime",Dt),l(us,"tags",["shape","3d"]);class St extends Nt{constructor(e,t,{font:n}){const i=new oa;super(e,t,{object:i});l(this,"group");l(this,"textMesh",null);l(this,"textGeo",null);l(this,"font");this.font=n,this.group=i,this.updateText()}get({name:e}){const t=super.get({name:e});if(t===void 0)switch(e){case"size":return 32;case"opacity":return 1}return t}set({name:e,value:t}){super.set({name:e,value:t}),["text","size","height"].includes(e)?this.updateText():e==="color"?this.textMesh&&this.textMesh.material.color.set(t):e==="opacity"?this.textMesh&&(this.textMesh.material.opacity=t):["align","valign"].includes(e)&&this.updateAlign()}updateText(){const e=this.get({name:"text"});if(!e)return;const t=this.get({name:"size"}),n=this.get({name:"color"}),i=this.get({name:"opacity"}),a=this.font.generateShapes(e.toString(),t),r=new la(a);if(r.computeBoundingBox(),!!r.boundingBox){if(this.textMesh)this.textMesh.geometry=r;else{const o=new ca({color:n,transparent:!0,opacity:i,side:Ut}),c=new Me(r,o);c.position.x=0,c.position.y=0,c.position.z=0,c.rotation.x=0,c.rotation.y=Math.PI,c.rotation.z=Math.PI,this.group.add(c),this.textMesh=c}this.textGeo=r,this.updateAlign()}}updateAlign(){const e=this.textGeo;if(!this.textMesh||!(e==null?void 0:e.boundingBox))return;const t=.5*(e.boundingBox.max.x-e.boundingBox.min.x),n=this.get({name:"align"})||"center";n==="left"?this.textMesh.position.x=0:n==="center"?this.textMesh.position.x=-t:this.textMesh.position.x=-2*t;const i=.5*(e.boundingBox.max.y-e.boundingBox.min.y),a=this.get({name:"valign"})||"middle";a==="top"?this.textMesh.position.y=e.boundingBox.min.y+2*i:a==="middle"?this.textMesh.position.y=e.boundingBox.min.y+i:this.textMesh.position.y=e.boundingBox.min.y}static async create(e,t,n){const i=(n==null?void 0:n.font)||fe.getFont();if(!i)throw new Error("font not found");return super.create(e,t,Object.assign({},n||{},{font:i}))}}l(St,"type","object"),l(St,"clsname","text"),l(St,"clsid",P.text);class ds extends io{constructor(e,t,n){super(e,t,n);const i={text:S(t,{name:"text",type:"string"}),size:S(t,{name:"size",type:"number"}),align:S(t,{name:"align",type:"string",values:[{value:"left",label:"text.align.left"},{value:"center",label:"text.align.center"},{value:"right",label:"text.align.right"}]}),valign:S(t,{name:"valign",type:"string",values:[{value:"top",label:"text.align.top"},{value:"middle",label:"text.align.middle"},{value:"bottom",label:"text.align.bottom"}]}),color:S(t,{name:"color",type:"color"}),opacity:S(t,{name:"opacity",type:"number",min:0,max:1})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}delete this.properties.scale,delete this.properties.rotation,delete this.properties.material}}l(ds,"runtime",St),l(ds,"tags",["text","2d"]);class Ct extends le{constructor(e,t){const n=new ua({color:6710886,emissive:16711680}),i=new os(1,32,16),a=new Me(i,n),r=new Ze({mass:1,material:new qt,shape:new da(1)});super(e,t,{object:a,physics:r})}get({name:e}){const t=super.get({name:e});if(t!==void 0)return t;const n=this.object.geometry;if(e==="radius")return n.parameters.radius}set({name:e,value:t}){var i;super.set({name:e,value:t});const n=this.object.geometry;if(e==="radius"){if(t===n.parameters.radius)return;const a=this.object,r=new os(t||1,n.parameters.widthSegments,n.parameters.heightSegments);if(a.geometry=r,a.matrixWorldNeedsUpdate=!0,(i=this.physics)==null?void 0:i.shapes[0]){const o=this.physics.shapes[0];o.radius=t}}}}l(Ct,"type","object"),l(Ct,"clsname","sphere"),l(Ct,"clsid",P.sphere);class hs extends _e{constructor(e,t,n){super(e,t,n);const i={radius:S(t,{name:"radius",type:"number"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}}}l(hs,"runtime",Ct),l(hs,"tags",["shape","3d"]);class kt extends le{constructor(e,t){const n=new Me(new nt(1,1,1),new Ht({color:4095,depthWrite:!1})),i=new Ze({mass:1,material:new qt,shape:new ha(new Ie(.5,.5,.5))});super(e,t,{object:n,physics:i})}get({name:e}){const t=super.get({name:e});if(t===void 0){const i=this.object.geometry;switch(e){case"width":return i.parameters.width;case"height":return i.parameters.height;case"depth":return i.parameters.depth}}return t}set({name:e,value:t}){if(super.set({name:e,value:t}),!["width","height","depth"].includes(e))return;const n=this.object,i=n.geometry,r=this.physics.shapes[0];e==="width"?(n.geometry=new nt(t,i.parameters.height,i.parameters.depth),r.halfExtents.x=t/2):e==="height"?(n.geometry=new nt(i.parameters.width,t,i.parameters.depth),r.halfExtents.y=t/2):e==="depth"&&(n.geometry=new nt(i.parameters.width,i.parameters.height,t),r.halfExtents.z=t/2),n.matrixWorldNeedsUpdate=!0}}l(kt,"type","object"),l(kt,"clsname","box"),l(kt,"clsid",P.box);class ps extends _e{constructor(e,t,n){super(e,t,n);const i={width:S(t,{name:"width",type:"number"}),height:S(t,{name:"height",type:"number"}),depth:S(t,{name:"depth",type:"number"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}}}l(ps,"runtime",kt),l(ps,"tags",["shape","3d"]);class Mt extends le{constructor(e,t){const n=new os(.02,16,8),i=new pa(16772744,1,100,2),a=new ma({emissive:16777198,emissiveIntensity:1,color:0});i.add(new Me(n,a)),i.position.set(0,2,0),i.castShadow=!0;super(e,t,{object:i});l(this,"material");this.material=a}get({name:e}){const t=super.get({name:e});if(t!==void 0)return t;const n=this.object;if(e==="distance")return n.distance;if(e==="color")return`#${n.color.getHexString()}`;if(e==="power")return n.power}set({name:e,value:t}){super.set({name:e,value:t});const n=this.object;e==="distance"?n.distance=t:e==="color"?n.color.set(t):e==="power"&&(n.power=t,this.material.emissiveIntensity=n.intensity/Math.pow(.02,2))}}l(Mt,"type","object"),l(Mt,"clsname","bulb"),l(Mt,"clsid",P.bulb);class ms extends _e{constructor(e,t,n){super(e,t,n);const i={power:S(t,{name:"power",type:"number",values:[{value:0,label:"off"},{value:20,label:"4W"},{value:180,label:"25W"},{value:400,label:"40W"},{value:800,label:"60W"},{value:1700,label:"100W"},{value:3500,label:"300W"},{value:11e4,label:"1000W"}]}),color:S(t,{name:"color",type:"color"}),distance:S(t,{name:"distance",type:"number"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}delete this.properties.scale,delete this.properties.rotation,delete this.properties.material}}l(ms,"runtime",Mt),l(ms,"tags",["light","3d"]);const So=`
varying vec2 vUv;

void main() {
	vUv = uv;
	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Co=`
varying vec2 vUv;
uniform sampler2D map;

void main() {
 gl_FragColor = texture2D(map, vUv);
}
`;var nn={fragment:Co,vertex:So};const ko=new fa,Mo=(s,e,t,n,i)=>n+(i-n)*(s-e)/(t-e);class Tt extends le{constructor(e,t){const n=new De(1,1,20,20),i=new Cn({uniforms:{map:{value:0}},vertexShader:nn.vertex,fragmentShader:nn.fragment,side:Ut}),a=new Me(n,i);super(e,t,{object:a});l(this,"shape",new ga);l(this,"pieces",[]);this.reshape()}get({name:e}){const t=super.get({name:e});if(t===void 0){const i=this.object.geometry;switch(e){case"width":return i.parameters.width;case"height":return i.parameters.height;case"widthSegments":return i.parameters.widthSegments;case"heightSegments":return i.parameters.heightSegments}}return t}set({name:e,value:t}){super.set({name:e,value:t});const n=this.object,i=n.geometry;if(e==="width")n.geometry=new De(t,i.parameters.height,i.parameters.widthSegments,i.parameters.heightSegments);else if(e==="height")n.geometry=new De(i.parameters.width,t,i.parameters.widthSegments,i.parameters.heightSegments);else if(e==="widthSegments")n.geometry=new De(i.parameters.width,i.parameters.height,t,i.parameters.heightSegments);else if(e==="heightSegments")n.geometry=new De(i.parameters.width,i.parameters.height,i.parameters.widthSegments,t);else if(e==="position")this.repos();else return;n.matrixWorldNeedsUpdate=!0,this.reshape()}repos(){const t=this.object.geometry,{position:n}=t.attributes;for(let i=0;i<n.count;i++){const a=this.pieces[i],r=a.initPos.clone().applyQuaternion(this.object.quaternion);a.body.position.set(r.x,r.y,r.z)}}reshape(){const e=this.pieces.length?this.pieces[0].body.world:null;e&&this.onWorldTeardown(null,e);const t=[],n=this.properties.mass||1,a=this.object.geometry,{position:r}=a.attributes,o=n/r.count,c=a.parameters.widthSegments,u=a.parameters.heightSegments,h=[];for(let d=0;d<r.count;d++){const p=new Ie(r.getX(d),r.getY(d),r.getZ(d)),f=new Ze({mass:o,linearDamping:.8,position:p,shape:this.shape,material:new qt({friction:.1,restitution:.1})});h.push(f)}for(let d=0;d<=u;d++)for(let p=0;p<=c;p++){const f=[],g=d*(c+1)+p,b=h[g];if(p!==c){const E=h[g+1];f.push(new Kt(b,E))}if(d!==u){const E=h[g+c+1];f.push(new Kt(b,E))}t.push({body:b,constraints:f,initPos:new xe(b.position.x,b.position.y,b.position.z)})}for(let d=0;d<=c;d++){const p=h[d],f=new Ze({mass:0,position:p.position.clone(),shape:this.shape}),g=new Kt(f,p,0);t.push({body:f,constraints:[g],initPos:new xe(f.position.x,f.position.y,f.position.z)})}this.pieces=t,e&&this.onWorldSetup(null,e),this.repos()}onWorldSetup(e,t){this.pieces.forEach(n=>{t&&(t.addBody(n.body),n.constraints.forEach(i=>t.addConstraint(i)))})}onWorldTeardown(e,t){this.pieces.forEach(n=>{n.body.world&&(n.body.world.removeBody(n.body),n.constraints.forEach(i=>t.removeConstraint(i)))})}update(e,t,n,i){const r=this.object.geometry,{position:o}=r.attributes,c=r.parameters.widthSegments,u=r.parameters.heightSegments,h=n.properties["wind.force"]||{x:0,y:0,z:0},d=new Ie(h.x,h.y,h.z);for(let p=0;p<o.count;p++){const f=this.pieces[p],g=f.body.position;o.setXYZ(p,g.x,g.y,g.z);const b=p%c,E=Math.floor(p/u),T=Mo(ko.noise3D(E,b,e*.1),-1,1,-.01,.1),M=d.clone().scale(T);f.body.applyLocalForce(M,Ie.ZERO)}o.needsUpdate=!0}}l(Tt,"type","object"),l(Tt,"clsname","cloth"),l(Tt,"clsid",P.cloth);class fs extends _e{constructor(e,t,n){super(e,t,n);const i={mass:S(t,{name:"mass",type:"number"}),width:S(t,{name:"width",type:"number"}),height:S(t,{name:"height",type:"number"}),widthSegments:S(t,{name:"widthSegments",type:"number"}),heightSegments:S(t,{name:"heightSegments",type:"number"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}}}l(fs,"runtime",Tt),l(fs,"tags",["shape","3d"]);var To=[Kn,us,ds,hs,ps,ms,fs];class an extends Ce{async run(e){this.devices.screen.reset(),await super.run(e)}}class ii extends Jn{constructor(){super(an);l(this,"screen",null);l(this,"screenEditor",null)}async init(e,t,n){return await super.init(To.concat(e),Do.concat(t||[]),n),this.screenEditor=this.devices.screen,this.screen=this.screenEditor.instance,this}}l(ii,"runtime",an);const v=new ii,$o={isLoading:!1,isNetBusy:!1,isPreviewFloating:!1,selected:{unit:null,block:null},var:{scope:"global",name:"",slot:void 0},mat:{uuid:""},tex:{uuid:""},revision:-1},re=ya({state:$o,mutations:{setVar(s,e){s.var=e},setMat(s,e){s.mat=e},setTex(s,e){s.tex=e}}});re.state.selected.unit=v;function Ue(s){return re.commit("setVar",s)}function gs(s){return re.commit("setMat",s)}function ys(s){return re.commit("setTex",s)}const ai={load(){return K.request("project.load",...arguments)},save(s){return K.request("project.save",...arguments)}},rn={models(){return K.request("speech.models",...arguments)},saveTransferMeta(s,e){return K.request("speech.saveTransferMeta",...arguments)}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Fo(s){const e="http://",t="https://";if(s.indexOf(e)===0||s.indexOf(t)===0)return await(await fetch(s)).json();throw new Error(`Unsupported URL scheme in metadata URL: ${s}. Supported schemes are: http://, https://, and (node.js-only) file://`)}let Re=null;function et(s){return Re==null&&(Re=Fn().epsilon()),pe(()=>{const{mean:e,variance:t}=Tn(s);return ba(va(s,e),$n(xa(t),Re))})}function Bo(s){if(s.length<2)throw new Error("Cannot normalize a Float32Array with fewer than 2 elements.");return Re==null&&(Re=Fn().epsilon()),pe(()=>{const{mean:e,variance:t}=Tn(ft(s)),n=e.arraySync(),i=Math.sqrt(t.arraySync()),a=Array.from(s).map(r=>(r-n)/(i+Re));return new Float32Array(a)})}function zo(){return window.AudioContext||window.webkitAudioContext}async function Oo(s){return navigator.mediaDevices.getUserMedia({audio:s==null?!0:s,video:!1})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bs{constructor(e){l(this,"numFrames");l(this,"sampleRateHz");l(this,"fftSize");l(this,"columnTruncateLength");l(this,"overlapFactor");l(this,"includeRawAudio");l(this,"spectrogramCallback");l(this,"stream");l(this,"audioContextConstructor");l(this,"audioContext");l(this,"analyser");l(this,"tracker");l(this,"freqData");l(this,"timeData");l(this,"freqDataQueue");l(this,"timeDataQueue");l(this,"frameIntervalTask");l(this,"frameDurationMillis");l(this,"suppressionTimeMillis");if(e==null)throw new Error("Required configuration object is missing for BrowserFftFeatureExtractor constructor");if(e.spectrogramCallback==null)throw new Error("spectrogramCallback cannot be null or undefined");if(!(e.numFramesPerSpectrogram>0))throw new Error(`Invalid value in numFramesPerSpectrogram: ${e.numFramesPerSpectrogram}`);if(e.suppressionTimeMillis<0)throw new Error(`Expected suppressionTimeMillis to be >= 0, but got ${e.suppressionTimeMillis}`);if(this.suppressionTimeMillis=e.suppressionTimeMillis,this.spectrogramCallback=e.spectrogramCallback,this.numFrames=e.numFramesPerSpectrogram,this.sampleRateHz=e.sampleRateHz||44100,this.fftSize=e.fftSize||1024,this.frameDurationMillis=this.fftSize/this.sampleRateHz*1e3,this.columnTruncateLength=e.columnTruncateLength||this.fftSize,this.overlapFactor=e.overlapFactor,this.includeRawAudio=e.includeRawAudio,C(this.overlapFactor>=0&&this.overlapFactor<1,()=>`Expected overlapFactor to be >= 0 and < 1, but got ${this.overlapFactor}`),this.columnTruncateLength>this.fftSize)throw new Error(`columnTruncateLength ${this.columnTruncateLength} exceeds fftSize (${this.fftSize}).`);this.audioContextConstructor=zo()}async start(e){if(this.frameIntervalTask!=null)throw new Error("Cannot start already-started BrowserFftFeatureExtractor");this.stream=await Oo(e),this.audioContext=new this.audioContextConstructor({sampleRate:this.sampleRateHz});const t=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=0,t.connect(this.analyser),this.freqDataQueue=[],this.freqData=new Float32Array(this.fftSize),this.includeRawAudio&&(this.timeDataQueue=[],this.timeData=new Float32Array(this.fftSize));const n=Math.max(1,Math.round(this.numFrames*(1-this.overlapFactor)));this.tracker=new Ao(n,Math.round(this.suppressionTimeMillis/this.frameDurationMillis)),this.frameIntervalTask=setInterval(this.onAudioFrame.bind(this),this.fftSize/this.sampleRateHz*1e3)}async onAudioFrame(){if(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0)return;if(this.freqDataQueue.push(this.freqData.slice(0,this.columnTruncateLength)),this.includeRawAudio&&(this.analyser.getFloatTimeDomainData(this.timeData),this.timeDataQueue.push(this.timeData.slice())),this.freqDataQueue.length>this.numFrames&&this.freqDataQueue.shift(),this.tracker.tick()){const t=on(this.freqDataQueue),n=ln(t,[1,this.numFrames,this.columnTruncateLength,1]);let i;if(this.includeRawAudio){const r=on(this.timeDataQueue);i=ln(r,[1,this.numFrames*this.fftSize])}await this.spectrogramCallback(n,i)&&this.tracker.suppress(),Le([n,i])}}async stop(){if(this.frameIntervalTask==null)throw new Error("Cannot stop because there is no ongoing streaming activity.");clearInterval(this.frameIntervalTask),this.frameIntervalTask=null,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop()}setConfig(e){throw new Error("setConfig() is not implemented for BrowserFftFeatureExtractor.")}getFeatures(){throw new Error("getFeatures() is not implemented for BrowserFftFeatureExtractor. Use the spectrogramCallback field of the constructor config instead.")}}function on(s){const e=s[0].length,t=new Float32Array(s.length*e);return s.forEach((n,i)=>t.set(n,i*e)),t}function ln(s,e){const t=new Float32Array(_a(e));return t.set(s,t.length-s.length),wa(t,e)}class Ao{constructor(e,t){l(this,"period");l(this,"suppressionTime");l(this,"counter");l(this,"suppressionOnset");this.period=e,this.suppressionTime=t==null?0:t,this.counter=0,C(this.period>0,()=>`Expected period to be positive, but got ${this.period}`)}tick(){return this.counter++,this.counter%this.period===0&&(this.suppressionOnset==null||this.counter-this.suppressionOnset>this.suppressionTime)}suppress(){this.suppressionOnset=this.counter}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pt(s){let e=0;s.forEach(i=>{e+=i.byteLength});const t=new Uint8Array(e);let n=0;return s.forEach(i=>{t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function jo(s){let e=0;s.forEach(i=>e+=i.length);const t=new Float32Array(e);let n=0;return s.forEach(i=>{t.set(i,n),n+=i.length}),t}function cn(s){if(s==null)throw new Error("Received null or undefind string");const e=unescape(encodeURIComponent(s)),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t.buffer}function un(s){if(s==null)throw new Error("Received null or undefind buffer");const e=new Uint8Array(s);return decodeURIComponent(escape(String.fromCharCode(...e)))}function Io(){function s(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s()+s()+"-"+s()+"-"+s()+"-"+s()+"-"+s()+s()+s()}function Lo(s,e){return Math.floor((e-s)*Math.random())+s}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uo(s,e,t){return C(t>0&&t<1,()=>`validationSplit is expected to be >0 and <1, but got ${t}`),pe(()=>{const n=Bn(e,-1).dataSync(),i=[];for(let p=0;p<n.length;++p){const f=n[p];i[f]==null&&(i[f]=[]),i[f].push(p)}const a=i.length,r=[],o=[];i.map(p=>Rt(p));for(let p=0;p<a;++p){const f=i[p],g=Math.round(f.length*(1-t));for(let b=0;b<f.length;++b)b<g?r.push(f[b]):o.push(f[b])}const c=it(s,r),u=it(e,r),h=it(s,o),d=it(e,o);return{trainXs:c,trainYs:u,valXs:h,valYs:d}})}function Ro(s,e,t){C(t>0&&t<1,()=>`validationSplit is expected to be >0 and <1, but got ${t}`);const n=!Array.isArray(s[0]),i=e,a=[];for(let u=0;u<i.length;++u){const h=i[u];a[h]==null&&(a[h]=[]),a[h].push(u)}const r=a.length,o=[],c=[];a.map(u=>Rt(u));for(let u=0;u<r;++u){const h=a[u],d=Math.round(h.length*(1-t));for(let p=0;p<h.length;++p)p<d?o.push(h[p]):c.push(h[p])}if(n){const u=[],h=[],d=[],p=[];for(const f of o)u.push(s[f]),h.push(e[f]);for(const f of c)d.push(s[f]),p.push(e[f]);return{trainXs:u,trainYs:h,valXs:d,valYs:p}}else{const u=[],h=[],d=[],p=[];for(const f of o)u.push(s[f]),h.push(e[f]);for(const f of c)d.push(s[f]),p.push(e[f]);return{trainXs:u,trainYs:h,valXs:d,valYs:p}}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $t="TFJSSCDS",No=1,Ne="_background_noise_";class dn{constructor(e){l(this,"examples");l(this,"label2Ids");if(this.examples={},this.label2Ids={},e!=null){const t=qo(e);let n=0;for(let i=0;i<t.manifest.length;++i){const a=t.manifest[i];let r=a.spectrogramNumFrames*a.spectrogramFrameSize;a.rawAudioNumSamples!=null&&(r+=a.rawAudioNumSamples),r*=4,this.addExample(Vo({spec:a,data:t.data.slice(n,n+r)})),n+=r}}}addExample(e){C(e!=null,()=>"Got null or undefined example"),C(e.label!=null&&e.label.length>0,()=>`Expected label to be a non-empty string, but got ${JSON.stringify(e.label)}`);const t=Io();return this.examples[t]=e,e.label in this.label2Ids||(this.label2Ids[e.label]=[]),this.label2Ids[e.label].push(t),t}merge(e){C(e!==this,()=>"Cannot merge a dataset into itself");const t=e.getVocabulary();for(const n of t){const i=e.getExamples(n);for(const a of i)this.addExample(a.example)}}getExampleCounts(){const e={};for(const t in this.examples){const n=this.examples[t];n.label in e||(e[n.label]=0),e[n.label]++}return e}getExamples(e){C(e!=null,()=>`Expected label to be a string, but got ${JSON.stringify(e)}`),C(e in this.label2Ids,()=>`No example of label "${e}" exists in dataset`);const t=[];return this.label2Ids[e].forEach(n=>{t.push({uid:n,example:this.examples[n]})}),t}getData(e,t){C(this.size()>0,()=>"Cannot get spectrograms as tensors because the dataset is empty");const n=this.getVocabulary();e!=null?C(n.indexOf(e)!==-1,()=>`Label ${e} is not in the vocabulary (${JSON.stringify(n)})`):C(n.length>1,()=>`One-hot encoding of labels requires the vocabulary to have at least two words, but it has only ${n.length} word.`),t==null&&(t={});const i=this.getSortedUniqueNumFrames();let a,r;i.length===1?(a=t.numFrames==null?i[0]:t.numFrames,r=t.hopFrames==null?1:t.hopFrames):(a=t.numFrames,C(a!=null&&Number.isInteger(a)&&a>0,()=>`There are ${i.length} unique lengths among the ${this.size()} examples of this Dataset, hence numFrames is required. But it is not provided.`),C(a<=i[0],()=>`numFrames (${a}) exceeds the minimum numFrames (${i[0]}) among the examples of the Dataset.`),r=t.hopFrames,C(r!=null&&Number.isInteger(r)&&r>0,()=>`There are ${i.length} unique lengths among the ${this.size()} examples of this Dataset, hence hopFrames is required. But it is not provided.`));const o=t.normalize==null?!0:t.normalize;return pe(()=>{let c=[],u=[],h=[],d;for(let f=0;f<n.length;++f){const g=n[f];if(e!=null&&g!==e)continue;const b=this.label2Ids[g];for(const E of b){const M=this.examples[E].spectrogram,x=M.frameSize;d==null?d=x:C(x===d,()=>`Mismatch in frameSize  (${x} vs ${d})`);const O=M.data.length/x;let L=null;g!==Ne&&(L=M.keyFrameIndex==null?Xo(M).dataSync()[0]:M.keyFrameIndex);const I=es(M.data,[O,x,1]),U=Wo(O,L,a,r);for(const G of U){const te=pe(()=>{const ue=zn(I,[G[0],0,0],[G[1]-G[0],-1,-1]);return o?et(ue):ue});t.getDataset?u.push(te.dataSync()):c.push(te),e==null&&h.push(f)}Le(I)}}t.augmentByMixingNoiseRatio!=null&&this.augmentByMixingNoise(t.getDataset?u:c,h,t.augmentByMixingNoiseRatio);const p=t.shuffle==null?!0:t.shuffle;if(t.getDataset){const f=t.datasetBatchSize==null?32:t.datasetBatchSize,g=t.datasetValidationSplit==null?.15:t.datasetValidationSplit;C(g>0&&g<1,()=>`Invalid dataset validation split: ${g}`);const b=u.map((J,qe)=>[J,h[qe]]);Rt(b),u=b.map(J=>J[0]);const E=b.map(J=>J[1]),{trainXs:T,trainYs:M,valXs:x,valYs:O}=Ro(u,E,g),L=at(T).map(J=>es(J,[a,d,1])),I=at(M).map(J=>js(ts([J],n.length),[0]));let U=Is({xs:L,ys:I});p&&(U=U.shuffle(u.length)),U=U.batch(f).prefetch(4);const G=at(x).map(J=>es(J,[a,d,1])),te=at(O).map(J=>js(ts([J],n.length),[0]));let ue=Is({xs:G,ys:te});return ue=ue.batch(f).prefetch(4),[U,ue]}else{if(p){const g=[];c.forEach((b,E)=>{g.push({x:b,y:h[E]})}),Rt(g),c=g.map(b=>b.x),h=g.map(b=>b.y)}const f=e==null?Sa(ts(ft(h,"int32"),n.length),"float32"):void 0;return{xs:Ca(c),ys:f}}})}augmentByMixingNoise(e,t,n){if(e==null||e.length===0)throw new Error("Cannot perform augmentation because data is null or empty");const i=e[0]instanceof Float32Array,a=this.getVocabulary(),r=[],o=[];for(let h=0;h<t.length;++h)a[t[h]]===Ne?r.push(h):o.push(h);if(r.length===0)throw new Error(`Cannot perform augmentation by mixing with noise when there is no example with label ${Ne}`);const c=[],u=[];for(const h of o){const d=r[Lo(0,r.length)],p=i?ft(e[h]):e[h],f=i?ft(e[d]):e[d],g=pe(()=>et($n(p,ka(f,n))));i?c.push(g.dataSync()):c.push(g),u.push(t[h])}console.log(`Data augmentation: mixing noise: added ${c.length} examples`),c.forEach(h=>e.push(h)),t.push(...u)}getSortedUniqueNumFrames(){const e=new Set,t=this.getVocabulary();for(let i=0;i<t.length;++i){const a=t[i],r=this.label2Ids[a];for(const o of r){const c=this.examples[o].spectrogram,u=c.data.length/c.frameSize;e.add(u)}}const n=[...e];return n.sort(),n}removeExample(e){if(!(e in this.examples))throw new Error(`Nonexistent example UID: ${e}`);const t=this.examples[e].label;delete this.examples[e];const n=this.label2Ids[t].indexOf(e);this.label2Ids[t].splice(n,1),this.label2Ids[t].length===0&&delete this.label2Ids[t]}setExampleKeyFrameIndex(e,t){if(!(e in this.examples))throw new Error(`Nonexistent example UID: ${e}`);const n=this.examples[e].spectrogram,i=n.data.length/n.frameSize;C(t>=0&&t<i&&Number.isInteger(t),()=>`Invalid keyFrameIndex: ${t}. Must be >= 0, < ${i}, and an integer.`),n.keyFrameIndex=t}size(){return Object.keys(this.examples).length}durationMillis(){let e=0;const t=23.22;for(const n in this.examples){const i=this.examples[n].spectrogram,a=i.frameDurationMillis|t;e+=i.data.length/i.frameSize*a}return e}empty(){return this.size()===0}clear(){this.examples={}}getVocabulary(){const e=new Set;for(const n in this.examples){const i=this.examples[n];e.add(i.label)}const t=[...e];return t.sort(),t}serialize(e){const t=this.getVocabulary();C(!this.empty(),()=>"Cannot serialize empty Dataset"),e!=null&&(Array.isArray(e)||(e=[e]),e.forEach(a=>{if(t.indexOf(a)===-1)throw new Error(`Word label "${a}" does not exist in the vocabulary of this dataset. The vocabulary is: ${JSON.stringify(t)}.`)}));const n=[],i=[];for(const a of t){if(e!=null&&e.indexOf(a)===-1)continue;const r=this.label2Ids[a];for(const o of r){const c=Po(this.examples[o]);n.push(c.spec),i.push(c.data)}}return Ho({manifest:n,data:Pt(i)})}}function Po(s){const e=s.rawAudio!=null,t={label:s.label,spectrogramNumFrames:s.spectrogram.data.length/s.spectrogram.frameSize,spectrogramFrameSize:s.spectrogram.frameSize};s.spectrogram.keyFrameIndex!=null&&(t.spectrogramKeyFrameIndex=s.spectrogram.keyFrameIndex);let n=s.spectrogram.data.buffer.slice(0);return e&&(t.rawAudioNumSamples=s.rawAudio.data.length,t.rawAudioSampleRateHz=s.rawAudio.sampleRateHz,n=Pt([n,s.rawAudio.data.buffer])),{spec:t,data:n}}function Vo(s){const e={frameSize:s.spec.spectrogramFrameSize,data:new Float32Array(s.data.slice(0,4*s.spec.spectrogramFrameSize*s.spec.spectrogramNumFrames))};s.spec.spectrogramKeyFrameIndex!=null&&(e.keyFrameIndex=s.spec.spectrogramKeyFrameIndex);const t={label:s.spec.label,spectrogram:e};return s.spec.rawAudioNumSamples!=null&&(t.rawAudio={sampleRateHz:s.spec.rawAudioSampleRateHz,data:new Float32Array(s.data.slice(4*s.spec.spectrogramFrameSize*s.spec.spectrogramNumFrames))}),t}function Ho(s){const e=cn(JSON.stringify(s.manifest)),t=cn($t),n=new Uint32Array([No]),i=new Uint32Array([e.byteLength]),a=Pt([t,n.buffer,i.buffer]);return Pt([a,e,s.data])}function qo(s){C(s!=null,()=>"Received null or undefined buffer");let e=0;const t=un(s.slice(e,$t.length));C(t===$t,()=>"Deserialization error: Invalid descriptor"),e+=$t.length,e+=4;const n=new Uint32Array(s,e,1);e+=4;const i=e;e=i+n[0];const a=s.slice(i,e),r=un(a),o=JSON.parse(r),c=s.slice(e);return{manifest:o,data:c}}function Wo(s,e,t,n){if(C(Number.isInteger(s)&&s>0,()=>`snippetLength must be a positive integer, but got ${s}`),e!=null&&C(Number.isInteger(e)&&e>=0,()=>`focusIndex must be a non-negative integer, but got ${e}`),C(Number.isInteger(t)&&t>0,()=>`windowLength must be a positive integer, but got ${t}`),C(Number.isInteger(n)&&n>0,()=>`windowHop must be a positive integer, but got ${n}`),C(t<=s,()=>`windowLength (${t}) exceeds snippetLength (${s})`),C(e<s,()=>`focusIndex (${e}) equals or exceeds snippetLength (${s})`),t===s)return[[0,s]];const i=[];if(e==null){let o=0;for(;o+t<=s;)i.push([o,o+t]),o+=n;return i}const a=Math.floor(t/2);let r=e-a;for(r<0?r=0:r+t>s&&(r=s-t);!(r-n<0||e>=r-n+t);)r-=n;for(;r+t<=s&&!(e<r);)i.push([r,r+t]),r+=n;return i}function Yo(s){return pe(()=>{const e=s.data.length/s.frameSize,t=Ea(s.data,[e,s.frameSize]);return Da(t,-1)})}function Xo(s){return pe(()=>Bn(Yo(s)))}/** @license See the LICENSE file. */const ri="0.5.4";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Go="_unknown_",ss="tfjs-speech-commands-saved-model-metadata",Jo="indexeddb://tfjs-speech-commands-model/",ns={localStorage:typeof window=="undefined"?null:window.localStorage};function Qo(s){return s.split(".").slice(0,2).join(".")}const ot=.25,Vt=class{constructor(e,t,n){l(this,"MODEL_URL_PREFIX",`https://storage.googleapis.com/tfjs-models/tfjs/speech-commands/v${Qo(ri)}/browser_fft`);l(this,"SAMPLE_RATE_HZ",44100);l(this,"FFT_SIZE",1024);l(this,"DEFAULT_SUPPRESSION_TIME_MILLIS",0);l(this,"model");l(this,"modelWithEmbeddingOutput");l(this,"vocabulary");l(this,"parameters");l(this,"words");l(this,"streaming",!1);l(this,"nonBatchInputShape");l(this,"elementsPerExample");l(this,"audioDataExtractor");l(this,"transferRecognizers",{});l(this,"modelArtifactsOrURL");l(this,"metadataOrURL");l(this,"secondLastBaseDenseLayer");C(t==null&&n==null||t!=null&&n!=null,()=>"modelURL and metadataURL must be both provided or both not provided."),t==null?(e==null?e=Vt.DEFAULT_VOCABULARY_NAME:C(Vt.VALID_VOCABULARY_NAMES.indexOf(e)!==-1,()=>`Invalid vocabulary name: '${e}'`),this.vocabulary=e,this.modelArtifactsOrURL=`${this.MODEL_URL_PREFIX}/${this.vocabulary}/model.json`,this.metadataOrURL=`${this.MODEL_URL_PREFIX}/${this.vocabulary}/metadata.json`):(C(e==null,()=>"vocabulary name must be null or undefined when modelURL is provided"),this.modelArtifactsOrURL=t,this.metadataOrURL=n),this.parameters={sampleRateHz:this.SAMPLE_RATE_HZ,fftSize:this.FFT_SIZE}}async listen(e,t){if(this.streaming)throw new Error("Cannot start streaming again when streaming is ongoing.");await this.ensureModelLoaded(),t==null&&(t={});let n=t.probabilityThreshold==null?0:t.probabilityThreshold;t.includeEmbedding&&(n=0),C(n>=0&&n<=1,()=>`Invalid probabilityThreshold value: ${n}`);let i=t.invokeCallbackOnNoiseAndUnknown==null?!1:t.invokeCallbackOnNoiseAndUnknown;if(t.includeEmbedding&&(i=!0),t.suppressionTimeMillis<0)throw new Error(`suppressionTimeMillis is expected to be >= 0, but got ${t.suppressionTimeMillis}`);const a=t.overlapFactor==null?.5:t.overlapFactor;C(a>=0&&a<1,()=>`Expected overlapFactor to be >= 0 and < 1, but got ${a}`);const r=async(c,u)=>{const h=et(c);let d,p;t.includeEmbedding?(await this.ensureModelWithEmbeddingOutputCreated(),[d,p]=this.modelWithEmbeddingOutput.predict(h)):d=this.model.predict(h);const f=await d.data(),g=d.argMax(-1),b=(await g.data())[0],E=Math.max(...f);if(Le([d,g,h]),E<n)return!1;{let T;t.includeSpectrogram&&(T={data:await c.data(),frameSize:this.nonBatchInputShape[1]});let M=!0;return i||(this.words[b]===Ne||this.words[b]===Go)&&(M=!1),M&&e({scores:f,spectrogram:T,embedding:p}),M}},o=t.suppressionTimeMillis==null?this.DEFAULT_SUPPRESSION_TIME_MILLIS:t.suppressionTimeMillis;this.audioDataExtractor=new bs({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:o,spectrogramCallback:r,overlapFactor:a}),await this.audioDataExtractor.start(t.audioTrackConstraints),this.streaming=!0}async ensureModelLoaded(){if(this.model!=null)return;await this.ensureMetadataLoaded();let e;if(typeof this.modelArtifactsOrURL=="string"?e=await ls(this.modelArtifactsOrURL):e=await ls(Ma(this.modelArtifactsOrURL.modelTopology,this.modelArtifactsOrURL.weightSpecs,this.modelArtifactsOrURL.weightData)),e.inputs.length!==1)throw new Error(`Expected model to have 1 input, but got a model with ${e.inputs.length} inputs`);if(e.inputs[0].shape.length!==4)throw new Error(`Expected model to have an input shape of rank 4, but got an input shape of rank ${e.inputs[0].shape.length}`);if(e.inputs[0].shape[3]!==1)throw new Error(`Expected model to have an input shape with 1 as the last dimension, but got input shape${JSON.stringify(e.inputs[0].shape[3])}}`);const t=e.outputShape;if(t.length!==2)throw new Error(`Expected loaded model to have an output shape of rank 2,but received shape ${JSON.stringify(t)}`);if(t[1]!==this.words.length)throw new Error(`Mismatch between the last dimension of model's output shape (${t[1]}) and number of words (${this.words.length}).`);this.model=e,this.freezeModel(),this.nonBatchInputShape=e.inputs[0].shape.slice(1),this.elementsPerExample=1,e.inputs[0].shape.slice(1).forEach(a=>this.elementsPerExample*=a),this.warmUpModel();const n=this.parameters.fftSize/this.parameters.sampleRateHz*1e3,i=e.inputs[0].shape[1];this.parameters.spectrogramDurationMillis=i*n}async ensureModelWithEmbeddingOutputCreated(){if(this.modelWithEmbeddingOutput!=null)return;await this.ensureModelLoaded();let e;for(let t=this.model.layers.length-2;t>=0;--t)if(this.model.layers[t].getClassName()==="Dense"){e=this.model.layers[t];break}if(e==null)throw new Error("Failed to find second last dense layer in the original model.");this.modelWithEmbeddingOutput=On({inputs:this.model.inputs,outputs:[this.model.outputs[0],e.output]})}warmUpModel(){pe(()=>{const e=Ta([1].concat(this.nonBatchInputShape));for(let t=0;t<3;++t)this.model.predict(e)})}async ensureMetadataLoaded(){if(this.words!=null)return;const e=typeof this.metadataOrURL=="string"?await Fo(this.metadataOrURL):this.metadataOrURL;if(e.wordLabels==null){const t=e.words;if(t==null)throw new Error('Cannot find field "words" or "wordLabels" in metadata JSON file');this.words=t}else this.words=e.wordLabels}async stopListening(){if(!this.streaming)throw new Error("Cannot stop streaming when streaming is not ongoing.");await this.audioDataExtractor.stop(),this.streaming=!1}isListening(){return this.streaming}wordLabels(){return this.words}params(){return this.parameters}modelInputShape(){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognize(), or listen().");return this.model.inputs[0].shape}async recognize(e,t){t==null&&(t={}),await this.ensureModelLoaded(),e==null&&(e=(await this.recognizeOnline()).data);let n,i,a;if(e instanceof Ls)this.checkInputTensorShape(e),i=e,n=e.shape[0];else{if(e.length%this.elementsPerExample)throw new Error(`The length of the input Float32Array ${e.length} is not divisible by the number of tensor elements per per example expected by the model ${this.elementsPerExample}.`);n=e.length/this.elementsPerExample,i=$a(e,[n].concat(this.nonBatchInputShape))}const r={scores:null};if(t.includeEmbedding){await this.ensureModelWithEmbeddingOutputCreated();const o=this.modelWithEmbeddingOutput.predict(i);a=o[0],r.embedding=o[1]}else a=this.model.predict(i);if(n===1)r.scores=await a.data();else{const o=Fa(a),c=o.map(u=>u.data());r.scores=await Promise.all(c),Le(o)}return t.includeSpectrogram&&(r.spectrogram={data:e instanceof Ls?await e.data():e,frameSize:this.nonBatchInputShape[1]}),Le(a),r}async recognizeOnline(){return new Promise((e,t)=>{const n=async i=>{const a=et(i);return await this.audioDataExtractor.stop(),e({data:await a.data(),frameSize:this.nonBatchInputShape[1]}),a.dispose(),!1};this.audioDataExtractor=new bs({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:this.nonBatchInputShape[0],columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:n,overlapFactor:0}),this.audioDataExtractor.start()})}createTransfer(e){if(this.model==null)throw new Error("Model has not been loaded yet. Load model by calling ensureModelLoaded(), recognizer(), or listen().");C(e!=null&&typeof e=="string"&&e.length>1,()=>`Expected the name for a transfer-learning recognized to be a non-empty string, but got ${JSON.stringify(e)}`),C(this.transferRecognizers[e]==null,()=>`There is already a transfer-learning model named '${e}'`);const t=new Zo(e,this.parameters,this.model);return this.transferRecognizers[e]=t,t}freezeModel(){for(const e of this.model.layers)e.trainable=!1}checkInputTensorShape(e){const t=this.model.inputs[0].shape.length;if(e.shape.length!==t)throw new Error(`Expected input Tensor to have rank ${t}, but got rank ${e.shape.length} that differs `);const n=e.shape.slice(1),i=this.model.inputs[0].shape.slice(1);if(!Ba(n,i))throw new Error(`Expected input to have shape [null,${i}], but got shape [null,${n}]`)}};let Ge=Vt;l(Ge,"VALID_VOCABULARY_NAMES",["18w","directional4w"]),l(Ge,"DEFAULT_VOCABULARY_NAME","18w");class Zo extends Ge{constructor(e,t,n){super();l(this,"dataset");l(this,"transferHead");this.name=e,this.parameters=t,this.baseModel=n,C(e!=null&&typeof e=="string"&&e.length>0,()=>`The name of a transfer model must be a non-empty string, but got ${JSON.stringify(e)}`),this.nonBatchInputShape=this.baseModel.inputs[0].shape.slice(1),this.words=null,this.dataset=new dn}async collectExample(e,t){if(C(!this.streaming,()=>"Cannot start collection of transfer-learning example because a streaming recognition or transfer-learning example collection is ongoing"),C(e!=null&&typeof e=="string"&&e.length>0,()=>"Must provide a non-empty string when collecting transfer-learning example"),t==null&&(t={}),t.durationMultiplier!=null&&t.durationSec!=null)throw new Error("durationMultiplier and durationSec are mutually exclusive, but are both specified.");let n;if(t.durationSec!=null){C(t.durationSec>0,()=>`Expected durationSec to be > 0, but got ${t.durationSec}`);const r=this.parameters.fftSize/this.parameters.sampleRateHz;n=Math.ceil(t.durationSec/r)}else t.durationMultiplier!=null?(C(t.durationMultiplier>=1,()=>`Expected duration multiplier to be >= 1, but got ${t.durationMultiplier}`),n=Math.round(this.nonBatchInputShape[0]*t.durationMultiplier)):n=this.nonBatchInputShape[0];t.snippetDurationSec!=null&&(C(t.snippetDurationSec>0,()=>`snippetDurationSec is expected to be > 0, but got ${t.snippetDurationSec}`),C(t.onSnippet!=null,()=>"onSnippet must be provided if snippetDurationSec is provided.")),t.onSnippet!=null&&C(t.snippetDurationSec!=null,()=>"snippetDurationSec must be provided if onSnippet is provided.");const a=this.parameters.fftSize/this.parameters.sampleRateHz*n;return this.streaming=!0,new Promise(r=>{const o=t.snippetDurationSec==null?1:t.snippetDurationSec/a,c=1-o,u=Math.round(1/o);let h=0,d=-1;const p=[],f=async(g,b)=>{if(t.onSnippet==null){const E=et(g);this.dataset.addExample({label:e,spectrogram:{data:await E.data(),frameSize:this.nonBatchInputShape[1]},rawAudio:t.includeRawAudio?{data:await b.data(),sampleRateHz:this.audioDataExtractor.sampleRateHz}:void 0}),E.dispose(),await this.audioDataExtractor.stop(),this.streaming=!1,this.collateTransferWords(),r({data:await g.data(),frameSize:this.nonBatchInputShape[1]})}else{const E=await g.data();d===-1&&(d=E.length);let T=d-1;for(;E[T]!==0&&T>=0;)T--;const M=d-T-1;d=T+1;const x=E.slice(E.length-M,E.length);if(p.push(x),t.onSnippet!=null&&t.onSnippet({data:x,frameSize:this.nonBatchInputShape[1]}),h++===u){await this.audioDataExtractor.stop(),this.streaming=!1,this.collateTransferWords();const L={data:Bo(jo(p)),frameSize:this.nonBatchInputShape[1]};this.dataset.addExample({label:e,spectrogram:L,rawAudio:t.includeRawAudio?{data:await b.data(),sampleRateHz:this.audioDataExtractor.sampleRateHz}:void 0}),r(L)}}return!1};this.audioDataExtractor=new bs({sampleRateHz:this.parameters.sampleRateHz,numFramesPerSpectrogram:n,columnTruncateLength:this.nonBatchInputShape[1],suppressionTimeMillis:0,spectrogramCallback:f,overlapFactor:c,includeRawAudio:t.includeRawAudio}),this.audioDataExtractor.start(t.audioTrackConstraints)})}clearExamples(){C(this.words!=null&&this.words.length>0&&!this.dataset.empty(),()=>`No transfer learning examples exist for model name ${this.name}`),this.dataset.clear(),this.words=null}countExamples(){if(this.dataset.empty())throw new Error(`No examples have been collected for transfer-learning model named '${this.name}' yet.`);return this.dataset.getExampleCounts()}getExamples(e){return this.dataset.getExamples(e)}setExampleKeyFrameIndex(e,t){this.dataset.setExampleKeyFrameIndex(e,t)}removeExample(e){this.dataset.removeExample(e),this.collateTransferWords()}isDatasetEmpty(){return this.dataset.empty()}loadExamples(e,t=!1){const n=new dn(e);t&&this.clearExamples();const i=n.getVocabulary();for(const a of i){const r=n.getExamples(a);for(const o of r)this.dataset.addExample(o.example)}this.collateTransferWords()}serializeExamples(e){return this.dataset.serialize(e)}collateTransferWords(){this.words=this.dataset.getVocabulary()}collectTransferDataAsTensors(e,t){const n=this.nonBatchInputShape[0];e=e||ot;const i=Math.round(e*n),a=this.dataset.getData(null,de({numFrames:n,hopFrames:i},t));return{xs:a.xs,ys:a.ys}}collectTransferDataAsTfDataset(e,t=.15,n=32,i){const a=this.nonBatchInputShape[0];e=e||ot;const r=Math.round(e*a);return this.dataset.getData(null,de({numFrames:a,hopFrames:r,getDataset:!0,datasetBatchSize:n,datasetValidationSplit:t},i))}async train(e){C(this.words!=null&&this.words.length>0,()=>`Cannot train transfer-learning model '${this.name}' because no transfer learning example has been collected.`),C(this.words.length>1,()=>`Cannot train transfer-learning model '${this.name}' because only 1 word label ('${JSON.stringify(this.words)}') has been collected for transfer learning. Requires at least 2.`),e.fineTuningEpochs!=null&&C(e.fineTuningEpochs>=0&&Number.isInteger(e.fineTuningEpochs),()=>`If specified, fineTuningEpochs must be a non-negative integer, but received ${e.fineTuningEpochs}`),e==null&&(e={}),this.model==null&&this.createTransferModelFromBaseModel(),this.secondLastBaseDenseLayer.trainable=!1,this.model.compile({loss:"categoricalCrossentropy",optimizer:e.optimizer||"sgd",metrics:["acc"]});const t=e.fitDatasetDurationMillisThreshold==null?6e4:e.fitDatasetDurationMillisThreshold;return this.dataset.durationMillis()>t?(console.log(`Detected large dataset: total duration = ${this.dataset.durationMillis()} ms > ${t} ms. Training transfer model using fitDataset() instead of fit()`),this.trainOnDataset(e)):this.trainOnTensors(e)}async trainOnDataset(e){C(e.epochs>0,()=>"Invalid config.epochs");const t=e.batchSize==null?32:e.batchSize,n=e.windowHopRatio||ot,[i,a]=this.collectTransferDataAsTfDataset(n,e.validationSplit,t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio}),r=rt(),o=await this.model.fitDataset(i,{epochs:e.epochs,validationData:e.validationSplit>0?a:null,callbacks:e.callback==null?null:[e.callback]});if(console.log(`fitDataset() took ${(rt()-r).toFixed(2)} ms`),e.fineTuningEpochs!=null&&e.fineTuningEpochs>0){const c=rt(),u=await this.fineTuningUsingTfDatasets(e,i,a);return console.log(`fitDataset() (fine-tuning) took ${(rt()-c).toFixed(2)} ms`),[o,u]}else return o}async trainOnTensors(e){const t=e.windowHopRatio||ot,{xs:n,ys:i}=this.collectTransferDataAsTensors(t,{augmentByMixingNoiseRatio:e.augmentByMixingNoiseRatio});console.log(`Training data: xs.shape = ${n.shape}, ys.shape = ${i.shape}`);let a,r,o;try{if(e.validationSplit!=null){const u=Uo(n,i,e.validationSplit);a=u.trainXs,r=u.trainYs,o=[u.valXs,u.valYs]}else a=n,r=i;const c=await this.model.fit(a,r,{epochs:e.epochs==null?20:e.epochs,validationData:o,batchSize:e.batchSize,callbacks:e.callback==null?null:[e.callback]});if(e.fineTuningEpochs!=null&&e.fineTuningEpochs>0){const u=await this.fineTuningUsingTensors(e,a,r,o);return[c,u]}else return c}finally{Le([n,i,a,r,o])}}async fineTuningUsingTfDatasets(e,t,n){const i=this.secondLastBaseDenseLayer.trainable;this.secondLastBaseDenseLayer.trainable=!0;const a=e.fineTuningOptimizer==null?"sgd":e.fineTuningOptimizer;this.model.compile({loss:"categoricalCrossentropy",optimizer:a,metrics:["acc"]});const r=await this.model.fitDataset(t,{epochs:e.fineTuningEpochs,validationData:n,callbacks:e.callback==null?null:[e.callback]});return this.secondLastBaseDenseLayer.trainable=i,r}async fineTuningUsingTensors(e,t,n,i){const a=this.secondLastBaseDenseLayer.trainable;this.secondLastBaseDenseLayer.trainable=!0;const r=e.fineTuningOptimizer==null?"sgd":e.fineTuningOptimizer;this.model.compile({loss:"categoricalCrossentropy",optimizer:r,metrics:["acc"]});const o=await this.model.fit(t,n,{epochs:e.fineTuningEpochs,validationData:i,batchSize:e.batchSize,callbacks:e.fineTuningCallback==null?null:[e.fineTuningCallback]});return this.secondLastBaseDenseLayer.trainable=a,o}async evaluate(e){C(e.wordProbThresholds!=null&&e.wordProbThresholds.length>0,()=>"Received null or empty wordProbThresholds");const t=0;return C(this.words[t]===Ne,()=>`Cannot perform evaluation when the first tag is not ${Ne}`),pe(()=>{const n=[];let i=0;const{xs:a,ys:r}=this.collectTransferDataAsTensors(e.windowHopRatio),o=r.argMax(-1).dataSync(),c=this.model.predict(a),u=za(zn(c,[0,1],[c.shape[0],c.shape[1]-1]),-1),h=c.shape[0];for(let d=0;d<e.wordProbThresholds.length;++d){const p=e.wordProbThresholds[d],f=u.greater(Oa(p)).dataSync();let g=0,b=0,E=0,T=0;for(let O=0;O<h;++O)o[O]===t?(g++,f[O]&&E++):(b++,f[O]&&T++);const M=E/g,x=T/b;n.push({probThreshold:p,fpr:M,tpr:x}),console.log(`ROC thresh=${p}: fpr=${M.toFixed(4)}, tpr=${x.toFixed(4)}`),d>0&&(i+=Math.abs(n[d-1].fpr-n[d].fpr)*(n[d-1].tpr+n[d].tpr)/2)}return{rocCurve:n,auc:i}})}createTransferModelFromBaseModel(){C(this.words!=null,()=>"No word example is available for tranfer-learning model of name "+this.name);const e=this.baseModel.layers;let t=e.length-2;for(;t>=0&&e[t].getClassName().toLowerCase()!=="dense";)t--;if(t<0)throw new Error("Cannot find a hidden dense layer in the base model.");this.secondLastBaseDenseLayer=e[t];const n=this.secondLastBaseDenseLayer.output;this.transferHead=Aa(),this.transferHead.add(ja({units:this.words.length,activation:"softmax",inputShape:n.shape.slice(1),name:"NewHeadDense"}));const i=this.transferHead.apply(n);this.model=On({inputs:this.baseModel.inputs,outputs:i})}modelInputShape(){return this.baseModel.inputs[0].shape}getMetadata(){return{tfjsSpeechCommandsVersion:ri,modelName:this.name,timeStamp:new Date().toISOString(),wordLabels:this.wordLabels()}}async save(e){const t=e!=null;if(e=e||hn(this.name),!t){const n=ns.localStorage.getItem(ss),i=n==null?{}:JSON.parse(n);i[this.name]=this.getMetadata(),ns.localStorage.setItem(ss,JSON.stringify(i))}return console.log(`Saving model to ${e}`),this.model.save(e)}async load(e){const t=e!=null;if(e=e||hn(this.name),!t){const n=JSON.parse(ns.localStorage.getItem(ss));if(n==null||n[this.name]==null)throw new Error(`Cannot find metadata for transfer model named ${this.name}"`);this.words=n[this.name].wordLabels,console.log(`Loaded word list for model named ${this.name}: ${this.words}`)}this.model=await ls(e),console.log(`Loaded model from ${e}:`),this.model.summary(),this.collateTransferWords()}setWords(e){this.words=e}createTransfer(e){throw new Error("Creating transfer-learned recognizer from a transfer-learned recognizer is not supported.")}}function hn(s){return`${Jo}${s}`}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oi(s,e,t,n){if(C(t==null&&n==null||t!=null&&n!=null,()=>"customModelURL and customMetadataURL must be both provided or both not provided."),t!=null&&C(e==null,()=>"vocabulary name must be null or undefined when modelURL is provided."),s==="BROWSER_FFT")return new Ge(e,t,n);throw s==="SOFT_FFT"?new Error("SOFT_FFT SpeechCommandRecognizer has not been implemented yet."):new Error(`Invalid fftType: '${s}'`)}class Ft extends Be{constructor(){super(...arguments);l(this,"model")}async start(){if(this.model)throw"already started";const e=await oi("BROWSER_FFT");this.model=e,await e.listen(async t=>{console.log(t);let n=0,i=-1;if(t.scores.forEach((a,r)=>{a>.8&&a>n&&(n=a,i=r)}),i>=0){const r=e.wordLabels()[i];this.emit("say",{word:r,score:n})}},{includeSpectrogram:!0,probabilityThreshold:.75})}async stop(){if(!this.model)throw"not started";await this.model.stopListening(),this.model=null}}l(Ft,"type","speech"),l(Ft,"clsname","speech"),l(Ft,"clsid",P.speech);class li extends Fe{constructor(e,t){super(e,t);const n={start:class extends A{constructor(a){super(a,"start")}},stop:class extends A{constructor(a){super(a,"stop")}}};for(const a of Object.entries(n)){const[r,o]=a;this.actions[r]=o}delete this.actions.clone;const i={say:oe({name:"say",params:{word:{type:"string",name:"word"}}})};Object.entries(i).forEach(([a,r])=>{this.events[a]=r})}}l(li,"runtime",Ft);var Ko=[li];function pn(s){return s.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()).replace(/^\w/,e=>e.toLowerCase())}class el extends le{constructor(e,t,n){if(!n)throw new Error("prosthesis is not initialized");const i=n;super(e,t,i);l(this,"mixer");l(this,"clips");l(this,"sounds");l(this,"animations");l(this,"moveSpeed",0);l(this,"rotateSpeed",0);this.mixer=new An(i.object),this.clips=i.clips,this.sounds=Object.fromEntries(Object.entries(i.sounds).map(([a,r])=>[pn(a),r.clone().add(this.object)])),this.animations=Object.fromEntries(Object.entries(i.clips).map(([a,r])=>[pn(a),this.mixer.clipAction(r)]))}do({name:e,speed:t,loop:n}){const i=this.animations[e];if(i){if(i.isRunning())return}else throw new Error(`unknown action: ${e}`);i.clampWhenFinished=!0,i.reset().setLoop(n?jn:In,n?1/0:1).setEffectiveTimeScale(t||1).setEffectiveWeight(1).fadeIn(1).play();const a=this.sounds[e];a&&(n&&(a.loop=!0),a.play())}stop({name:e}){const t=this.animations[e];if(t){if(e==="move"){this.moveSpeed=0;return}else if(e==="turn"){this.rotateSpeed=0;return}else if(!t.isRunning())return}else{if(e!=="all")throw new Error(`unknown action: ${e}`);for(const[i,a]of Object.entries(this.animations)){a.isRunning()&&a.fadeOut(1);const r=this.sounds[i];r&&r.stop()}this.moveSpeed=0,this.rotateSpeed=0;return}t.fadeOut(1);const n=this.sounds[e];n&&n.stop()}move({distance:e}){this.moveSpeed=e}turn({angle:e}){this.rotateSpeed=e}update(e,t,n){this.moveSpeed&&this.object.translateZ(this.moveSpeed*e),this.rotateSpeed&&this.object.rotateY(this.rotateSpeed*e),this.mixer.update(e)}}class tl extends _e{constructor(e,t,n){super(e,t,n);const i=t,a=this,r={do:class extends A{constructor(o){super(o,"do");l(this,"slots",{name:B({name:"name",data:ge(a,{},()=>Object.keys(i.animations)),required:!0}),speed:B({name:"speed",data:{type:"number",min:1e-4,max:10}}),loop:B({name:"loop",data:{type:"boolean"}})})}},stop:class extends A{constructor(o){super(o,"stop");l(this,"slots",{name:B({name:"name",data:ge(a,{},()=>Object.keys(i.animations).concat(["all"])),required:!0})})}},turn:class extends A{constructor(o){super(o,"turn");l(this,"slots",{angle:B({name:"target.angle",data:{type:"number"},required:!0})})}},move:class extends A{constructor(o){super(o,"move");l(this,"slots",{distance:B({name:"target.distance",data:{type:"number"},required:!0})})}}};for(const o of Object.entries(r)){const[c,u]=o;this.actions[c]=u}for(const o of Object.keys(t.animations))this.actions[o]=class extends A{constructor(c){super(c,o,async()=>{await i.do({name:o,loop:!0})})}}}}class Bt extends el{static async create(e,t,n){const i=await new _s().loadAsync("./assets/models/gltf/RobotExpressive/RobotExpressive.glb"),a={object:i.scene,clips:Object.fromEntries(i.animations.map(r=>[r.name,r])),sounds:{}};return super.create(e,t,Object.assign({},n||{},a))}}l(Bt,"type","object"),l(Bt,"clsname","RobotExpressive"),l(Bt,"clsid","9e8f7f7f-f8f8-4f8f-8f8f-8f8f8f8f8f8f");class ci extends tl{constructor(e,t,n){super(e,t,n);delete this.properties.material}}l(ci,"runtime",Bt);function sl(s){return s.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()).replace(/^\w/,e=>e.toLowerCase())}const mn=new xe,nl=new xe(0,0,1);class ui extends le{constructor(e,t,n){if(!n)throw new Error("prosthesis is not initialized");const{object:i,clips:a}=n,r=new _n().setFromObject(i);r.getCenter(new xe);const o=r.getSize(new xe).y;super(e,t,{object:i});l(this,"mixer");l(this,"clips");l(this,"animations");l(this,"capsule");l(this,"moveSpeed");this.capsule=new Ia(.2,.2,o,32,1),this.moveSpeed=0,this.mixer=new An(i),this.clips=a,this.animations=Object.fromEntries(Object.entries(a).map(([c,u])=>[sl(c),this.mixer.clipAction(u)]))}do({name:e,speed:t,loop:n}){const i=this.animations[e];if(i){if(i.isRunning())return}else throw new Error(`unknown action: ${e}`);i.clampWhenFinished=!0,i.reset().setLoop(n?jn:In,n?1/0:1).setEffectiveTimeScale(t||1).setEffectiveWeight(1).fadeIn(1).play(),fe.sounds[e]&&this.playSound({name:e,loop:n})}stop({name:e}){const t=this.animations[e];if(t)if(e==="move"){this.moveSpeed=0;return}else{if(e==="turn")return;if(!t.isRunning())return}else{if(e!=="all")throw new Error(`unknown action: ${e}`);for(const[i,a]of Object.entries(this.animations))a.isRunning()&&a.fadeOut(1);this.stopSound({}),this.moveSpeed=0;return}t.fadeOut(1),fe.sounds[e]&&this.playSound({name:e})}move({speed:e}){this.moveSpeed=e}turn({angle:e}){this.object.rotateY(Math.PI*e/180)}collide(e){var r;if(!this.parent)return"";const t=e.clone().add(this.center),n=Object.values(this.parent.children).map(o=>o.object).filter(o=>o!==this.object),i=(r=this.capsule.getAttribute("position"))==null?void 0:r.array,a=(i==null?void 0:i.length)/3;for(let o=0;o<a;o++){const c=i[o*3],u=i[o*3+1],h=i[o*3+2],d=new xe(c,u,h),f=new Sn(t,d).intersectObjects(n);if(f.length)return f[0].object.userData.uid}return""}update(e,t,n){if(this.moveSpeed){mn.copy(nl).applyQuaternion(this.object.quaternion);const i=this.position.clone().add(mn.multiplyScalar(this.moveSpeed*e)),a=this.collide(i);a?this.emit("collide",{target:a}):this.object.translateZ(this.moveSpeed*e)}this.mixer.update(e)}}class di extends _e{constructor(e,t,n){super(e,t,n);const i=t,a=this,r={do:class extends A{constructor(c){super(c,"do");l(this,"slots",{name:B({name:"name",data:ge(a,{},()=>Object.keys(i.animations)),required:!0}),speed:B({name:"speed",data:{type:"number",min:1e-4,max:10}}),loop:B({name:"loop",data:{type:"boolean"}})})}},stop:class extends A{constructor(c){super(c,"stop");l(this,"slots",{name:B({name:"name",data:ge(a,{},()=>Object.keys(i.animations).concat(["all"])),required:!0})})}},turn:class extends A{constructor(c){super(c,"turn");l(this,"slots",{angle:B({name:"target.angle",data:{type:"number"},required:!0})})}},move:class extends A{constructor(c){super(c,"move");l(this,"slots",{speed:B({name:"speed",data:{type:"number"},required:!0})})}}};for(const c of Object.entries(r)){const[u,h]=c;this.actions[u]=h}for(const c of Object.keys(t.animations))this.actions[c]=class extends A{constructor(u){super(u,c,async()=>{await i.do({name:c,loop:!0})})}};const o={collide:oe({name:"collide",params:{target:{type:"string",name:"target"}}})};Object.entries(o).forEach(([c,u])=>{this.events[c]=u})}}class zt extends ui{static async create(e,t,n){const i=await new _s().loadAsync("./assets/models/gltf/Xbot.glb");i.scenes;const a={object:i.scene,clips:Object.fromEntries(i.animations.map(r=>[r.name,r]))};return super.create(e,t,Object.assign({},n||{},a))}}l(zt,"type","object"),l(zt,"clsname","Xbot"),l(zt,"clsid","9e8f7f7f-f8f8-4f8f-8f8f-8f8f8f8f8fa1");class hi extends di{constructor(e,t,n){super(e,t,n);delete this.properties.material}}l(hi,"runtime",zt);class Ot extends ui{static async create(e,t,n){const i=await new _s().loadAsync("./assets/models/gltf/Soldier.glb"),a={object:i.scene,clips:Object.fromEntries(i.animations.map(r=>[r.name,r]))};return super.create(e,t,Object.assign({},n||{},a))}}l(Ot,"type","object"),l(Ot,"clsname","Soldier"),l(Ot,"clsid","9e8f7f7f-f8f8-4f8f-8f8f-8f8f8f8f8fa0");class pi extends di{constructor(e,t,n){super(e,t,n);delete this.properties.material}}l(pi,"runtime",Ot);var il=[ci,hi,pi];const al=`
void main() {
  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
  gl_PointSize = 10.0;
  gl_Position = projectionMatrix * mvPosition;
}`,rl=`
uniform vec3 color;
void main() {
  gl_FragColor = vec4( color, 1.0 );
}`,Ye=17,mi=20,ol=mi*Ye,lt=3;class At extends le{constructor(e,t){const n=new Float32Array(mi*Ye*lt),i=new La;i.setAttribute("position",new Ua(n,lt));const a=new Ra({uniforms:{color:{value:new Es(16777215)}},vertexShader:al,fragmentShader:rl}),r=new Na(i,a);super(e,t,{object:r});l(this,"offset",0);l(this,"frameCount",0)}update(e,t,n){const{pose:i}=this.properties;if(!i)return;this.frameCount++;const a=this.properties.gap||1;if(this.frameCount%a!==0)return;const r=this.properties.width||1,o=this.properties.height||1,c=this.object,u=c.geometry.attributes.position.array;let h=this.offset;for(const d of Object.values(i)){const p=h*lt;u[p]=d.x/r-.5,u[p+1]=d.y/o-.5,u[p+2]=0,h++}for(let d=0;d<ol;d++){const p=d*lt;u[p+2]-=.01}c.geometry.attributes.position.needsUpdate=!0,this.offset+=Ye,this.offset===Ye*Ye&&(this.offset=0)}}l(At,"type","object"),l(At,"clsname","skeleton"),l(At,"clsid","9e8f7f7f-f8f8-4f8f-8f8f-8f8f8f8f8fa2");class vs extends _e{constructor(e,t,n){super(e,t,n);const i={width:S(t,{name:"width",type:"number"}),height:S(t,{name:"height",type:"number"}),gap:S(t,{name:"gap",type:"number"}),pose:S(t,{name:"pose",type:"json"})};for(const a of Object.entries(i)){const[r,o]=a;this.properties[r]=o}}}l(vs,"runtime",At),l(vs,"tags",["shape","3d"]);var ll=[vs];async function cl(){await v.init(il.concat(ll),Ko)}async function ul(){await cl()}var fi={beforeLaunch(s,e,t){s.mixin({computed:{$app:()=>this,$rpc:()=>K,$prj:()=>v,$textures:()=>v.screen.getTextures()},methods:{$makeDirty(){re.state.revision++}}}),K.setupObserver({onPending(n){re.state.isNetBusy=!!n},onAlert(n){console.warn(n),Pa({type:"error",title:"\u8BF7\u6C42\u5931\u8D25",message:n.message||n.toString()})}}),Promise.all([ul(),K.start()]).then(async()=>{re.state.isLoading=!1;try{await v.screen.setup({font:"/assets/fonts/helvetiker_regular.typeface.json",texture:"/__egg__/assets/textures",sounds:"/__egg__/assets/sounds"});const n=await ai.load();await v.unserialize(n),v.screenEditor.afterLoad()}catch(n){console.error(n)}re.state.revision=0})},onLaunched(s,e,t){console.log("launched"),new Va().showPanel(0)}};const fn="m 0,4 A 4,4 0 0,1 4,0",dl="a 4,4 0 0 0 -4,4",is="a 4,4 0 0,1 4,4",gn="a 4,4 0 0,1 -4,4",as="a 4,4 0 0,1 -4,-4 z",hl="a 4,4 0 0,0 4,4",rs="c -2,0 -3,1 -4,2 l -4,4 c -1,1 -2,2 -4,2 h -12 c -2,0 -3,-1 -4,-2 l -4,-4 c -1,-1 -2,-2 -4,-2",yn="c 2,0 3,1 4,2 l 4,4 c 1,1 2,2 4,2 h 12 c 2,0 3,-1 4,-2 l 4,-4 c 1,-1 2,-2 4,-2",Se=120,Q=40,gi=60,Pe=30,ct=7,pl=20;var Ee={chainStart(s,e,t){return t=Math.max(t||0,12),e=e<=Se?Se:e,s.path([fn,`H ${e-4}`,is,`v ${t-8}`,gn,"H 48",rs,"H 4",as].join(" "))},block(s,e,t,n){e=e<=Se?Se:e,t||(t=[Q]);const i=t.length;if(i%2===0)throw new Error("sections must be even");const a=[fn,"H 12",yn,`H ${e-4}`,is];for(let r=0;r<i;r++){const o=Math.max(Q,t[r]),c=r===i-1;a.push(`v ${o-8}`),r%2===0?(a.push(gn),c?n?a.push("H 4",as):a.push("H 48",rs," H 4",as):a.push("H 68",rs,"H 24",dl)):a.push(hl,"H 32",yn,`H ${e-4}`,is)}return s.path(a.join(" "))},dataSlot(s,e,t){t=t<=Pe?Pe:t,e=Math.max(e,gi,t);const n=t/2;return s.path([`m 0,${n} A ${n},${n} 0 0 1 ${n},0 H ${e-n} a ${n},${n} 0 0 1 ${n},${n}`,`a ${n},${n} 0 0 1 -${n},${n} H ${n} a ${n},${n} 0 0 1 -${n},-${n}`,"z"].join(" "))},link(s,e,t){const{x:n,y:i}=s.rbox(),{x:a,y:r,w:o,h:c}=e.rbox(),{x:u,y:h}=t.rbox(),d=a-n+o/2,p=r-i+c,f=u-n+32,g=h-i,b=(g-p)*.614;return s.path(`M ${d},${p} C ${d},${p+b} ${f},${g-b} ${f},${g}`)}};const ml=navigator,fl=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),Je="ontouchstart"in window||ml.maxTouchPoints;var gl={randomString(s){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-",t=e.length;return Array(s).fill(0).map(()=>e[Math.floor(Math.random()*t)]).join("")},getSystemLang(){return navigator.language},isModile(){return fl}};function xs(s,e,t){return s.node.setAttribute("draggable","true"),s.node.ondragstart=n=>{s.node.setAttribute("dragging","true"),e&&e(n)},s.node.ondragend=n=>{s.node.setAttribute("dragging","false"),t&&t(n)},s}function Ae(s,e){return s.node.ondrop=t=>{e&&e(t)},s}const X=document.createElement("div"),q=document.createElement("i"),ut=Je?45:30,dt=Je?90:60;class yl{constructor(e){l(this,"elementClick",null);l(this,"elementDragging",null);l(this,"elementOver",null);l(this,"dataTransfer",null);l(this,"isMoved",!1);this.dom=e,X.isConnected||(X.style.display="none",X.style.position="absolute",X.style.width=`${ut}px`,X.style.height=`${ut}px`,X.style.marginLeft=`-${ut/2}px`,X.style.marginTop=`-${ut/2}px`,X.style.borderRadius="50%",X.style.backgroundColor="#888",X.style.zIndex="9999",X.style.pointerEvents="none",document.body.appendChild(X),q.style.display="none",q.style.position="absolute",q.style.width=`${dt}px`,q.style.height=`${dt}px`,q.style.borderRadius="50%",q.style.color="#fff",q.style.fontSize=`${dt*2/3}px`,q.style.backgroundColor="#F56C6C",q.style.lineHeight=`${dt}px`,q.style.textAlign="center",q.style.zIndex="9998",q.classList.toggle("trash"),q.classList.toggle("icon-trash"),q.ondrop=a=>{a.dataTransfer&&a.dataTransfer.setData("selfRemove","true")},document.body.appendChild(q));const t=a=>{const r=document.elementFromPoint(a.clientX,a.clientY);if(this.elementClick=r,!(!r||r.getAttribute("draggable")!=="true"))return this.dataTransfer=null,this.elementDragging=r,this.isMoved=!1,Je||(e.addEventListener("pointerup",i),e.addEventListener("pointermove",n),e.setPointerCapture(a.pointerId)),a.preventDefault&&(a.preventDefault(),a.stopPropagation()),this.showCursor(a.clientX,a.clientY),!0};Je?(e.addEventListener("touchstart",a=>{t({clientX:a.pageX,clientY:a.pageY})&&(a.preventDefault(),a.stopPropagation())}),e.ontouchmove=a=>{n({clientX:a.pageX,clientY:a.pageY})&&(a.preventDefault(),a.stopPropagation())},e.ontouchend=a=>{i({clientX:a.pageX,clientY:a.pageY})&&(a.preventDefault(),a.stopPropagation())}):e.addEventListener("pointerdown",t);const n=a=>{if(!this.elementDragging)return;if(!this.isMoved){this.isMoved=!0,!!this.elementDragging.getAttribute("showTrash")&&this.showTrash(),this.dataTransfer=new DataTransfer;const u=new DragEvent("dragstart",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer});this.elementDragging.dispatchEvent(u)}const r=document.elementFromPoint(a.clientX,a.clientY);if(!r)return!0;if(r!==this.elementOver){if(this.elementOver){this.elementOver.setAttribute("isdragover","false");const c=new DragEvent("dragleave",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer});this.elementOver.dispatchEvent(c)}this.elementOver=r,this.elementOver.setAttribute("isdragover","true")}this.moveCursor(a.clientX,a.clientY);const o=new DragEvent("dragover",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer});return r==null||r.dispatchEvent(o),!0},i=a=>{const r=document.elementFromPoint(a.clientX,a.clientY);if(this.hideCursor(),!!this.elementDragging){if(!r)return this.isMoved=!1,this.elementDragging.dispatchEvent(new DragEvent("dragend",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer})),this.elementDragging=null,!0;if(this.isMoved&&r!==this.elementDragging){const o=new DragEvent("drop",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer});r.dispatchEvent(o)}else r.dispatchEvent(new Event("click"));return this.elementDragging.dispatchEvent(new DragEvent("dragend",{clientX:a.clientX,clientY:a.clientY,dataTransfer:this.dataTransfer})),this.elementDragging=null,this.elementOver&&(this.elementOver.removeAttribute("isdragover"),this.elementOver=null),Je||(e.removeEventListener("pointermove",n),e.removeEventListener("pointerup",i)),!0}}}showCursor(e,t){X.style.display="block",X.style.left=`${e}px`,X.style.top=`${t}px`;const n=e<window.innerWidth/2?e+300:e-300;q.style.left=`${n}px`,q.style.top=`${t-q.clientHeight/2}px`}showTrash(){q.style.display="block"}moveCursor(e,t){X.style.left=`${e}px`,X.style.top=`${t}px`}hideCursor(){X.style.display="none",q.style.display="none"}}function Cs(s,e,t){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","type"),s.dataTransfer.setData("name",e),s.dataTransfer.setData("from",t)}function bn(s,e){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","unit"),s.dataTransfer.setData("uuid",e)}function bl(s,e,t){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","block"),s.dataTransfer.setData("unit",e.unit.uuid),s.dataTransfer.setData("chain",e.id),s.dataTransfer.setData("block",t.id)}function vl(s,e,t){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","action"),s.dataTransfer.setData("unit",e.uuid),s.dataTransfer.setData("action",t)}function xl(s,e){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","var"),s.dataTransfer.setData("name",e)}function wl(s,e,t){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","event"),s.dataTransfer.setData("unit",e.uuid),s.dataTransfer.setData("name",t)}function _l(s,e,t){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","linker"),s.dataTransfer.setData("unit",e.uuid),s.dataTransfer.setData("chain",t.id)}function El(s,e){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","material"),s.dataTransfer.setData("uuid",e)}function Dl(s,e){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","texture"),s.dataTransfer.setData("uuid",e)}function Sl(s,e){if(!s.dataTransfer)throw new Error("no dataTransfer");s.dataTransfer.setData("type","class"),s.dataTransfer.setData("name",e)}function ie(s){if(!s.dataTransfer)return;const e=s.dataTransfer.getData("type");if(!!e)switch(e){case"type":return{type:"type",name:s.dataTransfer.getData("name"),from:s.dataTransfer.getData("from")};case"unit":return{type:"unit",uuid:s.dataTransfer.getData("uuid")};case"block":return{type:"block",unit:s.dataTransfer.getData("unit"),chain:s.dataTransfer.getData("chain"),block:s.dataTransfer.getData("block")};case"action":return{type:"action",unit:s.dataTransfer.getData("unit"),action:s.dataTransfer.getData("action")};case"var":return{type:"var",name:s.dataTransfer.getData("name")};case"event":return{type:"event",unit:s.dataTransfer.getData("unit"),name:s.dataTransfer.getData("name")};case"linker":return{type:"linker",unit:s.dataTransfer.getData("unit"),chain:s.dataTransfer.getData("chain")};case"material":return{type:"material",uuid:s.dataTransfer.getData("uuid")};case"texture":return{type:"texture",uuid:s.dataTransfer.getData("uuid")};case"class":return{type:"class",name:s.dataTransfer.getData("name")}}}var Cl={at:{agree:"\u540C\u610F",clone:"\u514B\u9686",collide:"\u78B0\u649E\u68C0\u6D4B",dance:"\u8DF3\u821E",detect:"\u68C0\u6D4B",die:"\u6D88\u5931",do:"\u6267\u884C",delayExecute:"\u5EF6\u8FDF",close:"\u5173\u95ED",else:"\u5426\u5219",equal:"\u5224\u65AD",findUnit:"\u67E5\u627E\u5BF9\u8C61",gesture:"\u624B\u52BF\u68C0\u6D4B",get:"\u83B7\u53D6",headShake:"\u6447\u5934",idle:"\u7A7A\u95F2",if:"\u5982\u679C",ifElse:"\u5982\u679C",jump:"\u8DF3\u8DC3",then:"\u90A3\u4E48",loop:"\u5FAA\u73AF",loopUntill:"\u5FAA\u73AF\u76F4\u5230",move:"\u79FB\u52A8",open:"\u6253\u5F00",playSound:"\u64AD\u653E\u97F3\u6548",stopSound:"\u505C\u6B62\u97F3\u6548",repeat:"\u91CD\u590D",run:"\u8DD1\u6B65",say:"\u8BF4\u8BDD",scale:"\u7F29\u653E",set:"\u8BBE\u7F6E",sneakPose:"\u6F5C\u884C",start:"\u5F00\u59CB",stop:"\u505C\u6B62",thumbsUp:"\u70B9\u8D5E",time:"\u5F53\u524D\u65F6\u95F4",to3D:"\u8F6C3D\u5750\u6807",turn:"\u8F6C\u5411",valueFromEvent:"\u4ECE\u4E8B\u4EF6\u4E2D\u83B7\u53D6\u503C",walk:"\u8D70\u8DEF",walkJump:"\u8D70\u8DEF\u8DF3\u8DC3",wave:"\u6325\u624B",while:"\u5FAA\u73AF",math:{add:"\u52A0",div:"\u9664",equal:"\u5224\u65AD",greaterThen:"\u5927\u4E8E",greaterThenOrEqual:"\u5927\u4E8E\u7B49\u4E8E",lessThen:"\u5C0F\u4E8E",lessThenOrEqual:"\u5C0F\u4E8E\u7B49\u4E8E",mul:"\u4E58",mod:"\u53D6\u4F59",not:"\u53D6\u53CD",sub:"\u51CF",random:"\u968F\u673A"},var:{new:"\u65B0\u5EFA\u53D8\u91CF"}},ev:{change:"\u6709\u53D8\u5316",clone:"\u514B\u9686",collide:"\u78B0\u649E\u68C0\u6D4B",gesture:"\u76D1\u6D4B\u5230\u624B\u52BF",frame:"\u6BCF\u5E27",pose:"\u76D1\u6D4B\u5230\u59FF\u52BF",say:"\u4EBA\u6709\u8BF4\u8BDD",start:"\u5F00\u59CB",stop:"\u505C\u6B62"},nm:{all:"\u5168\u90E8",ambient:"\u73AF\u5883\u5149",box:"\u76D2\u5B50",bulb:"\u706F\u6CE1",camera:"\u76F8\u673A",cube:"\u7ACB\u65B9\u4F53",chick:"EGG",death:"\u6B7B\u4EA1",default:"\u9ED8\u8BA4",device:"\u8BBE\u5907",egg:"EGG",five:"\u624B\u638C",fist:"\u62F3\u5934",frame:"\u5E27",gesture:"\u624B\u52BF",global:"\u5168\u5C40",ground:"\u5730\u9762",image:"\u56FE\u7247",light:"\u5149\u6E90",logic:"\u903B\u8F91",material:"\u6750\u8D28",math:"\u6570\u5B66",millisecond:"\u6BEB\u79D2",name:"\u540D\u79F0",plane:"\u5E73\u9762",pose:"\u59FF\u52BF",position:"\u4F4D\u7F6E",punch:"\u62F3\u51FB",readonly:"\u4E0D\u53EF\u7F16\u8F91",rotation:"\u65CB\u8F6C",second:"\u79D2",scene:"\u573A\u666F",screen:"\u5C4F\u5E55",speech:"\u8BED\u97F3",sphere:"\u7403\u4F53",spot:"\u70B9\u5149\u6E90",storage:"\u5B58\u50A8",test:"\u6D4B\u8BD5",text:"\u6587\u672C",texture:"\u7EB9\u7406",time:"\u65F6\u95F4",times:"\u6B21",timer:"\u8BA1\u65F6\u5668",type:"\u7C7B\u578B",value:"\u503C",variable:"\u53D8\u91CF",victory:"V\u5B57\u5F62",unit:"\u5BF9\u8C61",wind:"\u98CE"},pr:{unit:{color:"\u989C\u8272",material:"\u6750\u8D28",name:"\u540D\u79F0",mass:"\u8D28\u91CF",velocity:"\u901F\u5EA6",force:"\u5916\u529B",friction:"\u6469\u64E6\u7CFB\u6570",restitution:"\u6062\u590D\u7CFB\u6570",position:"\u4F4D\u7F6E",power:"\u529F\u7387",rotation:"\u65B9\u5411",radius:"\u534A\u5F84",visible:"\u662F\u5426\u53EF\u89C1",distance:"\u8DDD\u79BB",width:"\u5BBD\u5EA6",height:"\u9AD8\u5EA6",depth:"\u6DF1\u5EA6",ground:{material:"\u6750\u8D28"},light:{on:"\u5F00\u5173",color:"\u989C\u8272",intensity:"\u5F3A\u5EA6",position:"\u4F4D\u7F6E"},sky:{color:"\u5929\u7A7A\u989C\u8272"},spot:{on:"\u5F00\u5173",color:"\u989C\u8272",intensity:"\u5F3A\u5EA6",position:"\u4F4D\u7F6E"},ambient:{on:"\u5F00\u5173",color:"\u989C\u8272"},wind:{force:"\u98CE\u529B"},widthSegments:"\u5BBD\u5EA6\u5206\u6BB5",heightSegments:"\u9AD8\u5EA6\u5206\u6BB5"},texture:{offset:"\u504F\u79FB",repeat:"\u91CD\u590D",center:"\u4E2D\u5FC3",mapping:"\u6620\u5C04",wrapS:"S\u65B9\u5411",wrapT:"T\u65B9\u5411",magFilter:"\u653E\u5927\u8FC7\u6EE4",minFilter:"\u7F29\u5C0F\u8FC7\u6EE4",format:"\u683C\u5F0F",type:"\u7C7B\u578B",anisotropy:"\u5404\u5411\u5F02\u6027",encoding:"\u7F16\u7801"},material:{name:"\u6750\u8D28"}},se:{and:"\u548C",from:"\u4ECE",milliseconds:"\u6BEB\u79D2",placeHolder:"\u53EF\u62D6\u653E$0\u5230\u6B64",same:"\u76F8\u540C",to:"\u5230",tois:"\u4E3A",valueof:"\u7684\u503C",logic:{else:"\u5426\u5219",then:"\u90A3\u4E48",times:"\u6B21"},math:{"+":"+","-":"-","*":"*","/":"/","==":"==",">":">",">=":">=","<":"<","<=":"<=","!":"!","%":"%"}},st:{running:"\u8DD1\u6B65",sadPose:"\u60B2\u4F24",sitting:"\u5750\u4E0B",standing:"\u7AD9\u7ACB",tPose:"T\u5B57\u578B",walking:"\u8D70\u8DEF"},ty:{data:{boolean:"\u5E03\u5C14\u503C",number:"\u6570\u5B57",string:"\u5B57\u7B26\u4E32",time:"\u65F6\u95F4",color:"\u989C\u8272",vec2:"\u4E8C\u7EF4\u5750\u6807",vec3:"\u4E09\u7EF4\u5750\u6807",json:"JSON",octets:"\u4E8C\u8FDB\u5236",stream:"\u6D41",texture:"\u7EB9\u7406",material:"\u6750\u8D28",unit:"\u5BF9\u8C61",unknown:"\u672A\u77E5"},material:{linebasic:"\u7EBF\u6750\u8D28",linedashed:"\u865A\u7EBF\u6750\u8D28",basic:"\u57FA\u7840\u6750\u8D28",depth:"\u6DF1\u5EA6\u6750\u8D28",distance:"\u8DDD\u79BB\u6750\u8D28",lambert:"\u62C9\u7C73\u7279\u6750\u8D28",matcap:"Matcap\u6750\u8D28",normal:"\u6CD5\u7EBF\u6750\u8D28",phong:"Phong\u6750\u8D28",physical:"\u7269\u7406\u6750\u8D28",standard:"\u6807\u51C6\u6750\u8D28",toon:"Toon\u6750\u8D28",points:"\u70B9\u6750\u8D28",shader:"\u7740\u8272\u5668\u6750\u8D28",shadow:"\u9634\u5F71\u6750\u8D28",sprite:"\u7CBE\u7075\u6750\u8D28"}},g:{zh:"\u4E2D\u6587",en:"\u82F1\u6587"}},kl={agree:"agree",camera:{start:"start",stop:"stop"},chick:{stop:"stop"},clone:"clone",collide:"collide",default:"default",devices:"devices",findUnit:"find unit",frame:"frame",g:{zh:"zh",en:"en"},gesture:{five:"five",fist:"fist",victory:"victory",detect:"detect",start:"start",stop:"stop"},headShake:"head shake",idle:"idle",move:"move",position:"position",prop:{type:"type",name:"name",value:"value"},rotation:"rotation",run:"run",sadPose:"sad pose",scale:"scale",scene:"scene",screen:"screen",sneakPose:"sneak pose",start:"start",stop:"stop",turn:"turn",tickMs:"tick per ms",tickS:"tick per s",timer:{time:"now"},tPose:"T post","'s value":"'s value","to.is":"to",unit:{get:"get property",set:"set property"},var:{new:"new"},vars:"vars",victory:"victory",walk:"walk"},ks={"zh-CN":Cl,"en-US":kl};const ws=localStorage.getItem("locale")||Object.keys(ks).find(s=>s===gl.getSystemLang())||"zh-CN",Ms=Ha({locale:ws,fallbackLocale:ws,messages:ks});function Ml(s){return!Object.keys(ks).includes(s)||localStorage.getItem("locale")===s?!1:(Ms.global.locale=s,localStorage.setItem("locale",s),!0)}function Tl(s){return s.replace(/[-_](\w)/g,(e,t)=>t.toUpperCase()).replace(/^\w/,e=>e.toLowerCase())}function he(s,e){if(!s||typeof s!="string")return s!=null?s:"";const t=Ms.global.t(Tl(s));return t.indexOf(".")!==-1&&e?he(e):t}const ht={x:20,y:60},vn={x:40,y:0},$l={x:6,y:6},se={x:4,y:4},xn=Q/2-Pe/2,Fl=4;var jt={defs(s){const e=s.defs();return e.marker(10,10,function(t){t.path("M2,2 L8,5 L2,8 L5,5 L2,2").fill("rgb(204, 153, 0)")}).ref(8,5).attr({orient:"auto"}).id("bezier-arrow").style({"stroke-width":"1px"}),e.marker(8,8,function(t){t.circle(3).cx(5).cy(5).fill("rgb(204, 153, 0)")}).ref(5,5).id("dot").style({stroke:"none"}),e},redraw(){re.state.revision++},drawSlot(s,e,t,n){var o;const i=s.group(),a={g:i,width:gi,height:Pe};let r=0;if(n.prefix&&n.data){const c=s.text(he(`se.${n.prefix}`)).addClass("it-block-title");c.y(Q/2-c.bbox().height/2),r+=c.bbox().width+se.x,i.add(c)}if(n.isLabelOnly){const c=s.text(n.label||"").addClass("it-block-title");c.y(Q/2-c.bbox().height/2),c.x(r),i.add(c),r+=c.bbox().width+se.x}else if(n.block){const{width:c,height:u}=this.drawBlocks(s,e,t,n.block,i,0,n,!!n.data);r+=c+se.x,a.height=Math.max(a.height,u)}else if(n.data){const c=s.text(`${he((o=n.data.value)!=null?o:"")}`).addClass("it-slot-text");c.y(Q/2-c.bbox().height/2),c.x(se.x);const u=Ee.dataSlot(s,c.bbox().width+se.x*2,Pe).addClass("it-theme-slot");u.x(r).y(xn),c.x(r+u.width()/2),i.add(u),i.add(c),r+=u.width()+se.x,t&&(u.click(()=>{var h;Ue({scope:"slot",type:((h=n.data)==null?void 0:h.type)||"unknown",name:n.name,slot:n})}),Ae(u,h=>{const d=ie(h);if(!d)throw new Error("no data transfer");if(d.type==="action"){const p=v.findUnit(d.unit);if(!p)throw new Error("no unit");if(p.actions[d.action].type!=="data"){const g=p.createAction(d.action);if(!g.output)throw new Error("not data action");n.block=g}else n.block=p.createAction(d.action);this.redraw()}else if(d.type==="var"){const f=v.devices.storage.createAction("get");f.slots.name.data.value=d.name,n.block=f,this.redraw()}else console.log(h)}))}else if(t){const c=this.drawBlockHolder(s);c.x(r);const{width:u,height:h}=c.bbox();r+=u+se.x,a.height=Math.max(a.height,h)-ct,i.add(c),Ae(c,d=>{const p=ie(d);if(!p)throw new Error("no data transfer");if(p.type==="action"){const f=v.findUnit(p.unit);if(!f)throw new Error("no unit");n.block=f.createAction(p.action),this.redraw()}else if(p.type==="block"){const f=v.findUnit(p.unit);if(!f)throw new Error("no unit");const g=f.chains[p.chain],b=f.findBlock(g,p.block);if(b)f.removeBlock(g,b),n.block=b,this.redraw();else throw new Error("no block")}else console.log(d)})}if(n.suffix){const c=s.text(he(`se.${n.suffix}`)).addClass("it-block-title");c.y(Q/2-c.bbox().height/2),c.x(r),r+=c.bbox().width+se.x,i.add(c)}return a.width=Math.max(a.width,r),a},drawBlockHolder(s){return Ee.block(s,0).addClass("it-block").addClass("it-theme-holder").attr({"stroke-width":"1px","stroke-dasharray":"2,2"})},drawBlock(s,e,t,n,i,a){const r={g:null,width:Se,height:Q};let o=0;const c=[],u=[],h=he(`nm.${n.callee.name}`,n.callee.name),d=he(`at.${n.label||n.name}`,n.label||n.name),p=[[{isLabelOnly:!0,label:`${h}.${d}`}]];for(const x of Object.values(n.slots)){const O=p[p.length-1];x.data?O.push(x):(x.prefix&&O.push({isLabelOnly:!0,label:he(`se.${x.prefix}`)}),p.push([x],[]))}if(a&&p.length>1)throw new Error("only data type block can be in data slot");let f=0,g=0;for(const x of p){let O=g%2?pl:$l.x;g++;let L=0;for(const I of x){if(I.isLabelOnly&&!I.label)continue;const{g:U,width:G,height:te}=this.drawSlot(s,e,t,I);U.translate(O,f),c.push(U);const ue=Math.max(te,Q);L=Math.max(L,ue),O+=G+Fl}f+=L||Q,u.push(L),o<O&&(o=O)}const b=["logic","math"].find(x=>x===n.callee.name)||"action",E=(a?Ee.dataSlot(s,o,u[0]):Ee.block(s,o,u,n.ending)).addClass(`it-theme-${b}`).addClass("it-block"),{height:T}=E.bbox();xs(E,x=>{!x.dataTransfer||(t?bl(x,t,n):vl(x,e,n.name))},x=>{if(!!x.dataTransfer&&x.dataTransfer.getData("unhandled")){const O=x.dataTransfer.getData("block"),L=i;let I=L.block,U=I;for(;I&&I.id!==O;)U=I,I=I.next;if(!U||!I)throw new Error("no block");U===I?L.block=null:U.next=I.next,this.redraw()}});const M=s.group();M.add(E);for(const x of c)M.add(x);return r.g=M,r.width=Math.max(r.width,o),r.height=Math.max(r.height,f,T),n.ending||(r.height-=ct),r},drawBlocks(s,e,t,n,i,a,r,o){const c={width:Se,height:Q};let u=a,h=0,d=!1,p=n,f=p;for(;p;){const{g,height:b,width:E}=this.drawBlock(s,e,t,p,r,o);if(g.translate(0,u),i.add(g),u+=b,h<E&&(h=E),d=d||!!p.ending,f=p,p=p.next,o&&p)throw new Error("data mode can only have one block")}if(f&&!o&&!d){const g=this.drawBlockHolder(s);g.translate(0,u),i.add(g);const{height:b,width:E}=g.bbox();u+=b,h<E&&(h=E),Ae(g,T=>{const M=ie(T);if(!M)throw new Error("no data transfer");if(M.type==="action"){const x=v.findUnit(M.unit);if(!x)throw new Error("no unit");const O=x.createAction(M.action);f.next=O,this.redraw()}else if(M.type==="block"){const x=v.findUnit(M.unit);if(!x)throw new Error("no unit");const O=x.chains[M.chain],L=x.findBlock(O,M.block);if(L)x.removeBlock(O,L),f?f.next=L:t.head=L,this.redraw();else throw new Error("no block")}else console.log(T)})}return o||(u-=ct),c.width=Math.max(c.width,h),c.height=Math.max(c.height,u-a),c},drawChainHead(s,e,t,n){var p;const i=s.group(),{unit:a,id:r,bound:o}=e;let c=null;if(o){const f=o.unit.events[o.event];f.params.name&&(c=f.params.name.values)}const u=t[r]!==!1,h=s.plain(u?"-":"+").addClass("it-block-title"),d=Ee.chainStart(s,0,(c==null?void 0:c.length)?Q:0).addClass("it-block").addClass("it-theme-event");if(d.id(`chain.${r}`),c){h.y(Q/2-h.bbox().height/2),h.x(24);const f=s.text(`${(p=o==null?void 0:o.filter)!=null?p:he("all")}`).addClass("it-slot-text").x(se.x);f.y(Q/2-f.bbox().height/2);const g=Math.max(Se-se.x*2,f.bbox().width+se.x*2),b=Ee.dataSlot(s,g,Pe).addClass("it-theme-event-name");b.x(se.x).y(xn),f.x(se.x+b.width()/2),i.add(d),i.add(h),i.add(b),i.add(f),b.click(()=>{const E=new Proxy({type:"string",values:c},{get(T,M,x){return M==="value"?o==null?void 0:o.filter:Reflect.get(T,M,x)},set(T,M,x,O){return o&&M==="value"?(o.filter=x,n(),!0):Reflect.set(T,M,x,O)}});Ue({scope:"slot",type:"string",name:"name",slot:{name:"name",data:E}})}),(o==null?void 0:o.filter)&&b.dblclick(()=>{o&&(o.filter=void 0,n())})}else h.x(24).y(0),i.add(d),i.add(h);return Ae(d,f=>{const g=ie(f);if(!g)throw new Error("no data transfer");if(g.type==="event"){const b=v.findUnit(g.unit);if(!b)throw new Error("no unit");b.bindEvent(g.name,e),this.redraw()}else console.log(f)}),d.click(()=>{t[r]=!u,n()}),xs(d,f=>{_l(f,a,e)}),{width:d.bbox().width,height:d.bbox().height,g:i}},drawChains(s,e,t,n,i){let a=ht.x+vn.x,r=0;const o={};t+=ht.y;for(const c of Object.values(e)){const{unit:u,id:h,bound:d}=c,p=n[h]!==!1,f=s.group();f.translate(a,t);let g=0;const b=this.drawChainHead(s,c,n,i);if(f.add(b.g),g+=b.height-ct,d){const x=`event.${d.unit.name}.${d.event}`;(o[x]||(o[x]=[])).push(b.g)}let E=!1,T=c.head,M=T;for(;p&&T;){const{g:x,height:O,width:L}=this.drawBlock(s,u,c,T);x.translate(0,g),f.add(x),g+=O,E=E||!!T.ending,M=T,T=T.next}if(p&&!E){const x=this.drawBlockHolder(s);x.translate(0,g),f.add(x);const{height:O}=x.bbox();g+=O,Ae(x,L=>{const I=ie(L);if(!I)throw new Error("no data transfer");if(I.type==="action"){const U=v.findUnit(I.unit);if(!U)throw new Error("no unit");const G=U.createAction(I.action);U.appendBlock(c,G),this.redraw()}else if(I.type==="block"){const U=v.findUnit(I.unit);if(!U)throw new Error("no unit");const G=U.chains[I.chain],te=U.findBlock(G,I.block);if(te)U.removeBlock(G,te),M?M.next=te:c.head=te,this.redraw();else throw new Error("no block")}else console.log(L)})}g>r&&(r=g),a+=f.bbox().width+vn.x}return{width:a+ht.x,height:r+ht.y*2,events:o}},drawLinks(s,e){for(const{event:t,to:n}of Object.values(e))for(const i of n){const a=Ee.link(s,t,i);a.attr({"marker-start":"url(#dot)","marker-end":"url(#bezier-arrow)","stroke-dasharray":"8,4",fill:"none"}),a.addClass("it-linker-line")}},drawBlockList(s,e,t){t=t||{x:0,y:0,gapy:8};const n=s.group();n.translate(t.x,t.y);const i=t.x;let a=t.y,r=0;for(const o of e){const{g:c,height:u,width:h}=this.drawBlock(s,o.callee,null,o);c.translate(i,a),n.add(c),a+=u+t.gapy,r<h&&(r=h)}return{width:t.x*2+r,height:a+t.y}}},j=(s,e)=>{const t=s.__vccOpts||s;for(const[n,i]of e)t[n]=i;return t};const Bl={props:{items:{type:Array,default:[]}},watch:{items(){this.draw()}},methods:{draw(){const s=this.svg;s.clear(),this.items.forEach(t=>{t.block||(t.block=t.unit.createAction(t.name))});const e=jt.drawBlockList(s,this.items.map(t=>t.block),{x:4,y:4,gapy:8});this.$refs.root.setAttribute("width",`${e.width+8}px`),this.$refs.root.setAttribute("height",`${e.height+8}px`)}},mounted(){this.svg=Ln(this.$refs.root),this.$nextTick(()=>{this.draw()})}},zl={ref:"root",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Ol(s,e,t,n,i,a){return y(),w("div",null,[(y(),w("svg",zl,null,512))])}var Al=j(Bl,[["render",Ol]]);const pt={x:20,y:40},wn={x:20,y:5},jl={data(){return{visibles:{}}},computed:{selected(){return this.$store.state.selected.unit},revision(){return this.$store.state.revision}},watch:{selected(){this.draw(this.svg)},revision(){this.draw(this.svg)},visibles:{hander(){this.draw(this.svg)},deep:!0}},methods:{onDrop(s){const e=ie(s);if(!!e){if(e.type==="action"){if(!this.selected)throw new Error("no selected unit");const n=v.findUnit(e.unit).createAction(e.action);this.selected.createChain(n),this.$makeDirty()}else if(e.type==="block"){const t=v.findUnit(e.unit),n=t.chains[e.chain],i=t.findBlock(n,e.block);i?(t.removeBlock(n,i),this.$makeDirty()):s.dataTransfer.setData("unhandled","true")}else if(e.type==="linker"){if(!this.selected)throw new Error("no selected unit");const t=v.findUnit(e.unit),n=this.selected.chains[e.chain];n.head||(t.removeChain(n),this.$makeDirty())}else if(e.type==="event"){if(!this.selected)throw new Error("no selected unit");const t=v.findUnit(e.unit);if(!t)throw new Error("no unit");const n=this.selected.createChain();t.bindEvent(e.name,n),this.$makeDirty()}}},events(){const s=this.selected;if(!s)return[];const e=[v,...Object.values(v.devices)];e.findIndex(i=>i.uuid===s.uuid)===-1&&e.splice(0,0,s);const t=[],n=(i,a)=>(i===s?10:1)*a.chains.reduce((o,c)=>c.unit.uuid==s.uuid?o+1:o,0);return e.forEach(i=>{t.push(...Object.entries(i.events).map(a=>({unit:i,name:a[0],event:a[1],count:n(i,a[1])})))}),t.sort((i,a)=>a.count-i.count),t},drawEvents(s){let t=pt.x,n=pt.y,i=0;const a={};for(const r of this.events()){const{unit:o,name:c}=r,u=he(`nm.${o.name}`,o.name),h=he(`ev.${r.event.label||c}`,c),d=s.plain(`${u}.${h}`).addClass("it-event-title").attr({"dominant-baseline":"middle"}),p=s.rect(d.bbox().width+wn.x*2,d.bbox().height+wn.y*2).addClass("it-block").addClass("it-theme-event"),{width:f,height:g}=p.bbox();p.radius(g/2),d.x(f/2),d.attr({x:f/2,y:g/2,height:g});const b=s.group();xs(p,E=>{wl(E,o,c)}),b.id(`event.${o.name}.${c}`),b.add(p),b.add(d),b.translate(t,n),t+=f+20,i<g&&(i=g),a[b.id()]=b}return{width:t+pt.x-20,height:n+i+pt.y,events:a}},draw(s){var o;let{width:e}=this.$el.getBoundingClientRect();s.clear(),jt.defs(s);const t=this.drawEvents(s);t.height+=1;const n=jt.drawChains(s,((o=this.selected)==null?void 0:o.chains)||[],t.height,this.visibles,()=>{this.draw(this.svg)}),i={};for(const[c,u]of Object.entries(t.events))i[c]={event:u,to:n.events[c]||[]};jt.drawLinks(s,i);const a=Math.max(e,t.width,n.width+300);s.line(0,t.height,a,t.height).stroke({width:1,color:"#eee"}).style({opacity:.5}),t.height+=n.height;const r=Math.min(this.$el.clientHeight||0,t.height);this.$refs.root.setAttribute("width",`${a}px`),this.$refs.root.setAttribute("height",`${r}px`)}},mounted(){const s=Ln(this.$refs.root);this.svg=s,this.draw(s),Ae(s,this.onDrop),this.$el.ondrop=this.onDrop}},Il={ref:"root",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Ll(s,e,t,n,i,a){return y(),w("div",null,[(y(),w("svg",Il,null,512))])}var Ul=j(jl,[["render",Ll]]);const Rl={};function Nl(s,e,t,n,i,a){return y(),w("div",null,"preview")}var Pl=j(Rl,[["render",Nl]]);const Vl={props:{prop:{type:Object,required:!0}},data(){return{_value:void 0}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}};function Hl(s,e,t,n,i,a){const r=F("el-switch");return y(),R(r,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o)},null,8,["modelValue"])}var ql=j(Vl,[["render",Hl]]);const Wl={props:{prop:{type:Object,required:!0}},data(){return{_value:void 0,_cate:""}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}},Yl={style:{"align-items":"center",display:"flex","flex-direction":"row"}};function Xl(s,e,t,n,i,a){const r=F("el-option"),o=F("el-select");return y(),R(o,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=c=>a.value=c),placeholder:"\u8BF7\u9009\u62E9",size:"mini",clearable:""},{default:z(()=>[(y(!0),w(Y,null,W(t.prop.values,(c,u)=>(y(),R(r,{key:u,value:c.hasOwnProperty("value")?c.value:c,label:c.label||c.value||c},{default:z(()=>[m("div",Yl,[m("span",null,k(c.hasOwnProperty("value")?c.label||c.value:c),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])}var yi=j(Wl,[["render",Xl]]);const Gl={components:{Enums:yi},props:{prop:{type:Object,required:!0}},data(){return{_value:void 0}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}};function Jl(s,e,t,n,i,a){const r=F("Enums"),o=F("el-slider"),c=F("el-input-number");return t.prop.values?(y(),R(r,{key:0,prop:t.prop},null,8,["prop"])):t.prop.step!==void 0?(y(),R(o,{key:1,modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=u=>a.value=u),step:t.prop.step,max:t.prop.max,min:t.prop.min,style:{"margin-left":"12px"}},null,8,["modelValue","step","max","min"])):(y(),R(c,{key:2,modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value=u),size:"small",clearable:"",max:t.prop.max,min:t.prop.min},null,8,["modelValue","max","min"]))}var Ql=j(Gl,[["render",Jl]]);const Zl={props:{prop:{type:Object,required:!0}},data(){return{_value:void 0}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}};function Kl(s,e,t,n,i,a){const r=F("el-date-picker");return y(),R(r,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),type:"time",placeholder:"\u9009\u62E9\u65F6\u95F4"},null,8,["modelValue"])}var ec=j(Zl,[["render",Kl]]);const tc={components:{Enums:yi},props:{prop:{type:Object,required:!0}},data(){return{_value:void 0}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}};function sc(s,e,t,n,i,a){const r=F("Enums"),o=F("el-input");return t.prop.values?(y(),R(r,{key:0,prop:t.prop},null,8,["prop"])):(y(),R(o,{key:1,modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=c=>a.value=c),size:"small",clearable:""},null,8,["modelValue"]))}var nc=j(tc,[["render",sc]]);const ic={props:{prop:{type:Object,required:!0}},data(){return{value:{x:void 0,y:void 0}}},watch:{prop:{handler(){this.reset()},deep:!0},"value.x"(s){isNaN(parseFloat(s))||this.updateVar()},"value.y"(s){isNaN(parseFloat(s))||this.updateVar()}},methods:{reset(){const s=this.prop.value;this.value={x:s==null?void 0:s.x,y:s==null?void 0:s.y}},updateVar(){const s={x:this.value.x?parseFloat(this.value.x):0,y:this.value.y?parseFloat(this.value.y):0};JSON.stringify(this.prop.value)!==JSON.stringify(s)&&(this.prop.value=s,this.$makeDirty())}},mounted(){this.reset()}},ac={style:{"align-items":"center",display:"flex","flex-direction":"row","justify-content":"flex-end"}};function rc(s,e,t,n,i,a){const r=F("el-input");return y(),w("div",ac,[$(r,{class:"v-item",modelValue:i.value.x,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.x=o),size:"small",placeholder:"x"},null,8,["modelValue"]),$(r,{class:"v-item",modelValue:i.value.y,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.y=o),size:"small",placeholder:"y"},null,8,["modelValue"])])}var oc=j(ic,[["render",rc],["__scopeId","data-v-2a37343e"]]);const lc={props:{prop:{type:Object,required:!0}},data(){return{value:{x:void 0,y:void 0,z:void 0}}},watch:{prop:{handler(){this.reset()},deep:!0},"value.x"(s){isNaN(parseFloat(s))||this.updateVar()},"value.y"(s){isNaN(parseFloat(s))||this.updateVar()},"value.z"(s){isNaN(parseFloat(s))||this.updateVar()}},methods:{reset(){var s,e,t;this.value={x:(s=this.prop.value)==null?void 0:s.x,y:(e=this.prop.value)==null?void 0:e.y,z:(t=this.prop.value)==null?void 0:t.z}},updateVar(){const s={x:this.value.x?parseFloat(this.value.x):0,y:this.value.y?parseFloat(this.value.y):0,z:this.value.z?parseFloat(this.value.z):0};JSON.stringify(this.prop.value)!==JSON.stringify(s)&&(this.prop.value=s,this.$makeDirty())}},mounted(){this.reset()}},cc={style:{"align-items":"center",display:"flex","flex-direction":"row","justify-content":"flex-end"}};function uc(s,e,t,n,i,a){const r=F("el-input");return y(),w("div",cc,[$(r,{class:"v-item",modelValue:i.value.x,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.x=o),size:"small",placeholder:"x"},null,8,["modelValue"]),$(r,{class:"v-item",modelValue:i.value.y,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.y=o),size:"small",placeholder:"y"},null,8,["modelValue"]),$(r,{class:"v-item",modelValue:i.value.z,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.z=o),size:"small",placeholder:"z"},null,8,["modelValue"])])}var dc=j(lc,[["render",uc],["__scopeId","data-v-6f343a42"]]);const hc={props:{prop:{type:Object,required:!0}},data(){return{_value:void 0}},computed:{value:{get(){const s=this.prop.value,e=this._value;return s!==void 0?[s,e][0]:this.prop.default},set(s){this._value=s,this.prop.value!==s&&(this.prop.value=s,this.$makeDirty())}}}};function pc(s,e,t,n,i,a){const r=F("el-color-picker");return y(),R(r,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o),"show-alpha":"",style:{"margin-right":"12px"}},null,8,["modelValue"])}var mc=j(hc,[["render",pc]]);const fc={props:{prop:{type:Object,required:!0}},computed:{tip(){return this.$t("se.placeHolder").replace("$0",this.$t("nm.texture"))}},methods:{onDrop(s){const e=ie(s);if(!e||e.type!=="texture")return;const t=v.screen.getTextures()[e.uuid];if(!t)throw new Error("texture not found");this.prop.value=t.value,this.$makeDirty()},clear(){this.prop.value=null,this.$makeDirty()}}};function gc(s,e,t,n,i,a){return y(),w("label",{class:"readonly text-ellipsis",onDrop:e[0]||(e[0]=(...r)=>a.onDrop&&a.onDrop(...r)),onDblclick:e[1]||(e[1]=(...r)=>a.clear&&a.clear(...r))},k(t.prop.value||a.tip),33)}var yc=j(fc,[["render",gc],["__scopeId","data-v-6e4bd1ce"]]);const bc={props:{prop:{type:Object,required:!0}},computed:{tip(){return this.$t("se.placeHolder").replace("$0",this.$t("nm.material"))}},methods:{onDrop(s){const e=ie(s);!e||e.type!=="material"||(this.prop.value=e.uuid,this.$makeDirty())},clear(){this.prop.value=null,this.$makeDirty()}}};function vc(s,e,t,n,i,a){return y(),w("label",{class:"readonly text-ellipsis",onDrop:e[0]||(e[0]=(...r)=>a.onDrop&&a.onDrop(...r)),onDblclick:e[1]||(e[1]=(...r)=>a.clear&&a.clear(...r))},k(t.prop.value||a.tip),33)}var xc=j(bc,[["render",vc],["__scopeId","data-v-0ff6a0a8"]]);const wc={props:{prop:{type:Object,required:!0}},computed:{tip(){return this.$t("se.placeHolder").replace("$0",this.$t("nm.unit"))}},methods:{onDrop(s){const e=ie(s);if(!e||e.type!=="unit")return;const t=v.findUnit(e.uuid);if(!t)throw new Error("no unit");this.prop.value=t.uuid,this.$makeDirty()},clear(){this.prop.value=null,this.$makeDirty()}}};function _c(s,e,t,n,i,a){return y(),w("label",{class:"readonly text-ellipsis",onDrop:e[0]||(e[0]=(...r)=>a.onDrop&&a.onDrop(...r)),onDblclick:e[1]||(e[1]=(...r)=>a.clear&&a.clear(...r))},k(t.prop.value||a.tip),33)}var Ec=j(wc,[["render",_c],["__scopeId","data-v-119d9cce"]]);const Dc={},Sc={class:"readonly"};function Cc(s,e){return y(),w("label",Sc,k(s.$t("nm.readonly")),1)}var mt=j(Dc,[["render",Cc],["__scopeId","data-v-42aaf78d"]]),je={boolean:ql,number:Ql,time:ec,string:nc,color:mc,vec2:oc,vec3:dc,json:mt,octets:mt,stream:mt,texture:yc,material:xc,unit:Ec,unknown:mt};const kc={props:{item:{type:Object,default:{}},scoped:{type:String,default:""}},computed:{name(){return this.item.name}},methods:{propName(s){return this.scoped?`pr.${this.scoped}.${s}`:`pr.${s}`},componentOf(s){const{type:e}=s;return je[e]||je.string}}},Mc=s=>(ye("data-v-d3ff2f4a"),s=s(),be(),s),Tc={style:{"align-items":"center",display:"flex","flex-direction":"row"}},$c={class:"text-ellipsis prop-name"},Fc=Mc(()=>m("p",{style:{flex:"1 1 auto"}},null,-1));function Bc(s,e,t,n,i,a){return y(),w("div",Tc,[m("label",$c,k(s.$t(a.propName(t.item.name),t.item.name)),1),Fc,(y(),R(Un(a.componentOf(t.item)),{class:"prop-value",prop:t.item},null,8,["prop"]))])}var Ts=j(kc,[["render",Bc],["__scopeId","data-v-d3ff2f4a"]]);const zc={components:{Property:Ts},props:{scoped:{type:String,default:"unit"}},data(){return{maximized:!1,activeNames:["default"]}},computed:{selected(){return this.$store.state.selected.unit},title(){if(!this.$store.state.selected.unit)return this.$t("properties");const{name:s}=this.$store.state.selected.unit;return this.$t(`nm.${this.$store.state.selected.unit.name}`,s)},properties(){return this.$store.state.selected.unit?Object.values(this.$store.state.selected.unit.properties):[]},groups(){if(!this.$store.state.selected.unit)return{};const s={};return Object.values(this.$store.state.selected.unit.properties).forEach(e=>{const t=e.group||"default";(s[t]||(s[t]=[])).push(e)}),s}},watch:{selected(){this.activeNames=Object.keys(this.groups)}},methods:{}},Oc=["maximized"],Ac={class:"props-header",style:{"align-items":"center",display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-end"}},jc={key:0,class:"props-title",style:{flex:"1 1 auto"}},Ic={key:0,class:"props-body"};function Lc(s,e,t,n,i,a){const r=F("Property"),o=F("block"),c=F("el-collapse-item"),u=F("el-collapse");return y(),w("div",{class:"props",maximized:i.maximized,style:{display:"flex","flex-direction":"column"}},[m("div",Ac,[m("i",{class:"icon-translate",style:{margin:"0 8px"},onClick:e[0]||(e[0]=h=>i.maximized=!i.maximized)}),i.maximized?(y(),w("label",jc,k(a.title),1)):me("",!0),m("i",{class:ae(i.maximized?"icon-minimize":"icon-maximize"),onClick:e[1]||(e[1]=h=>i.maximized=!i.maximized),style:{"margin-right":"8px"}},null,2)]),i.maximized?(y(),w("div",Ic,[Object.keys(a.groups).length<=1?(y(),R(o,{key:0},{default:z(()=>[(y(!0),w(Y,null,W(a.properties,h=>(y(),R(r,{class:"props-item",key:h.name,item:h,scoped:t.scoped},null,8,["item","scoped"]))),128))]),_:1})):(y(),R(u,{key:1,modelValue:i.activeNames,"onUpdate:modelValue":e[2]||(e[2]=h=>i.activeNames=h)},{default:z(()=>[(y(!0),w(Y,null,W(a.groups,(h,d)=>(y(),R(c,{key:d,name:d,title:s.$t(`nm.${d}`,d)},{default:z(()=>[(y(!0),w(Y,null,W(h,p=>(y(),R(r,{class:"props-item",key:p.name,item:p,scoped:t.scoped},null,8,["item","scoped"]))),128))]),_:2},1032,["name","title"]))),128))]),_:1},8,["modelValue"]))])):me("",!0)],8,Oc)}var Uc=j(zc,[["render",Lc],["__scopeId","data-v-5977fd6d"]]);const Rc={data(){return{maximized:!1,isNew:!0,type:"",name:"",prop:{value:"",values:void 0},component:je.string}},computed:{var(){return this.$store.state.var},types(){const s=Object.keys(je).map(e=>({label:`types.${e}`,value:e}));return this.isNew?s.filter(e=>e.value!=="unknown"):s},title(){return this.isNew?this.$t("at.var.new"):this.name},isReaqdy(){return this.name&&this.type}},watch:{type(){this.resetType()},var(){this.resetVar()},"prop.value"(s){this.isNew||this.updateVar(s)}},methods:{resetVar(){let s=this.var;if(this.isNew=s.scope==="global"&&!s.name,this.maximized=!0,this.isNew)this.type=s.type||"unknown",this.name="",this.prop.value="",this.prop.values=void 0;else if(s.scope==="global"){const t=v.devices.storage.properties[s.name];this.type=t.type,this.name=s.name,this.prop.value=t.value,this.prop.values=t.values}else{const e=s.slot.data;this.type=e.type,this.name=s.name,this.prop.value=e.value,this.prop.values=e.values}if(this.resetType(),this.$el){const e=this.$el.querySelector("input");e&&e.focus()}},resetType(){this.component=je[this.type]||je.string},addVar(){v.devices.storage.addProperty(this.type,this.name,this.prop.value),Ue({scope:"global",type:this.type,name:this.name,slot:null}),this.$makeDirty()},updateVar(s){let e=!1,t=this.var;if(t.scope==="global"){const i=v.devices.storage.properties[t.name];i.value!=s&&(i.value=s,e=!0)}else{const n=t.slot.data;n.value!=s&&(n.value=s,e=!0)}e&&this.$makeDirty()}},created(){this.resetVar()}},$s=s=>(ye("data-v-7a9a9038"),s=s(),be(),s),Nc=["maximized"],Pc={class:"props-header",style:{"align-items":"center",display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-end"}},Vc={key:0,class:"props-title",style:{flex:"1 1 auto"}},Hc=["disabled"],qc={key:0,class:"props-body"},Wc={style:{display:"flex","flex-direction":"column"}},Yc={style:{"align-items":"center",display:"flex","flex-direction":"row"}},Xc={class:"text-ellipsis prop-name"},Gc=$s(()=>m("p",{style:{flex:"1 1 auto"}},null,-1)),Jc={class:"text-ellipsis prop-value",style:{"max-width":"180px","margin-right":"12px",color:"gray"}},Qc={style:{"align-items":"center",display:"flex","flex-direction":"row"}},Zc={class:"text-ellipsis prop-name"},Kc=$s(()=>m("p",{style:{flex:"1 1 auto"}},null,-1)),eu={style:{"align-items":"center",display:"flex","flex-direction":"row"}},tu={class:"text-ellipsis prop-name"},su=$s(()=>m("p",{style:{flex:"1 1 auto"}},null,-1));function nu(s,e,t,n,i,a){const r=F("el-input");return y(),w("div",{class:"props",maximized:i.maximized,style:{display:"flex","flex-direction":"column"}},[m("div",Pc,[m("i",{class:"icon-variable",style:{margin:"0 8px"},onClick:e[0]||(e[0]=o=>i.maximized=!i.maximized)}),i.maximized?(y(),w("label",Vc,k(a.title),1)):me("",!0),i.isNew&&i.maximized?(y(),w("i",{key:1,disabled:!a.isReaqdy,class:"icon-add",onClick:e[1]||(e[1]=(...o)=>a.addVar&&a.addVar(...o))},null,8,Hc)):me("",!0),m("i",{class:ae(i.maximized?"icon-minimize":"icon-maximize"),onClick:e[2]||(e[2]=o=>i.maximized=!i.maximized),style:{"margin-right":"8px"}},null,2)]),i.maximized?(y(),w("div",qc,[m("div",Wc,[m("div",Yc,[m("label",Xc,k(s.$t("nm.type")),1),Gc,m("label",Jc,k(s.$t(`ty.data.${i.type}`,i.type)),1)]),m("div",Qc,[m("label",Zc,k(s.$t("nm.name")),1),Kc,$(r,{disabled:!i.isNew,class:"prop-value",modelValue:i.name,"onUpdate:modelValue":e[3]||(e[3]=o=>i.name=o),size:"small",clearable:"",style:{"max-width":"160px","margin-right":"12px"}},null,8,["disabled","modelValue"])]),m("div",eu,[m("label",tu,k(s.$t("nm.value")),1),su,(y(),R(Un(i.component),{class:"prop-value",prop:i.prop,style:{"max-width":"160px","margin-right":"12px"}},null,8,["prop"]))])])])):me("",!0)],8,Nc)}var iu=j(Rc,[["render",nu],["__scopeId","data-v-7a9a9038"]]);const ee=["alphaTest","alphaToCoverage","blendDst","blendDstAlpha","blendEquation","blendEquationAlpha","blending","blendSrc","blendSrcAlpha","clipIntersection","clippingPlanes","clipShadows","colorWrite","defines","depthFunc","depthTest","depthWrite","fog","name","opacity","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","precision","premultipliedAlpha","dithering","side","shadowSide","toneMapped","transparent","vertexColors","visible","format","stencilWrite","stencilFunc","stencilRef","stencilWriteMask","stencilFuncMask","stencilFail","stencilZFail","stencilZPass","userData"],bi=[...ee].concat(["color","linewidth","linecap","linejoin"]),au=[...bi].concat(["scale","dashSize","gapSize"]),ru=[...ee].concat(["color","opacity","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","specularMap","alphaMap","envMap","combine","reflectivity","refractionRatio","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin"]),ou=[...ee].concat(["map","alphaMap","depthPacking","displacementMap","displacementScale","displacementBias","wireframe","wireframeLinewidth"]),lu=[...ee].concat(["map","alphaMap","displacementMap","displacementScale","displacementBias","farDistance","nearDistance","referencePosition"]),cu=[...ee].concat(["color","emissive","emissiveIntensity","emissiveMap","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","specularMap","alphaMap","envMap","combine","reflectivity","refractionRatio","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin"]),uu=[...ee].concat(["color","matcap","map","bumpMap","bumpScale","normalMap","normalMapType","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","flatShading"]),du=[...ee].concat(["bumpMap","bumpScale","normalMap","normalMapType","normalScale","displacementMap","displacementScale","displacementBias","wireframe","wireframeLinewidth","flatShading"]),hu=[...ee].concat(["color","specular","shininess","opacity","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","normalScale","displacementMap","displacementScale","displacementBias","specularMap","alphaMap","envMap","combine","reflectivity","refractionRatio","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","flatShading"]),vi=[...ee].concat(["color","roughness","metalness","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","normalScale","displacementMap","displacementScale","displacementBias","roughnessMap","metalnessMap","alphaMap","envMap","envMapIntensity","refractionRatio","wireframe","wireframeLinewidth","flatShading"]),pu=[...vi].concat(["clearcoat","clearcoatMap","clearcoatRoughness","clearcoatRoughnessMap","clearcoatNormalScale","clearcoatNormalMap","reflectivity","ior","sheen","sheenColor","sheenRoughness","transmission","transmissionMap","attenuationDistance","attenuationColor","specularIntensity","specularColor","specularIntensityMap","specularColorMap"]),mu=[...ee].concat(["color","opacity","gradientMap","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","wireframe","wireframeLinewidth","wireframeLinecap","wireframeLinejoin"]),fu=[...ee].concat(["color","map","alphaMap","size","sizeAttenuation"]),gu=[...ee].concat(["uniforms","vertexShader","fragmentShader","linewidth","wireframe","wireframeLinewidth","lights","clipping","extensions","glslVersion"]),yu=[...ee].concat(["color"]),bu=[...ee].concat(["color","map","alphaMap","rotation","sizeAttenuation"]),It={materialTypesSupported:{LineBasicMaterial:bi,LineDashedMaterial:au,MeshBasicMaterial:ru,MeshDepthMaterial:ou,MeshDistanceMaterial:lu,MeshLambertMaterial:cu,MeshMatcapMaterial:uu,MeshNormalMaterial:du,MeshPhongMaterial:hu,MeshPhysicalMaterial:pu,MeshStandardMaterial:vi,MeshToonMaterial:mu,PointsMaterial:fu,ShaderMaterial:gu,ShadowMaterial:yu,SpriteMaterial:bu},allProps:{color:{type:"color"},roughness:{type:"number",min:0,max:1},metalness:{type:"number",min:0,max:1},sheen:{type:"number",min:0,max:1},sheenColor:{type:"color"},sheenRoughness:{type:"number",min:0,max:1},emissive:{type:"color"},specular:{type:"color"},specularIntensity:{type:"number",min:0,max:1},specularColor:{type:"color"},shininess:{type:"number"},clearcoat:{type:"number",min:0,max:1},clearcoatRoughness:{type:"number",min:0,max:1},transmission:{type:"number"},thickness:{type:"number",min:0,max:1},attenuationDistance:{type:"number"},attenuationColor:{type:"color"},fog:{type:"boolean"},flatShading:{type:"boolean"},blending:{type:"number",values:[{value:qa,label:"NoBlending"},{value:Wa,label:"NormalBlending"},{value:Ya,label:"AdditiveBlending"},{value:Xa,label:"SubtractiveBlending"},{value:Ga,label:"MultiplyBlending"},{value:Ja,label:"CustomBlending"}]},combine:{type:"number",values:[{value:Qa,label:"MultiplyOperation"},{value:Za,label:"MixOperation"},{value:Ka,label:"AddOperation"}]},side:{type:"number",values:[{value:Us,label:"FrontSide"},{value:Rs,label:"BackSide"},{value:Ut,label:"DoubleSide"}]},shadowSide:{type:"number",values:[{value:Us,label:"FrontSide"},{value:Rs,label:"BackSide"},{value:Ut,label:"DoubleSide"}]},opacity:{type:"number",min:0,max:1},transparent:{type:"boolean"},alphaTest:{type:"number"},depthTest:{type:"boolean"},depthWrite:{type:"boolean"},colorWrite:{type:"boolean"},stencilWrite:{type:"boolean"},stencilWriteMask:{type:"number"},stencilFunc:{type:"number",values:[{value:er,label:"NeverStencilFunc"},{value:Ns,label:"AlwaysStencilFunc"},{value:tr,label:"LessStencilFunc"},{value:sr,label:"LessEqualStencilFunc"},{value:nr,label:"EqualStencilFunc"},{value:ir,label:"GreaterEqualStencilFunc"},{value:ar,label:"GreaterStencilFunc"},{value:rr,label:"NotEqualStencilFunc"},{value:Ns,label:"AlwaysStencilFunc"}]},stencilRef:{type:"number"},stencilFuncMask:{type:"number"},stencilFail:{type:"number"},stencilZFail:{type:"number"},stencilZPass:{type:"number"},wireframe:{type:"boolean"},wireframeLinewidth:{type:"number"},wireframeLinecap:{type:"string",default:"round"},wireframeLinejoin:{type:"string",default:"round"},rotation:{type:"vec3"},linewidth:{type:"number"},dashSize:{type:"number"},gapSize:{type:"number"},scale:{type:"number"},polygonOffset:{type:"boolean"},polygonOffsetFactor:{type:"number"},polygonOffsetUnits:{type:"number"},dithering:{type:"boolean"},alphaToCoverage:{type:"boolean"},premultipliedAlpha:{type:"boolean"},visible:{type:"boolean"},toneMapped:{type:"boolean"},userData:{type:"json"},vertexColors:{type:"number"},uniforms:{type:"json"},defines:{type:"json"},vertexShader:{type:"string"},fragmentShader:{type:"string"},extensions:{type:"json"},size:{type:"number"},sizeAttenuation:{type:"boolean"},map:{type:"texture"},matcap:{type:"texture"},alphaMap:{type:"texture"},bumpMap:{type:"texture"},bumpScale:{type:"number"},normalMap:{type:"texture"},normalMapType:{type:"number",values:[{value:or,label:"TangentSpaceNormalMap"},{value:lr,label:"ObjectSpaceNormalMap"}]},normalScale:{type:"vec2"},displacementMap:{type:"texture"},displacementScale:{type:"number"},displacementBias:{type:"number"},roughnessMap:{type:"texture"},metalnessMap:{type:"texture"},emissiveMap:{type:"texture"},emissiveIntensity:{type:"number",min:0,max:1},specularMap:{type:"texture"},specularIntensityMap:{type:"texture"},envMap:{type:"texture"},envMapIntensity:{type:"number",min:0,max:1},reflectivity:{type:"number",min:0,max:1},refractionRatio:{type:"number",min:0,max:1},lightMap:{type:"texture"},lightMapIntensity:{type:"number",min:0,max:1},aoMap:{type:"texture"},aoMapIntensity:{type:"number",min:0,max:1},gradientMap:{type:"texture"},clearcoatMap:{type:"texture"},clearcoatRoughnessMap:{type:"texture"},clearcoatNormalMap:{type:"texture"},clearcoatNormalScale:{type:"vec2"},transmissionMap:{type:"texture"},thicknessMap:{type:"texture"},sheenColorMap:{type:"texture"},sheenRoughnessMap:{type:"texture"}}};const vu={components:{Property:Ts},data(){return{maximized:!1,isNew:!0,type:"",props:{}}},computed:{mat(){return this.$store.state.mat},types(){return Object.keys(It.materialTypesSupported)},title(){var s;return(s=this.mat)==null?void 0:s.uuid}},watch:{mat(){this.resetMat()}},methods:{resetMat(){let s=this.mat,e=v.screen.getMaterialFromId(s.uuid);if(!e)this.props={};else{this.maximized=!0,this.type=e.type;const t={},n=e.toJSON(),i=It.materialTypesSupported[this.type],a=this;for(const r of i){const o=It.allProps[r];!o||(t[r]=new Proxy(Object.assign({name:r},o),{get(c,u){if(u==="value"){if(o.type==="color")return`#${e[r].getHexString()}`;if(o.type==="texture"){const h=e[r];return h==null?void 0:h.uuid}return n[r]}return c[u]},set(c,u,h){return u==="value"?(o.type==="color"?e[r].set(new Es(h)):e[r]=h,e.needsUpdate=!0,n[r]=h,a.$makeDirty(),!0):(c[u]=h,!0)}}))}this.props=t}},addMat(){const s=new Rn[this.type];v.screen.addMaterial(s),this.$makeDirty(),gs({uuid:s.uuid})}},created(){this.resetMat()}},xu=s=>(ye("data-v-dc45e2f4"),s=s(),be(),s),wu=["maximized"],_u={class:"props-header",style:{"align-items":"center",display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-end"}},Eu={key:0,class:"props-title text-ellipsis",style:{flex:"1 1 auto"}},Du={key:0,class:"props-body"},Su={style:{display:"flex","flex-direction":"column"}},Cu={style:{"align-items":"center",display:"flex","flex-direction":"row"}},ku={class:"text-ellipsis prop-name"},Mu=xu(()=>m("p",{style:{flex:"1 1 auto"}},null,-1)),Tu={class:"text-ellipsis prop-value",style:{"max-width":"180px","margin-right":"12px",color:"gray"}};function $u(s,e,t,n,i,a){const r=F("Property");return y(),w("div",{class:"props",maximized:i.maximized,style:{display:"flex","flex-direction":"column"}},[m("div",_u,[m("i",{class:"icon-layer",style:{margin:"0 8px"},onClick:e[0]||(e[0]=o=>i.maximized=!i.maximized)}),i.maximized?(y(),w("label",Eu,k(a.title),1)):me("",!0),m("i",{class:ae(i.maximized?"icon-minimize":"icon-maximize"),onClick:e[1]||(e[1]=o=>i.maximized=!i.maximized),style:{"margin-right":"8px"}},null,2)]),i.maximized?(y(),w("div",Du,[m("div",Su,[m("div",Cu,[m("label",ku,k(s.$t("nm.type")),1),Mu,m("label",Tu,k(i.type),1)]),(y(!0),w(Y,null,W(i.props,o=>(y(),R(r,{class:"props-item",key:o.name,item:o,scoped:"material"},null,8,["item"]))),128))])])):me("",!0)],8,wu)}var Fu=j(vu,[["render",$u],["__scopeId","data-v-dc45e2f4"]]);const Bu={allProps:{offset:{type:"vec2"},repeat:{type:"vec2"},center:{type:"vec2"},mapping:{type:"number",values:[{value:cr,label:"UVMapping"},{value:ur,label:"CubeReflectionMapping"},{value:dr,label:"CubeRefractionMapping"},{value:hr,label:"EquirectangularReflectionMapping"},{value:pr,label:"EquirectangularRefractionMapping"},{value:mr,label:"CubeUVReflectionMapping"},{value:fr,label:"CubeUVRefractionMapping"}]},wrapS:{type:"number",values:[{value:Ps,label:"RepeatWrapping"},{value:Vs,label:"ClampToEdgeWrapping"},{value:Hs,label:"MirroredRepeatWrapping"}]},wrapT:{type:"number",values:[{value:Ps,label:"RepeatWrapping"},{value:Vs,label:"ClampToEdgeWrapping"},{value:Hs,label:"MirroredRepeatWrapping"}]},magFilter:{type:"number",values:[{value:qs,label:"NearestFilter"},{value:Ws,label:"NearestMipmapNearestFilter"},{value:Ys,label:"NearestMipMapNearestFilter"},{value:Xs,label:"NearestMipmapLinearFilter"},{value:Gs,label:"NearestMipMapLinearFilter"},{value:Lt,label:"LinearFilter"},{value:Js,label:"LinearMipmapNearestFilter"},{value:Qs,label:"LinearMipMapNearestFilter"},{value:Zs,label:"LinearMipmapLinearFilter"},{value:Ks,label:"LinearMipMapLinearFilter"}]},minFilter:{type:"number",values:[{value:qs,label:"NearestFilter"},{value:Ws,label:"NearestMipmapNearestFilter"},{value:Ys,label:"NearestMipMapNearestFilter"},{value:Xs,label:"NearestMipmapLinearFilter"},{value:Gs,label:"NearestMipMapLinearFilter"},{value:Lt,label:"LinearFilter"},{value:Js,label:"LinearMipmapNearestFilter"},{value:Qs,label:"LinearMipMapNearestFilter"},{value:Zs,label:"LinearMipmapLinearFilter"},{value:Ks,label:"LinearMipMapLinearFilter"}]},format:{type:"number",values:[{value:gr,label:"AlphaFormat"},{value:yr,label:"RGBAFormat"},{value:br,label:"LuminanceFormat"},{value:vr,label:"LuminanceAlphaFormat"},{value:xr,label:"DepthFormat"},{value:wr,label:"DepthStencilFormat"},{value:_r,label:"RedFormat"},{value:Er,label:"RedIntegerFormat"},{value:Dr,label:"RGFormat"},{value:Sr,label:"RGIntegerFormat"},{value:Cr,label:"RGBAIntegerFormat"}]},type:{type:"number",values:[{value:kr,label:"UnsignedByteType"},{value:Mr,label:"ByteType"},{value:Tr,label:"ShortType"},{value:$r,label:"UnsignedShortType"},{value:Fr,label:"IntType"},{value:Br,label:"UnsignedIntType"},{value:zr,label:"FloatType"},{value:Or,label:"HalfFloatType"},{value:Ar,label:"UnsignedShort4444Type"},{value:jr,label:"UnsignedShort5551Type"},{value:Ir,label:"UnsignedInt248Type"}]},anisotropy:{type:"number"},encoding:{type:"number",values:[{value:Lr,label:"LinearEncoding"},{value:Dn,label:"sRGBEncoding"}]}}};const zu={components:{Property:Ts},data(){return{maximized:!1,type:"",props:{},images:[]}},computed:{tex(){return this.$store.state.tex},title(){var s;return(s=this.tex)==null?void 0:s.uuid}},watch:{tex(){this.reset()}},methods:{reset(){let s=this.tex,e=v.screen.getTextures()[s.uuid];if(this.images=v.screen.getImages().map(t=>t[0]),!e)this.maximized=!1,this.props={};else{this.maximized=!0;const t=e.value;this.type=e.name;const n={},i=this;for(const[a,r]of Object.entries(Bu.allProps))n[a]=new Proxy(Object.assign({name:a},r),{get(o,c){return c==="value"?r.type==="color"?`#${t[a].getHexString()}`:t[a]:o[c]},set(o,c,u){return c==="value"?(r.type==="color"&&t[a].set(new Es(u)),r.type==="vec2"?t[a]=new Ur(u.x,u.y):t[a]=u,i.$makeDirty(),!0):(o[c]=u,!0)}});this.props=n}},async add(){const s=await v.screen.addTexture(this.type);this.$makeDirty(),ys({uuid:s.value.uuid})}},created(){this.reset()}},Ou=s=>(ye("data-v-8dd1d552"),s=s(),be(),s),Au=["maximized"],ju={class:"props-header",style:{"align-items":"center",display:"flex","flex-direction":"row","flex-wrap":"nowrap","justify-content":"flex-end"}},Iu={key:0,class:"props-title text-ellipsis",style:{flex:"1 1 auto"}},Lu={key:0,class:"props-body"},Uu={style:{display:"flex","flex-direction":"column"}},Ru={style:{"align-items":"center",display:"flex","flex-direction":"row"}},Nu={class:"text-ellipsis prop-name"},Pu=Ou(()=>m("p",{style:{flex:"1 1 auto"}},null,-1)),Vu={class:"text-ellipsis prop-value",style:{"max-width":"180px","margin-right":"12px",color:"gray"}};function Hu(s,e,t,n,i,a){const r=F("Property");return y(),w("div",{class:"props",maximized:i.maximized,style:{display:"flex","flex-direction":"column"}},[m("div",ju,[m("i",{class:"icon-brush",style:{margin:"0 8px"},onClick:e[0]||(e[0]=o=>i.maximized=!i.maximized)}),i.maximized?(y(),w("label",Iu,k(a.title),1)):me("",!0),m("i",{class:ae(i.maximized?"icon-minimize":"icon-maximize"),onClick:e[1]||(e[1]=o=>i.maximized=!i.maximized),style:{"margin-right":"8px"}},null,2)]),i.maximized?(y(),w("div",Lu,[m("div",Uu,[m("div",Ru,[m("label",Nu,k(s.$t("nm.image")),1),Pu,m("label",Vu,k(i.type),1)]),(y(!0),w(Y,null,W(i.props,o=>(y(),R(r,{class:"props-item",key:o.name,item:o,scoped:"texture"},null,8,["item"]))),128))])])):me("",!0)],8,Au)}var qu=j(zu,[["render",Hu],["__scopeId","data-v-8dd1d552"]]);const Wu={components:{Properties:Uc,VarEditor:iu,MatEditor:Fu,TexEditor:qu}},Yu={class:"panel",style:{"align-items":"stretch",display:"flex","flex-direction":"column"}};function Xu(s,e,t,n,i,a){const r=F("Properties"),o=F("VarEditor"),c=F("TexEditor"),u=F("MatEditor");return y(),w("div",Yu,[$(r,{class:"panel-item"}),$(o,{class:"panel-item"}),$(c,{class:"panel-item"}),$(u,{class:"panel-item"})])}var Gu=j(Wu,[["render",Xu],["__scopeId","data-v-0c880591"]]);const Ju="3207849",Qu="egg",Zu="iconfont",Ku="icon-",ed="",td=[{icon_id:"1226737",name:"time",font_class:"time",unicode:"e6b8",unicode_decimal:59064},{icon_id:"9229176",name:"Field-String",font_class:"string",unicode:"e90d",unicode_decimal:59661},{icon_id:"6807567",name:"Distance-1",font_class:"distance",unicode:"ec7c",unicode_decimal:60540},{icon_id:"7239686",name:"dash",font_class:"dash",unicode:"e724",unicode_decimal:59172},{icon_id:"11200411",name:"\u7EBF",font_class:"line",unicode:"e602",unicode_decimal:58882},{icon_id:"11981834",name:"mesh_grid",font_class:"mesh",unicode:"e97e",unicode_decimal:59774},{icon_id:"544408",name:"arrow-move",font_class:"arrowmove",unicode:"e6d8",unicode_decimal:59096},{icon_id:"608356",name:"\u7BAD\u5934",font_class:"stream",unicode:"e6af",unicode_decimal:59055},{icon_id:"1203091",name:"\u4EA4\u53C9_cross36",font_class:"vec2",unicode:"e607",unicode_decimal:58887},{icon_id:"1444787",name:"json",font_class:"json",unicode:"e7bd",unicode_decimal:59325},{icon_id:"1445431",name:"texture",font_class:"texture",unicode:"e8e2",unicode_decimal:59618},{icon_id:"5357319",name:"\u4EBA\u673A\u4EA4\u4E923D-\u4E09\u7EF4\u5750\u6807",font_class:"vec3",unicode:"e6e1",unicode_decimal:59105},{icon_id:"12342512",name:"Boolean",font_class:"boolean",unicode:"e639",unicode_decimal:58937},{icon_id:"13413008",name:"\u4E09\u7EF4\u5750\u6807",font_class:"xyz",unicode:"e622",unicode_decimal:58914},{icon_id:"17412150",name:"Color",font_class:"color",unicode:"e660",unicode_decimal:58976},{icon_id:"24341702",name:"flow chart 2-line",font_class:"octets",unicode:"e9ea",unicode_decimal:59882},{icon_id:"399081",name:"remove",font_class:"remove",unicode:"e6f4",unicode_decimal:59124},{icon_id:"401062",name:"remove",font_class:"trash",unicode:"e82a",unicode_decimal:59434},{icon_id:"762250",name:"Press-and-Drag",font_class:"drag",unicode:"e633",unicode_decimal:58931},{icon_id:"1704211",name:"arrows_drag_left_dashed",font_class:"drag-left",unicode:"e690",unicode_decimal:59024},{icon_id:"11494519",name:"scenes",font_class:"scene",unicode:"e79e",unicode_decimal:59294},{icon_id:"212502",name:"lights",font_class:"bulb",unicode:"e6de",unicode_decimal:59102},{icon_id:"1473266",name:"\u673A\u5668\u4EBA",font_class:"xbot",unicode:"e67b",unicode_decimal:59003},{icon_id:"1493286",name:"my_light",font_class:"human",unicode:"e7d5",unicode_decimal:59349},{icon_id:"6802116",name:"Basket-Ball",font_class:"sphere",unicode:"e726",unicode_decimal:59174},{icon_id:"7594407",name:"24gl-square",font_class:"plane",unicode:"ea98",unicode_decimal:60056},{icon_id:"12342509",name:"text",font_class:"text",unicode:"e638",unicode_decimal:58936},{icon_id:"18166094",name:"\u7ACB\u65B9\u4F53,\u6B63\u65B9\u5F62,\u5E94\u7528",font_class:"box",unicode:"e8b2",unicode_decimal:59570},{icon_id:"28528103",name:"\u7ACB\u65B9\u4F53,\u6B63\u65B9\u5F62,\u5E94\u7528",font_class:"unit",unicode:"efd6",unicode_decimal:61398},{icon_id:"24874765",name:"material",font_class:"layer",unicode:"e66f",unicode_decimal:58991},{icon_id:"28528107",name:"material",font_class:"material",unicode:"efd7",unicode_decimal:61399},{icon_id:"14679452",name:"waveform_path",font_class:"wave",unicode:"e6e7",unicode_decimal:59111},{icon_id:"3956072",name:"\u6750\u8D28\u6837\u5F0F\u5237",font_class:"brush",unicode:"e63f",unicode_decimal:58943},{icon_id:"12088900",name:"Speech Recognition",font_class:"recognition",unicode:"e99b",unicode_decimal:59803},{icon_id:"23816370",name:"speech",font_class:"recorder",unicode:"e65c",unicode_decimal:58972},{icon_id:"17412934",name:"Timer-1",font_class:"timer",unicode:"e70b",unicode_decimal:59147},{icon_id:"544311",name:"android-hand",font_class:"hand",unicode:"e678",unicode_decimal:59e3},{icon_id:"1503681",name:"number0",font_class:"number",unicode:"e645",unicode_decimal:58949},{icon_id:"15296119",name:"\u8282\u70B9\u6062\u590D",font_class:"reset",unicode:"e620",unicode_decimal:58912},{icon_id:"23701233",name:"Screen-Filled",font_class:"screen",unicode:"e641",unicode_decimal:58945},{icon_id:"27994433",name:"Component",font_class:"component",unicode:"e761",unicode_decimal:59233},{icon_id:"7685334",name:"variable",font_class:"variable",unicode:"e74e",unicode_decimal:59214},{icon_id:"2116652",name:"MINIMIZE",font_class:"minimize",unicode:"e6b7",unicode_decimal:59063},{icon_id:"8474313",name:"maximize",font_class:"maximize",unicode:"e6c0",unicode_decimal:59072},{icon_id:"217427",name:"group",font_class:"group",unicode:"e642",unicode_decimal:58946},{icon_id:"544677",name:"ios-infinite",font_class:"bigint",unicode:"e7df",unicode_decimal:59359},{icon_id:"1306362",name:"aislogo",font_class:"translate",unicode:"e648",unicode_decimal:58952},{icon_id:"6399996",name:"\u516C\u5F0F_\u666E\u901A",font_class:"math",unicode:"e603",unicode_decimal:58883},{icon_id:"8242724",name:"git",font_class:"logic",unicode:"e610",unicode_decimal:58896},{icon_id:"12763007",name:"messages",font_class:"message",unicode:"e644",unicode_decimal:58948},{icon_id:"16516758",name:"\u4EFB\u52A1\u6D41\u7A0B",font_class:"queue",unicode:"e6b6",unicode_decimal:59062},{icon_id:"14636674",name:"start",font_class:"start",unicode:"e670",unicode_decimal:58992},{icon_id:"2596781",name:"\u505C\u6B62",font_class:"stop",unicode:"e76b",unicode_decimal:59243},{icon_id:"160107",name:"Camera2",font_class:"camera",unicode:"e601",unicode_decimal:58881},{icon_id:"10140059",name:"screen-1",font_class:"screen-outline",unicode:"e6aa",unicode_decimal:59050},{icon_id:"11981757",name:"joystick",font_class:"joystick",unicode:"e978",unicode_decimal:59768},{icon_id:"848644",name:"time",font_class:"time-outline",unicode:"e63e",unicode_decimal:58942},{icon_id:"28604396",name:"Egg, dots",font_class:"chick",unicode:"efd8",unicode_decimal:61400},{icon_id:"10561000",name:"Egg, dots",font_class:"egg",unicode:"e646",unicode_decimal:58950},{icon_id:"11399251",name:"save",font_class:"save",unicode:"e600",unicode_decimal:58880},{icon_id:"68291",name:"dot1",font_class:"dot-mini",unicode:"e654",unicode_decimal:58964},{icon_id:"246144",name:"editor-line",font_class:"editor",unicode:"e684",unicode_decimal:59012},{icon_id:"602165",name:"arrow down",font_class:"arrow-dropright",unicode:"e624",unicode_decimal:58916},{icon_id:"645875",name:"LC_icon_desktop_line_2",font_class:"desktop",unicode:"e643",unicode_decimal:58947},{icon_id:"1154647",name:"uE700-audio",font_class:"audio",unicode:"e61b",unicode_decimal:58907},{icon_id:"1363841",name:"remove",font_class:"trash-outline",unicode:"e60c",unicode_decimal:58892},{icon_id:"1471598",name:"robot-img",font_class:"robot",unicode:"e61a",unicode_decimal:58906},{icon_id:"2861028",name:"Loading",font_class:"loading",unicode:"e65d",unicode_decimal:58973},{icon_id:"5758154",name:"plugin",font_class:"chip",unicode:"e66d",unicode_decimal:58989},{icon_id:"15838560",name:"add-bold",font_class:"add",unicode:"e685",unicode_decimal:59013},{icon_id:"20239308",name:"arrow down",font_class:"arrow-dropdown",unicode:"efd3",unicode_decimal:61395},{icon_id:"20239311",name:"arrow down",font_class:"arrow-dropleft",unicode:"efd4",unicode_decimal:61396},{icon_id:"20239353",name:"arrow down",font_class:"arrow-dropup",unicode:"efd5",unicode_decimal:61397}];var Xt={id:Ju,name:Qu,font_family:Zu,css_prefix_text:Ku,description:ed,glyphs:td};const sd={data(){return{items:[],selected:""}},computed:{revision(){return this.$store.state.revision},types(){return["boolean","number","time","string","color","vec2","vec3","json","octets","stream","texture","material","unit","unknown"]}},watch:{revision(){this.reset()}},methods:{toIconClass(s){return Xt.glyphs.find(e=>e.font_class===s)?`icon-${s}`:"icon-variable"},async onTypeDragStart(s,e){Cs(e,s,"vars")},async onVarDragStart(s,e){xl(e,s)},async onVarDragEnd(s,e){var t;((t=e.dataTransfer)==null?void 0:t.getData("selfRemove"))&&(v.devices.storage.removeProperty(s),this.selected===s&&(this.selected="",Ue({scope:"global",name:"",type:"unknown"})),this.$makeDirty())},async onMainBoardDrop(s){const e=ie(s);e.type==="type"&&Ue({scope:"global",type:e.name,name:"",slot:null})},reset(){const s=v.devices.storage;this.items=Object.values(s.properties)},selVar(s,e){Ue({scope:"global",type:e,name:s}),this.selected=s}},mounted(){var s;this.selSceneId=(s=v.screen.scene)==null?void 0:s.uuid}},nd=s=>(ye("data-v-379ef858"),s=s(),be(),s),id={class:"paneContainer",style:{display:"flex","flex-direction":"row"}},ad=["onClick","onDragstart","onDragend"],rd={class:"item-slot"},od={class:"cls-name text-ellipsis"},ld=["selected"],cd={class:"prop-value text-ellipsis"},ud={class:"clsBoard",style:{display:"flex","flex-direction":"column","align-items":"center"}},dd=nd(()=>m("i",{class:"icon-drag",style:{"margin-bottom":"0.4em",color:"gray",cursor:"default","font-size":"2em"}},null,-1)),hd=["onDragstart"],pd={class:"item-slot"},md={class:"cls-name text-ellipsis"};function fd(s,e,t,n,i,a){return y(),w("div",id,[m("div",{class:"mainBoard",style:{flex:"1 1 auto","align-items":"stretch",display:"flex","flex-direction":"column"},onDrop:e[0]||(e[0]=(...r)=>a.onMainBoardDrop&&a.onMainBoardDrop(...r))},[(y(!0),w(Y,null,W(i.items,r=>(y(),w("div",{class:"x-item body-item",key:r.name,draggable:"true",showTrash:"true",onClick:o=>a.selVar(r.name,r.type),onDragstart:o=>a.onVarDragStart(r.name,o),onDragend:o=>a.onVarDragEnd(r.name,o)},[m("div",rd,[m("i",{class:ae(a.toIconClass(r.type))},null,2)]),m("div",od,k(r.name),1),m("div",{class:"item-slot",selected:i.selected===r.name,style:{"max-width":"8em",color:"black",flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},[m("label",cd,k(r.value),1)],8,ld)],40,ad))),128))],32),m("div",ud,[dd,(y(!0),w(Y,null,W(a.types,r=>(y(),w("div",{key:r,class:"x-item cls-item",draggable:"true",onDragstart:o=>a.onTypeDragStart(r,o)},[m("div",pd,[m("i",{class:ae(a.toIconClass(r))},null,2)]),m("div",md,k(s.$t(`ty.data.${r}`,r)),1)],40,hd))),128))])])}var gd=j(sd,[["render",fd],["__scopeId","data-v-379ef858"]]);const yd={data(){return{scene:{uuid:"",name:""},scenes:[],units:[]}},computed:{revision(){return this.$store.state.revision},selectedId(){var s;return(s=this.$store.state.selected.unit)==null?void 0:s.uuid},items(){const[s]=[["chick"].concat(Object.keys(this.$prj.builtins).concat(Object.keys(this.$prj.devices))),this.$store.state.revision];return Object.values(this.$prj.allUnits).filter(e=>s.indexOf(e.name)===-1)},classes(){return[["scene",v.classes.scene],...Object.entries(v.classes).filter(s=>s[0]!=="scene")].map(([s,e])=>({name:s,label:e.label,icon:e.constructor.icon||s,clsid:e.constructor.clsid}))}},watch:{revision(){this.reset()}},methods:{isImg(s){return s&&/^(data:image\/png;base64|data:image\/jpeg;base64|https?:)/.test(s)},toIconClass(s){return Xt.glyphs.find(e=>e.font_class===s)?`icon-${s}`:"icon-component"},async onClassDragStart(s,e){Sl(e,s)},async onSceneDragStart(s,e){bn(e,s)},async onSceneDragEnd(s,e){var t;if((t=e.dataTransfer)==null?void 0:t.getData("selfRemove")){if(v.screenEditor.getScenes().length<=1)throw new Error("\u81F3\u5C11\u4FDD\u7559\u4E00\u4E2A\u573A\u666F");const i=v.findUnit(s);v.screenEditor.removeChild(i),this.selectScene(v.screenEditor.getScenes()[0].uuid),this.$makeDirty()}},async onUnitDragStart(s,e){bn(e,s)},async onUnitDragEnd(s,e){var t;if((t=e.dataTransfer)==null?void 0:t.getData("selfRemove")){const n=v.findUnit(s);if(!n.parent)throw new Error("\u65E0\u6CD5\u5220\u9664\u6839\u8282\u70B9");n.parent.removeChild(n),this.$makeDirty()}},async onUnitBoardDrop(s){const e=ie(s);if(e.type==="class"){const t=e.name;if(t==="scene")await v.createUnit(t,v.screenEditor);else{const n=v.classes[t],{is2D:i}=n.runtime;if(i)await v.createUnit(t,v.screenEditor);else if(v.screen.scene){const a=v.screenEditor.children[v.screen.scene.uuid];await v.createUnit(t,a)}else throw new Error("no scene")}this.$makeDirty()}},reset(){const s=v.screen.scene;s?this.scene={uuid:s.uuid,name:s.get({name:"name"})}:this.scene={uuid:"",name:"scene.new"},this.scenes=Object.values(v.screenEditor.getScenes()).map(e=>({uuid:e.uuid,name:e.instance.get({name:"name"})})),this.resetUnits()},resetUnits(){const s=[],e=v.screen.scene;if(e){const t=v.screenEditor.children[e.uuid];if(t)for(const n of Object.values(t.children))n.instance.isScene||s.push({uuid:n.uuid,label:n.constructor.label||n.name,icon:n.constructor.icon||n.name})}for(const t of Object.values(v.screenEditor.children))t.instance.isScene||s.push({uuid:t.uuid,label:t.constructor.label||t.name,icon:t.constructor.icon||t.name});this.units=s},selectUnit(s){!s||(this.$store.state.selected.unit=v.findUnit(s))},selectScene(s){const e=v.findUnit(s);this.scene={uuid:e.uuid,name:e.instance.get({name:"name"})},v.screenEditor.setCurrentScene(e),this.resetUnits()}},mounted(){var s;this.selSceneId=(s=v.screen.scene)==null?void 0:s.uuid}},xi=s=>(ye("data-v-0e15bc0f"),s=s(),be(),s),bd={class:"scenePane",style:{display:"flex","flex-direction":"row"}},vd=xi(()=>m("div",{class:"item-slot"},[m("i",{class:"icon-scene"})],-1)),xd={class:"cls-name text-ellipsis",style:{flex:"1 1 auto"}},wd={class:"item-slot",style:{"max-width":"6em",color:"black",flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},_d={class:"prop-value text-ellipsis"},Ed=["onClick","onDragstart","onDragend"],Dd={class:"item-slot"},Sd=["src"],Cd={class:"cls-name text-ellipsis"},kd=["selected"],Md={class:"prop-value text-ellipsis"},Td={class:"clsBoard",style:{display:"flex","flex-direction":"column","align-items":"center"}},$d=xi(()=>m("i",{class:"icon-drag",style:{"margin-bottom":"0.4em",color:"gray",cursor:"default","font-size":"2em"}},null,-1)),Fd=["onDragstart"],Bd={class:"item-slot"},zd=["src"],Od={class:"cls-name text-ellipsis"};function Ad(s,e,t,n,i,a){const r=F("el-dropdown-item"),o=F("el-dropdown-menu"),c=F("el-dropdown");return y(),w("div",bd,[m("div",{class:"unitBoard",style:{flex:"1 1 auto","align-items":"stretch",display:"flex","flex-direction":"column"},onDrop:e[3]||(e[3]=(...u)=>a.onUnitBoardDrop&&a.onUnitBoardDrop(...u))},[$(c,{"split-button":"",type:"primary",onCommand:a.selectScene,style:{"margin-bottom":"0.8em"}},{dropdown:z(()=>[$(o,null,{default:z(()=>[(y(!0),w(Y,null,W(i.scenes,u=>(y(),R(r,{key:u.uuid,command:u.uuid},{default:z(()=>[ve(k(u.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:z(()=>[m("div",{class:"x-item",draggable:"true",showTrash:"true",onClick:e[0]||(e[0]=u=>a.selectUnit(i.scene.uuid)),onDragstart:e[1]||(e[1]=u=>a.onSceneDragStart(i.scene.uuid,u)),onDragend:e[2]||(e[2]=u=>a.onSceneDragEnd(i.scene.uuid,u)),style:{width:"100%","pointer-events":"all"}},[vd,m("label",xd,k(s.$t(i.scene.name)),1),m("div",wd,[m("label",_d,k(i.scene.uuid),1)])],32)]),_:1},8,["onCommand"]),(y(!0),w(Y,null,W(i.units,u=>(y(),w("div",{class:"x-item unit-item",key:u.uuid,draggable:"true",showTrash:"true",onClick:h=>a.selectUnit(u.uuid),onDragstart:h=>a.onUnitDragStart(u.uuid,h),onDragend:h=>a.onUnitDragEnd(u.uuid,h)},[m("div",Dd,[a.isImg(u.icon)?(y(),w("img",{key:0,src:u.icon},null,8,Sd)):(y(),w("i",{key:1,class:ae(a.toIconClass(u.icon))},null,2))]),m("div",Cd,k(s.$t(`nm.${u.label||u.name}`,u.label||u.name)),1),m("div",{class:"item-slot",selected:a.selectedId===u.uuid,style:{"max-width":"8em",color:"black",flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},[m("label",Md,k(u.uuid),1)],8,kd)],40,Ed))),128))],32),m("div",Td,[$d,(y(!0),w(Y,null,W(a.classes,u=>(y(),w("div",{key:u.clsid,class:"x-item cls-item",draggable:"true",onDragstart:h=>a.onClassDragStart(u.name,h)},[m("div",Bd,[a.isImg(u.icon)?(y(),w("img",{key:0,src:u.icon},null,8,zd)):(y(),w("i",{key:1,class:ae(a.toIconClass(u.icon))},null,2))]),m("div",Od,k(s.$t(`nm.${u.label||u.name}`,u.label||u.name)),1)],40,Fd))),128))])])}var jd=j(yd,[["render",Ad],["__scopeId","data-v-0e15bc0f"]]);const Id={data(){return{items:[],selected:""}},computed:{revision(){return this.$store.state.revision},types(){return Object.keys(It.materialTypesSupported).map(s=>{const[,e]=/(?:Mesh)?(\w+)Material/.exec(s)||[];return{type:s,label:e.toLowerCase()}})}},watch:{revision(){this.reset()}},methods:{toIconClass(s){const[,e]=/(?:Mesh)?(\w+)Material/.exec(s)||[];return Xt.glyphs.find(t=>t.font_class===e)?`icon-${e}`:"icon-material"},async onTypeDragStart(s,e){Cs(e,s,"materials")},async onItemDragStart(s,e){El(e,s)},async onItemDragEnd(s,e){var t;((t=e.dataTransfer)==null?void 0:t.getData("selfRemove"))&&(v.screen.removeMaterial(s),this.$makeDirty())},async onMainBoardDrop(s){const e=ie(s);if(e.type==="type"){const t=new Rn[e.name];v.screen.addMaterial(t),this.selected=t.uuid,this.$makeDirty(),gs({uuid:t.uuid})}},reset(){this.items=Object.values(v.screen.getMaterials()).map(s=>({type:s.type,uuid:s.uuid,label:/(?:Mesh)?(\w+)Material/.exec(s.type)[1].toLowerCase()}))},sel(s){gs({uuid:s}),this.selected=s}}},Ld=s=>(ye("data-v-42f3b36c"),s=s(),be(),s),Ud={class:"paneContainer",style:{display:"flex","flex-direction":"row"}},Rd=["onClick","onDragstart","onDragend"],Nd={class:"item-slot"},Pd={class:"cls-name text-ellipsis"},Vd=["selected"],Hd={class:"prop-value text-ellipsis"},qd={class:"clsBoard",style:{display:"flex","flex-direction":"column","align-items":"center"}},Wd=Ld(()=>m("i",{class:"icon-drag",style:{"margin-bottom":"0.4em",color:"gray",cursor:"default","font-size":"2em"}},null,-1)),Yd=["onDragstart"],Xd={class:"item-slot"},Gd={class:"cls-name text-ellipsis"};function Jd(s,e,t,n,i,a){return y(),w("div",Ud,[m("div",{class:"mainBoard",style:{flex:"1 1 auto","align-items":"stretch",display:"flex","flex-direction":"column"},onDrop:e[0]||(e[0]=(...r)=>a.onMainBoardDrop&&a.onMainBoardDrop(...r))},[(y(!0),w(Y,null,W(i.items,r=>(y(),w("div",{class:"x-item body-item",key:r.uuid,draggable:"true",showTrash:"true",onClick:o=>a.sel(r.uuid,r.type),onDragstart:o=>a.onItemDragStart(r.uuid,o),onDragend:o=>a.onItemDragEnd(r.uuid,o)},[m("div",Nd,[m("i",{class:ae(a.toIconClass(r.type))},null,2)]),m("div",Pd,k(s.$t(`ty.material.${r.label}`)),1),m("div",{class:"item-slot",selected:i.selected===r.uuid,style:{"max-width":"8em",color:"black",flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},[m("label",Hd,k(r.uuid),1)],8,Vd)],40,Rd))),128))],32),m("div",qd,[Wd,(y(!0),w(Y,null,W(a.types,r=>(y(),w("div",{key:r.type,class:"x-item cls-item",draggable:"true",onDragstart:o=>a.onTypeDragStart(r.type,o)},[m("div",Xd,[m("i",{class:ae(a.toIconClass(r.type))},null,2)]),m("div",Gd,k(s.$t(`ty.material.${r.label}`)),1)],40,Yd))),128))])])}var Qd=j(Id,[["render",Jd],["__scopeId","data-v-42f3b36c"]]);const Zd={data(){return{items:[],selected:"",images:[]}},computed:{revision(){return this.$store.state.revision}},watch:{revision(){this.reset()}},methods:{async onTypeDragStart(s,e){Cs(e,s,"textures")},async onItemDragStart(s,e){Dl(e,s)},async onItemDragEnd(s,e){var t;((t=e.dataTransfer)==null?void 0:t.getData("selfRemove"))&&(v.screen.removeTexture(s),this.$makeDirty())},async onMainBoardDrop(s){const e=ie(s);if(e.type==="type"){const t=await v.screen.addTexture(e.name);ys({uuid:t.value.uuid}),this.$makeDirty()}},reset(){this.images=v.screen.getImages().map(s=>({name:s[0],url:s[1]})),this.items=Object.values(v.screen.getTextures()).map(s=>({uuid:s.value.uuid,name:s.name,url:s.value.image.src}))},sel(s){ys({uuid:s}),this.selected=s}}},Kd=s=>(ye("data-v-6f38c4aa"),s=s(),be(),s),eh={class:"paneContainer",style:{display:"flex","flex-direction":"row"}},th=["onClick","onDragstart","onDragend"],sh={class:"item-slot",style:{"margin-right":"0.5em"}},nh=["src"],ih=["selected"],ah={class:"prop-value text-ellipsis"},rh={class:"clsBoard",style:{display:"flex","flex-direction":"column","align-items":"center"}},oh=Kd(()=>m("i",{class:"icon-drag",style:{"margin-bottom":"0.4em",color:"gray",cursor:"default","font-size":"2em"}},null,-1)),lh=["onDragstart"],ch={class:"item-slot"},uh=["src"],dh=["title"];function hh(s,e,t,n,i,a){return y(),w("div",eh,[m("div",{class:"mainBoard",style:{flex:"1 1 auto","align-items":"stretch",display:"flex","flex-direction":"column"},onDrop:e[0]||(e[0]=(...r)=>a.onMainBoardDrop&&a.onMainBoardDrop(...r))},[(y(!0),w(Y,null,W(i.items,r=>(y(),w("div",{class:"x-item body-item",key:r.uuid,draggable:"true",showTrash:"true",onClick:o=>a.sel(r.uuid,r.type),onDragstart:o=>a.onItemDragStart(r.uuid,o),onDragend:o=>a.onItemDragEnd(r.uuid,o)},[m("div",sh,[m("img",{class:"tex-item",src:r.url},null,8,nh)]),m("div",{class:"item-slot",selected:i.selected===r.uuid,style:{"max-width":"12em",color:"black",flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},[m("label",ah,k(r.uuid),1)],8,ih)],40,th))),128))],32),m("div",rh,[oh,(y(!0),w(Y,null,W(i.images,r=>(y(),w("div",{key:r.name,class:"x-item cls-item",draggable:"true",onDragstart:o=>a.onTypeDragStart(r.name,o)},[m("div",ch,[m("img",{class:"tex-item",src:r.url},null,8,uh)]),m("label",{title:r.name,class:"cls-name text-ellipsis"},k(r.name),9,dh)],40,lh))),128))])])}var ph=j(Zd,[["render",hh],["__scopeId","data-v-6f38c4aa"]]);const mh={props:{items:{type:Array,default:[]}},computed:{selectedId(){var s;return(s=this.$store.state.selected.unit)==null?void 0:s.uuid}},methods:{toIconClass(s){return Xt.glyphs.find(e=>e.font_class===s)?`icon-${s}`:"icon-chip"},select(s){this.$store.state.selected.unit=s}}},fh={style:{"align-items":"stretch",display:"flex","flex-direction":"column"}},gh={style:{display:"flex","flex-direction":"column"}},yh=["onClick"],bh={class:"prop-slot"},vh={class:"prop-name text-ellipsis",style:{flex:"0 0 0%"}},xh=["selected"],wh={class:"prop-value text-ellipsis"};function _h(s,e,t,n,i,a){return y(),w("div",fh,[m("div",gh,[(y(!0),w(Y,null,W(t.items,r=>(y(),w("div",{class:"prop-item",key:r.id,onClick:o=>a.select(r),style:{"align-items":"center",display:"flex","flex-direction":"row"}},[m("div",bh,[m("i",{class:ae(a.toIconClass(r.name))},null,2)]),m("label",vh,k(s.$t(`nm.${r.name}`,r.name)),1),m("div",{class:"prop-slot",selected:a.selectedId===r.uuid,style:{flex:"1 1 auto","justify-content":"start",padding:"0 1em"}},[m("label",wh,k(r.uuid),1)],8,xh)],8,yh))),128))])])}var Eh=j(mh,[["render",_h],["__scopeId","data-v-306ccb08"]]);const Dh=["zero","one","two","three","four","five","six","seven","eight","nine"],Sh=["up","down","left","right"],Ch=["yes","no"],kh=["go","start","stop","run","walk","jump","dance","sit","laugh"];function Mh(s){const e=[];for(const t of Dh)s.includes(t)&&e.push(t);for(const t of Sh)s.includes(t)&&e.push(t);for(const t of Ch)s.includes(t)&&e.push(t);for(const t of kh)s.includes(t)&&e.push(t);for(const t of s)e.includes(t)||e.push(t);return e}let Qe=null,Z=null;async function Th(s){Qe=oi("BROWSER_FFT",null,`${window.location.origin}/__egg__/assets/models/speech/${s.name}/model.json`,`${window.location.origin}/__egg__/assets/models/speech/${s.name}/metadata.json`),await Qe.ensureModelLoaded(),Z=Qe.createTransfer(`${s.name}-transfer`),s.transfer&&(await Z.load(`${window.location.origin}/__egg__/assets/models/speech/${s.name}/transfer/model.json`),Z.setWords(s.transfer.words))}const $h={props:{title:{type:String},prop:{type:Object,default:{visible:!1}}},data(){return{models:[],sel:{name:"",words:[]},selWord:"",customWords:[],inputWord:"",examples:{},isTransferReady:!1,trainning:!1,collecting:!1,regWord:""}},methods:{sort(s){return Mh(s.words)},reset(){if(this.isTransferReady=!1,this.examples={},this.customWords=[],Z=null,this.sel.transfer)for(const s of this.sel.transfer.words)this.sel.words.indexOf(s)===-1&&this.customWords.push(s);Th(this.sel).then(()=>{this.isTransferReady=!0,Z.isDatasetEmpty()||(this.examples=Z.countExamples())})},resetTransfer(){this.sel.transfer=null,this.reset()},setModel(s){this.sel=s,this.selWord="",this.customWords=[],!!s.words.length&&this.reset()},removeWord(s){const e=this.customWords.indexOf(s);e>=0&&this.customWords.splice(e,1)},addWord(){!this.inputWord||!/^[\w\d]+$/.test(this.inputWord)||this.customWords.includes(this.inputWord)||(this.customWords.push(this.inputWord),this.inputWord="")},setWord(s){this.selWord=s,this.collecting&&Z.collectExample(s).then(()=>{this.examples=Z.countExamples()})},getExampleCount(s){return this.examples[s]||0},async collect(){this.collecting=!this.collecting},async train(){if(this.trainning)throw"aready started";try{await Z.train({epochs:100,callback:Rr.show.fitCallbacks({name:"\u8BAD\u7EC3\u6548\u679C"},["loss","acc"],{callbacks:["onEpochEnd"]})}),this.$notify({type:"success",message:"\u5DF2\u8BAD\u7EC3\u5B8C"})}catch(s){console.warn(s),this.$notify({type:"error",message:s.message})}finally{this.trainning=!1,this.$forceUpdate()}},async save(){const s=await Z.save(`${window.location.origin}/__egg__/uploadmodel?name=${this.sel.name}`),e=Z.getMetadata();await rn.saveTransferMeta(this.sel.name,e),console.log(s)},async listen(){return await(this.sel.transfer?Z:Qe).listen(e=>{const{scores:t}=e;console.warn("result",e);const n=Math.max(...t),i=t.indexOf(n),a=Z.wordLabels();return console.log(a[i]),this.regWord=a[i],Promise.resolve()},{overlapFactor:.1,probabilityThreshold:.9})},async stop(){(this.sel.transfer?Z:Qe).stopListening()}},async mounted(){this.models=await rn.models();const s=this.models[0]||{words:[]};this.setModel(s)}},Fh={style:{"align-items":"stretch",display:"flex","flex-direction":"column"}},Bh={class:"sec",title:"\u6A21\u578B",style:{display:"flex","flex-direction":"row"}},zh={class:"sec",title:"\u5185\u7F6E\u5355\u8BCD",style:{display:"flex","flex-direction":"row","flex-wrap":"wrap"}},Oh={class:"sec",title:"\u81EA\u5B9A\u4E49\u5355\u8BCD",style:{display:"flex","flex-direction":"row"}},Ah={class:"sec",title:"\u8F93\u5165\u81EA\u5B9A\u4E49\u5355\u8BCD",style:{"align-items":"center",display:"flex","flex-direction":"row"}},jh={style:{"align-items":"center",display:"flex","flex-direction":"row","justify-content":"space-around","min-height":"60px"}};function Ih(s,e,t,n,i,a){const r=F("el-tag"),o=F("el-badge"),c=F("el-input"),u=F("el-button"),h=F("el-dialog");return y(),R(h,{modelValue:t.prop.visible,"onUpdate:modelValue":e[4]||(e[4]=d=>t.prop.visible=d),title:t.title,width:"30%",draggable:"",onClose:e[5]||(e[5]=d=>t.prop.visible=!1)},{footer:z(()=>[m("div",jh,[$(u,{type:"primary",disabled:i.trainning||i.collecting,onClick:a.resetTransfer},{default:z(()=>[ve(k(s.$t("speech.reset")),1)]),_:1},8,["disabled","onClick"]),$(u,{type:"primary",disabled:!i.isTransferReady||i.trainning,onClick:a.collect},{default:z(()=>[ve(k(s.$t("speech.collect")),1)]),_:1},8,["disabled","onClick"]),$(u,{type:"primary",disabled:!i.isTransferReady||i.trainning,onClick:a.train},{default:z(()=>[ve(k(s.$t("speech.train")),1)]),_:1},8,["disabled","onClick"]),$(u,{type:"primary",disabled:!i.isTransferReady,onClick:a.save},{default:z(()=>[ve(k(s.$t("speech.save")),1)]),_:1},8,["disabled","onClick"])])]),default:z(()=>[m("div",Fh,[m("div",Bh,[(y(!0),w(Y,null,W(i.models,d=>(y(),R(r,{key:d.name,type:"info",effect:d==i.sel?"dark":"plain",onClick:p=>a.setModel(d)},{default:z(()=>[ve(k(d.name),1)]),_:2},1032,["effect","onClick"]))),128))]),m("div",zh,[(y(!0),w(Y,null,W(a.sort(i.sel),d=>(y(),R(o,{key:d.name,value:a.getExampleCount(d),class:"item"},{default:z(()=>[$(r,{type:"success",effect:d==i.selWord?"dark":"plain",onClick:p=>a.setWord(d)},{default:z(()=>[ve(k(d),1)]),_:2},1032,["effect","onClick"])]),_:2},1032,["value"]))),128))]),m("div",Oh,[(y(!0),w(Y,null,W(i.customWords,d=>(y(),R(o,{key:d,value:a.getExampleCount(d),class:"item"},{default:z(()=>[$(r,{closable:"",onClose:p=>a.removeWord(d),effect:d==i.selWord?"dark":"plain",onClick:p=>a.setWord(d)},{default:z(()=>[ve(k(d),1)]),_:2},1032,["onClose","effect","onClick"])]),_:2},1032,["value"]))),128))]),m("div",Ah,[$(c,{modelValue:i.inputWord,"onUpdate:modelValue":e[1]||(e[1]=d=>i.inputWord=d),disabled:!i.isTransferReady||i.collecting||i.trainning,placeholder:s.$t("speech.inputword")},{append:z(()=>[m("i",{class:"icon-add",onClick:e[0]||(e[0]=(...d)=>a.addWord&&a.addWord(...d))})]),_:1},8,["modelValue","disabled","placeholder"])]),m("div",{onMousedown:e[2]||(e[2]=(...d)=>a.listen&&a.listen(...d)),onMouseup:e[3]||(e[3]=(...d)=>a.stop&&a.stop(...d)),class:"sec",title:"\u8BC6\u522B\u7ED3\u679C\uFF08\u957F\u6309\u8BC6\u522B\uFF09",style:{display:"flex","flex-direction":"row",background:"#f2f2f2","min-height":"3em"}},[m("label",null,k(i.regWord),1)],32)])]),_:1},8,["modelValue","title"])}var Lh=j($h,[["render",Ih],["__scopeId","data-v-32c1ca90"]]);const Uh={components:{Blocks:Al,Editor:Ul,Preview:Pl,Vars:gd,Scenes:jd,Materials:Qd,Textures:ph,Devices:Eh,Panel:Gu,Speech:Lh},data(){return{isRunning:!1,localRev:-1,speechDlg:{visible:!1}}},computed:{isDirty(){return this.localRev!==this.$store.state.revision},isLoading(){return this.$store.state.isLoading},isPending(){return this.$store.state.isNetBusy},floating:{get(){return this.$store.state.isPreviewFloating},set(s){this.$store.state.isPreviewFloating=s}},devices(){return[v].concat(Object.entries(this.$prj.devices).filter(s=>["logic","math","storage","test"].indexOf(s[0])===-1).map(s=>s[1]))},selected(){return this.$store.state.selected.unit},selBlocks(){const s=this.selected;return s?Object.entries(s.actions).map(e=>({unit:s,name:e[0],action:e[1]})):[]},blocksGlobal(){const s=[];return[v,v.builtins.test].forEach(e=>{s.push(...Object.entries(e.actions).map(t=>({unit:e,name:t[0],action:t[1]})))}),s},blocksBuiltin(){const s=[];return Object.values(v.devices).forEach(e=>{s.push(...Object.entries(e.actions).map(t=>({unit:e,name:t[0],action:t[1]})))}),s},blocksLogic(){const s=[];return[v.builtins.logic].forEach(e=>{s.push(...Object.entries(e.actions).map(t=>({unit:e,name:t[0],action:t[1]})))}),s},blocksMath(){const s=[];return[v.builtins.math].forEach(e=>{s.push(...Object.entries(e.actions).map(t=>({unit:e,name:t[0],action:t[1]})))}),s}},methods:{setLang(s){Ml(s)},async save(){const s=v.serialize();await ai.save(s),this.localRev=this.$store.state.revision},async addUnit(s){await v.createUnit(s,v.devices.screen),this.$makeDirty()},async removeUnit(){const s=this.selected;s&&(await v.destroyUnit(s),this.$makeDirty())},async start(){this.isRunning&&await v.stop(),this.isRunning=!0,await v.build().run({})},async stop(){await v.stop(),this.isRunning=!1},resetScreen(){v.screen.reset()}},async mounted(){this.localRev=this.$store.state.revision<=0?0:this.$store.state.revision,this.dragable=new yl(this.$refs.main);const s=document.getElementById("preview"),e=v.screen;e.attach(s),e.reset(),v.screenEditor.setupObsever(()=>{this.$makeDirty()})}},ce=s=>(ye("data-v-763bd14c"),s=s(),be(),s),Rh={class:"min-width",style:{"align-items":"stretch",display:"flex","flex-direction":"column","max-height":"100vh","min-height":"100vh"}},Nh={class:"topbar",style:{"align-items":"stretch",display:"flex","flex-direction":"row",width:"auto"}},Ph={class:"leftside",style:{"align-items":"center",display:"flex",flex:"1 1 auto","flex-direction":"row","font-size":"2rem","padding-left":"0.5rem"}},Vh=ce(()=>m("i",{class:"icon-egg",style:{cursor:"default","font-size":"3rem"}},null,-1)),Hh={class:"center topbtns",style:{"padding-left":"0.5em","align-items":"center",display:"flex",flex:"1 1 auto","flex-direction":"row"}},qh=["isDirty"],Wh={class:"rightside topbtns",style:{"align-items":"center",display:"flex","flex-direction":"row"}},Yh=["isRunning"],Xh=["isRunning"],Gh={key:0,class:"icon-loading",style:{"margin-right":"8px"}},Jh=ce(()=>m("p",{style:{flex:"1 1 auto"}},null,-1)),Qh={ref:"main",class:"main",style:{"align-items":"stretch",display:"flex","flex-direction":"row"}},Zh={class:"leftside blocks",style:{"align-items":"stretch",display:"flex","flex-direction":"column"}},Kh={class:"picker-label"},ep=ce(()=>m("i",{class:"icon-egg"},null,-1)),tp={style:{"margin-left":"0.2em"}},sp={class:"picker-label"},np=ce(()=>m("i",{class:"icon-group"},null,-1)),ip={style:{"margin-left":"0.2em"}},ap={class:"picker-label"},rp=ce(()=>m("i",{class:"icon-logic"},null,-1)),op={style:{"margin-left":"0.2em"}},lp={class:"picker-label"},cp=ce(()=>m("i",{class:"icon-math"},null,-1)),up={style:{"margin-left":"0.2em"}},dp={class:"rightside",style:{"align-items":"stretch",display:"flex","flex-direction":"column"}},hp={class:"picker-label"},pp=ce(()=>m("i",{class:"icon-screen"},null,-1)),mp={style:{"margin-left":"0.2em"}},fp={style:{"align-items":"stretch",display:"flex","flex-direction":"column"}},gp={class:"picker-label"},yp=ce(()=>m("i",{class:"icon-variable"},null,-1)),bp={style:{"margin-left":"0.2em"}},vp={class:"picker-label"},xp=ce(()=>m("i",{class:"icon-layer"},null,-1)),wp={style:{"margin-left":"0.2em"}},_p={class:"picker-label"},Ep=ce(()=>m("i",{class:"icon-brush"},null,-1)),Dp={style:{"margin-left":"0.2em"}},Sp={class:"picker-label"},Cp=ce(()=>m("i",{class:"icon-component"},null,-1)),kp={style:{"margin-left":"0.2em"}};function Mp(s,e,t,n,i,a){const r=F("Blocks"),o=F("el-tab-pane"),c=F("el-tabs"),u=F("Editor"),h=F("Panel"),d=F("Preview"),p=F("Scenes"),f=F("Vars"),g=F("Materials"),b=F("Textures"),E=F("Devices"),T=F("Speech"),M=Nr("loading");return Pr((y(),w("div",Rh,[m("div",Nh,[m("div",Ph,[Vh,m("label",null,k(s.$prj.name),1)]),m("div",Hh,[m("i",{class:"icon-save",isDirty:a.isDirty,onClick:e[0]||(e[0]=(...x)=>a.save&&a.save(...x))},null,8,qh)]),m("div",Wh,[m("i",{class:"icon-start",isRunning:i.isRunning,onClick:e[1]||(e[1]=(...x)=>a.start&&a.start(...x))},null,8,Yh),m("i",{class:"icon-stop",isRunning:i.isRunning,onClick:e[2]||(e[2]=(...x)=>a.stop&&a.stop(...x))},null,8,Xh),a.isPending?(y(),w("i",Gh)):me("",!0),Jh,m("i",{class:"icon-reset",onClick:e[3]||(e[3]=(...x)=>a.resetScreen&&a.resetScreen(...x)),style:{"margin-right":"8px"}}),m("i",{class:ae(a.floating?"icon-minimize":"icon-maximize"),onClick:e[4]||(e[4]=x=>a.floating=!a.floating)},null,2)])]),m("div",Qh,[m("div",Zh,[$(r,{class:"leftside blocks-panel outer-panel",items:a.selBlocks,style:{overflow:"scroll"}},null,8,["items"]),$(c,{class:"block-panes",type:"border-card",style:{flex:"1 1 auto",border:"none","box-shadow":"none","border-top":"2px solid #f2f2f2"}},{default:z(()=>[$(o,null,{label:z(()=>[m("div",Kh,[ep,m("label",tp,k(s.$t("nm.global")),1)])]),default:z(()=>[$(r,{class:"leftside blocks-panel inner-tabpane",items:a.blocksGlobal,style:{overflow:"scroll"}},null,8,["items"])]),_:1}),$(o,{lazy:!0},{label:z(()=>[m("div",sp,[np,m("label",ip,k(s.$t("nm.device")),1)])]),default:z(()=>[$(r,{class:"leftside blocks-panel inner-tabpane",items:a.blocksBuiltin,style:{overflow:"scroll"}},null,8,["items"])]),_:1}),$(o,{lazy:!0},{label:z(()=>[m("div",ap,[rp,m("label",op,k(s.$t("nm.logic")),1)])]),default:z(()=>[$(r,{class:"leftside blocks-panel inner-tabpane",items:a.blocksLogic,style:{overflow:"scroll"}},null,8,["items"])]),_:1}),$(o,{lazy:!0},{label:z(()=>[m("div",lp,[cp,m("label",up,k(s.$t("nm.math")),1)])]),default:z(()=>[$(r,{class:"leftside blocks-panel inner-tabpane",items:a.blocksMath,style:{overflow:"scroll"}},null,8,["items"])]),_:1})]),_:1})]),$(u,{class:"center editor"}),$(h,{class:"panel"}),m("div",dp,[$(d,{class:"preview",id:"preview",floating:a.floating},null,8,["floating"]),$(c,{class:"picker",type:"border-card",style:{flex:"1 1 auto"}},{default:z(()=>[$(o,null,{label:z(()=>[m("div",hp,[pp,m("label",mp,k(s.$t("nm.scene")),1)])]),default:z(()=>[m("div",fp,[$(p,{class:"picker-body"})])]),_:1}),$(o,null,{label:z(()=>[m("div",gp,[yp,m("label",bp,k(s.$t("nm.variable")),1)])]),default:z(()=>[$(f,{class:"vars picker-body"})]),_:1}),$(o,null,{label:z(()=>[m("div",vp,[xp,m("label",wp,k(s.$t("nm.material")),1)])]),default:z(()=>[$(g,{class:"picker-body"})]),_:1}),$(o,null,{label:z(()=>[m("div",_p,[Ep,m("label",Dp,k(s.$t("nm.texture")),1)])]),default:z(()=>[$(b,{class:"picker-body"})]),_:1}),$(o,null,{label:z(()=>[m("div",Sp,[Cp,m("label",kp,k(s.$t("nm.device")),1)])]),default:z(()=>[$(E,{class:"units picker-body",items:a.devices},null,8,["items"])]),_:1})]),_:1})])],512),$(T,{prop:i.speechDlg,title:s.$t("speech.train")},null,8,["prop","title"])])),[[M,a.isLoading]])}var Tp=j(Uh,[["render",Mp],["__scopeId","data-v-763bd14c"]]);const $p={},Fp={class:"not-found-container"};function Bp(s,e,t,n,i,a){return y(),w("div",Fp,"404")}var zp=j($p,[["render",Bp],["__scopeId","data-v-5cca8e54"]]);const Op=[{path:"/",component:Tp},{path:"/:catchAll(.*)",component:zp,meta:{autoIgnored:!0}}],Ap=Vr("/"),Fs=Hr({history:Ap,routes:Op});const jp={props:{direction:{type:String,values:["vertical","horizontal"],default:"horizontal"},source:{type:HTMLElement},target:{type:HTMLElement},width:{type:Number,default:1},color:{type:String,default:"gray"},animated:{type:Boolean,default:!1}},data(){return{start:{x:0,y:0},C1:{x:0,y:0},C2:{x:0,y:0},end:{x:0,y:0},size:{height:0,width:0}}},computed:{path(){return`M${this.start.x} ${this.start.y} C${this.C1.x} ${this.C1.y} ${this.C2.x} ${this.C2.y} ${this.end.x} ${this.end.y}`}},methods:{update(){const s=this.$el.parentElement.getBoundingClientRect(),e=document.getElementById(this.source).getBoundingClientRect(),t=document.getElementById(this.target).getBoundingClientRect(),n={};({horizontal:()=>{this.size.width=Math.abs(t.x-e.x-e.width),this.size.height=Math.max(10,Math.abs(t.y+t.height/2-e.y-e.height/2))+16,n.x=Math.min(t.x,e.x+e.width)-s.x,n.y=Math.min(t.y+t.height/2,e.y+e.height/2)-s.y-8,this.start.x=e.x+e.width-s.x-n.x,this.start.y=e.y+e.height/2-s.y-n.y,this.C1.x=this.start.x+this.size.width/2.5,this.C1.y=this.start.y,this.end.x=t.x-s.x-n.x-4,this.end.y=t.y+t.height/2-s.y-n.y,this.C2.x=this.end.x-this.size.width/2.5,this.C2.y=this.end.y},vertical:()=>{this.size.height=Math.abs(t.y-e.y-e.height),this.size.width=Math.max(10,Math.abs(t.x+t.width/2-e.x-e.width/2))+16,n.y=Math.min(t.y,e.y+e.height)-s.y,n.x=Math.min(t.x+t.width/2,e.x+e.width/2)-s.x-8,this.start.y=e.y+e.height-s.y-n.y,this.start.x=e.x+e.width/2-s.x-n.x,this.C1.y=this.start.y+this.size.height/2.5,this.C1.x=this.start.x,this.end.y=t.y-s.y-n.y-4,this.end.x=t.x+t.width/2-s.x-n.x,this.C2.y=this.end.y-this.size.height/2.5,this.C2.x=this.end.x}})[this.direction].call(this),this.$el.style.left=`${n.x}px`,this.$el.style.top=`${n.y}px`},resize(){this.update()}},mounted(){this.resize(),this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize)},destroyed(){window.removeEventListener("resize",this._resize),this._resize=void 0}},Ip=["width","height"],Lp={id:"bezier-arrow",markerUnits:"strokeWidth",markerWidth:"12",markerHeight:"12",viewBox:"0 0 12 12",refX:"6",refY:"6",orient:"auto"},Up=["d"];function Rp(s,e,t,n,i,a){return y(),w("svg",{class:"bezier-layer",xmlns:"http://www.w3.org/2000/svg",width:i.size.width,height:i.size.height},[m("defs",null,[m("marker",Lp,[m("path",{xmlns:"http://www.w3.org/2000/svg",d:"M2,2 L10,6 L2,10 L6,6 L2,2",style:en("fill:"+t.color+";")},null,4)])]),m("path",{class:ae(t.animated?"bezier-layer-line":""),d:a.path,style:en({stroke:t.color,"stroke-width":t.width}),"marker-end":"url(#bezier-arrow)","stroke-dasharray":"10,5",fill:"none"},null,14,Up)],8,Ip)}var Np=j(jp,[["render",Rp],["__scopeId","data-v-1beb4fe0"]]);const Pp={mounted(){this.$forceUpdate(),this.obs=new ResizeObserver(()=>{this.autolayout()}),this.obs.observe(this.$el)},unmounted(){this.obs.disconnect()},updated(){this.$nextTick(()=>{this.autolayout()})},methods:{dump(s,e){if(e){const n=e.children.length;for(let i=0;i<n;i++)e.removeChild(e.children[0])}else{e=document.createElement("div");for(const i of Object.entries(s.style))try{e.style[i[0]]=i[1]}catch(a){console.log(a)}const n=s.attributes.length;for(let i=0;i<n;i++){const a=s.attributes[i];a.name!=="style"&&e.setAttribute(a.name,a.value)}s.classList.forEach(i=>e.classList.add(i)),e.__svg__=s}const t=s.children.length;for(let n=0;n<t;n++){const i=s.children[n];i.tagName==="g"&&e.appendChild(this.dump(i))}return e},applyCss(s,e){for(const n of Object.entries(s.style))e.style[n[0]]=n[1];const t=s.attributes.length;for(let n=0;n<t;n++){const i=s.attributes[n];i.name!=="style"&&e.setAttribute(i.name,i.value)}s.classList.forEach(n=>{e.classList.contains(n)||e.classList.add(n)})},layout(s){const e=s.__svg__;if(e&&e.style.position!=="absolute"){const n=s.parentElement.getBoundingClientRect(),i=s.getBoundingClientRect();e.setAttribute("width",`${i.width}`),e.setAttribute("height",`${i.height}`),e.setAttribute("transform",`translate(${i.left-n.left}, ${i.top-n.top})`)}const t=s.children.length;for(let n=0;n<t;n++){const i=s.children[n];this.layout(i)}},autolayout(){this.applyCss(this.$el,this.$refs.anchor),this.$refs.anchor.style.width="100%",this.$refs.anchor.style.height="100%",this.$refs.anchor.style.position="absolute",this.$refs.anchor.style.top="0",this.$refs.anchor.style.left="0",this.$refs.anchor.style.zIndex="-1",this.dump(this.$refs.root,this.$refs.anchor),this.layout(this.$refs.anchor)}}},Vp={class:"flexsvg-root"},Hp={ref:"anchor",class:"flexsvg-anchor"},qp={ref:"root",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Wp(s,e,t,n,i,a){return y(),w("div",Vp,[m("div",Hp,null,512),(y(),w("svg",qp,[qr(s.$slots,"default",{},void 0,!0)],512))])}var Yp=j(Pp,[["render",Wp],["__scopeId","data-v-30eb4e83"]]),Xp={install(s){s.component("FlexSvg",Yp),s.component("Bezier",Np)}};window.setImmediate||(window.setImmediate=window.setTimeout);window.$||(window.$=(s,e)=>e.querySelector(s));const tt=Wr({render:()=>(y(),R(F("router-view")))});tt.use(re).use(Fs).use(Ms).use(Yr,{locale:ws==="zh-CN"?Xr:Gr}).mixin({computed:{$t:()=>Jr().t}});Xp.install(tt);fi.beforeLaunch(tt,re,Fs);const wi=tt.mount("#app");window.__vue=wi;wi.$nextTick(()=>{fi.onLaunched(tt,re,Fs)});
